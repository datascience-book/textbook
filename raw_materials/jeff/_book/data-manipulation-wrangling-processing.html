<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <meta name="description" content="Introduction">
  <meta name="generator" content="bookdown 0.4 and GitBook 2.6.7">

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Introduction" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  <meta name="twitter:description" content="Introduction" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="a-light-introduction-to-programming.html">
<link rel="next" href="exploratory-data-analysis.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Data Science: A Practical Strategy (v0.2)</a></li>
<li class="chapter" data-level="1" data-path="data-and-its-many-contexts.html"><a href="data-and-its-many-contexts.html"><i class="fa fa-check"></i><b>1</b> Data And Its Many Contexts</a><ul>
<li class="chapter" data-level="1.1" data-path="data-and-its-many-contexts.html"><a href="data-and-its-many-contexts.html#fires-and-data"><i class="fa fa-check"></i><b>1.1</b> Fires and Data</a></li>
<li class="chapter" data-level="1.2" data-path="data-and-its-many-contexts.html"><a href="data-and-its-many-contexts.html#the-answer-is-42.-well-maybe."><i class="fa fa-check"></i><b>1.2</b> The Answer is 42. Well, Maybe.</a><ul>
<li class="chapter" data-level="1.2.1" data-path="data-and-its-many-contexts.html"><a href="data-and-its-many-contexts.html#benchmarking"><i class="fa fa-check"></i><b>1.2.1</b> Benchmarking</a></li>
<li class="chapter" data-level="1.2.2" data-path="data-and-its-many-contexts.html"><a href="data-and-its-many-contexts.html#explaining"><i class="fa fa-check"></i><b>1.2.2</b> Explaining</a></li>
<li class="chapter" data-level="1.2.3" data-path="data-and-its-many-contexts.html"><a href="data-and-its-many-contexts.html#predicting"><i class="fa fa-check"></i><b>1.2.3</b> Predicting</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="data-and-its-many-contexts.html"><a href="data-and-its-many-contexts.html#the-buzz-and-the-buzzworthy"><i class="fa fa-check"></i><b>1.3</b> The Buzz and the Buzzworthy</a></li>
<li class="chapter" data-level="1.4" data-path="data-and-its-many-contexts.html"><a href="data-and-its-many-contexts.html#whats-the-value-proposition"><i class="fa fa-check"></i><b>1.4</b> What’s The Value Proposition?</a></li>
<li class="chapter" data-level="1.5" data-path="data-and-its-many-contexts.html"><a href="data-and-its-many-contexts.html#structure"><i class="fa fa-check"></i><b>1.5</b> Structure</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html"><i class="fa fa-check"></i><b>2</b> A Light Introduction To Programming</a><ul>
<li class="chapter" data-level="2.1" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#doing-visual-analytics-since-1780s"><i class="fa fa-check"></i><b>2.1</b> Doing visual analytics since 1780’s</a></li>
<li class="chapter" data-level="2.2" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#programming-to-democratizing-skills"><i class="fa fa-check"></i><b>2.2</b> Programming to democratizing skills</a></li>
<li class="chapter" data-level="2.3" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#how-programming-languages-work"><i class="fa fa-check"></i><b>2.3</b> How programming languages work</a></li>
<li class="chapter" data-level="2.4" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#setting-up-r"><i class="fa fa-check"></i><b>2.4</b> Setting up R</a><ul>
<li class="chapter" data-level="2.4.1" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#installation"><i class="fa fa-check"></i><b>2.4.1</b> Installation</a></li>
<li class="chapter" data-level="2.4.2" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#justifying-open-source-software"><i class="fa fa-check"></i><b>2.4.2</b> Justifying open source software</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#a-gentle-introduction-to-r"><i class="fa fa-check"></i><b>2.5</b> A Gentle Introduction to R</a><ul>
<li class="chapter" data-level="2.5.1" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#operators"><i class="fa fa-check"></i><b>2.5.1</b> Operators</a></li>
<li class="chapter" data-level="2.5.2" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#data-classes"><i class="fa fa-check"></i><b>2.5.2</b> Data classes</a></li>
<li class="chapter" data-level="2.5.3" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#libraries-expanded-functionality"><i class="fa fa-check"></i><b>2.5.3</b> Libraries: Expanded functionality</a></li>
<li class="chapter" data-level="2.5.4" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#inputoutput-io"><i class="fa fa-check"></i><b>2.5.4</b> Input/Output (I/O)</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#diy"><i class="fa fa-check"></i><b>2.6</b> DIY</a><ul>
<li class="chapter" data-level="2.6.1" data-path="a-light-introduction-to-programming.html"><a href="a-light-introduction-to-programming.html#reading-a-csv-directly-from-the-web"><i class="fa fa-check"></i><b>2.6.1</b> Reading a CSV directly from the web</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html"><i class="fa fa-check"></i><b>3</b> Data Manipulation / Wrangling / Processing</a><ul>
<li class="chapter" data-level="3.1" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#motivation"><i class="fa fa-check"></i><b>3.1</b> Motivation</a></li>
<li class="chapter" data-level="3.2" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#cell-level-operations"><i class="fa fa-check"></i><b>3.2</b> Cell-Level Operations</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#text-manipulation-functions"><i class="fa fa-check"></i><b>3.2.1</b> Text manipulation functions</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#regular-expressions"><i class="fa fa-check"></i><b>3.2.2</b> Regular Expressions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#matrix-and-data-frames"><i class="fa fa-check"></i><b>3.3</b> Matrix and Data Frames</a><ul>
<li class="chapter" data-level="3.3.1" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#indices-and-subsetting"><i class="fa fa-check"></i><b>3.3.1</b> Indices and Subsetting</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#reshape"><i class="fa fa-check"></i><b>3.3.2</b> Reshape</a></li>
<li class="chapter" data-level="3.3.3" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#collapse"><i class="fa fa-check"></i><b>3.3.3</b> Collapse</a></li>
<li class="chapter" data-level="3.3.4" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#join"><i class="fa fa-check"></i><b>3.3.4</b> Join</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#control-structures"><i class="fa fa-check"></i><b>3.4</b> Control Structures</a><ul>
<li class="chapter" data-level="3.4.1" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#if-and-ifelse-statement"><i class="fa fa-check"></i><b>3.4.1</b> If and If…Else Statement</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#for-loops"><i class="fa fa-check"></i><b>3.4.2</b> For-loops</a></li>
<li class="chapter" data-level="3.4.3" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#while"><i class="fa fa-check"></i><b>3.4.3</b> While</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#functions"><i class="fa fa-check"></i><b>3.5</b> Functions</a></li>
<li class="chapter" data-level="3.6" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#etiquette"><i class="fa fa-check"></i><b>3.6</b> Etiquette</a><ul>
<li class="chapter" data-level="3.6.1" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#what-can-you-do-with-control-structures"><i class="fa fa-check"></i><b>3.6.1</b> What can you do with control structures?</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#getting-into-the-mentality"><i class="fa fa-check"></i><b>3.7</b> Getting into the mentality</a></li>
<li class="chapter" data-level="3.8" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#diy-1"><i class="fa fa-check"></i><b>3.8</b> DIY</a><ul>
<li class="chapter" data-level="3.8.1" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#how-do-i-auto-populate-text-and-stences-pro-forma"><i class="fa fa-check"></i><b>3.8.1</b> How do I auto-populate text and stences pro forma?</a></li>
<li class="chapter" data-level="3.8.2" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#what-is-the-overlap-between-these-two-lists"><i class="fa fa-check"></i><b>3.8.2</b> What is the overlap between these two lists?</a></li>
<li class="chapter" data-level="3.8.3" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#what-do-i-do-find-trends-in-transactional-or-event-level-data"><i class="fa fa-check"></i><b>3.8.3</b> What do I do find trends in transactional or event-level data?</a></li>
<li class="chapter" data-level="3.8.4" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#i-have-a-lot-of-text.-how-do-extract-basic-keywords"><i class="fa fa-check"></i><b>3.8.4</b> I have a lot of text. How do extract basic keywords?</a></li>
<li class="chapter" data-level="3.8.5" data-path="data-manipulation-wrangling-processing.html"><a href="data-manipulation-wrangling-processing.html#edge-detection-of-images"><i class="fa fa-check"></i><b>3.8.5</b> Edge detection of images?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>4</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visually-detecting-patterns"><i class="fa fa-check"></i><b>4.1</b> Visually Detecting Patterns</a></li>
<li class="chapter" data-level="4.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#how-does-this-work"><i class="fa fa-check"></i><b>4.2</b> How does this work?</a></li>
<li class="chapter" data-level="4.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#univariate-data-analysis"><i class="fa fa-check"></i><b>4.3</b> Univariate data analysis</a><ul>
<li class="chapter" data-level="4.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#statistics-for-continuous-variables"><i class="fa fa-check"></i><b>4.3.1</b> Statistics for continuous variables</a></li>
<li class="chapter" data-level="4.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#graphical-approaches"><i class="fa fa-check"></i><b>4.3.2</b> Graphical Approaches</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#multivariate-data"><i class="fa fa-check"></i><b>4.4</b> Multivariate Data</a></li>
<li class="chapter" data-level="4.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#diy-2"><i class="fa fa-check"></i><b>4.5</b> DIY</a><ul>
<li class="chapter" data-level="4.5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#whats-a-common-exploratory-data-analysis-workflow"><i class="fa fa-check"></i><b>4.5.1</b> What’s a common exploratory data analysis workflow?</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercises-8"><i class="fa fa-check"></i><b>4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="similarity.html"><a href="similarity.html"><i class="fa fa-check"></i><b>5</b> Similarity</a><ul>
<li class="chapter" data-level="5.1" data-path="similarity.html"><a href="similarity.html#distances"><i class="fa fa-check"></i><b>5.1</b> Distances</a><ul>
<li class="chapter" data-level="" data-path="similarity.html"><a href="similarity.html#exercise"><i class="fa fa-check"></i>Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="similarity.html"><a href="similarity.html#correlation"><i class="fa fa-check"></i><b>5.2</b> Correlation</a></li>
<li class="chapter" data-level="5.3" data-path="similarity.html"><a href="similarity.html#linguistic-distances"><i class="fa fa-check"></i><b>5.3</b> Linguistic Distances</a><ul>
<li class="chapter" data-level="" data-path="similarity.html"><a href="similarity.html#exercise-1"><i class="fa fa-check"></i>Exercise</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="similarity.html"><a href="similarity.html#entropy"><i class="fa fa-check"></i><b>5.4</b> Entropy</a></li>
<li class="chapter" data-level="5.5" data-path="similarity.html"><a href="similarity.html#diy-3"><i class="fa fa-check"></i><b>5.5</b> DIY</a><ul>
<li class="chapter" data-level="5.5.1" data-path="similarity.html"><a href="similarity.html#given-product-a-which-other-products-x-y-z-should-i-recommend"><i class="fa fa-check"></i><b>5.5.1</b> Given product [A], which other products [X, Y, Z] should I recommend?</a></li>
<li class="chapter" data-level="5.5.2" data-path="similarity.html"><a href="similarity.html#which-texts-are-saying-similar-things"><i class="fa fa-check"></i><b>5.5.2</b> Which texts are saying similar things?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>6</b> Clustering</a><ul>
<li class="chapter" data-level="6.1" data-path="clustering.html"><a href="clustering.html#everything-is-related-to-everything-else"><i class="fa fa-check"></i><b>6.1</b> Everything is related to everything else</a></li>
<li class="chapter" data-level="6.2" data-path="clustering.html"><a href="clustering.html#technical-foundations"><i class="fa fa-check"></i><b>6.2</b> Technical Foundations</a><ul>
<li class="chapter" data-level="6.2.1" data-path="clustering.html"><a href="clustering.html#k-means"><i class="fa fa-check"></i><b>6.2.1</b> K-Means</a></li>
<li class="chapter" data-level="6.2.2" data-path="clustering.html"><a href="clustering.html#hierarchical-clustering"><i class="fa fa-check"></i><b>6.2.2</b> Hierarchical clustering</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="clustering.html"><a href="clustering.html#diy-4"><i class="fa fa-check"></i><b>6.3</b> DIY</a><ul>
<li class="chapter" data-level="6.3.1" data-path="clustering.html"><a href="clustering.html#how-much-of-the-ground-is-covered-in-vegetationbuildingseconomic-activity"><i class="fa fa-check"></i><b>6.3.1</b> How much of the ground is covered in [vegetation/buildings/economic activity]?</a></li>
<li class="chapter" data-level="6.3.2" data-path="clustering.html"><a href="clustering.html#how-do-i-characterize-the-demand-for-productsservices"><i class="fa fa-check"></i><b>6.3.2</b> How do I characterize the demand for [products/services]?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="model-validation-how-do-we-know-what-we-know.html"><a href="model-validation-how-do-we-know-what-we-know.html"><i class="fa fa-check"></i><b>7</b> Model validation: How do we know what we know?</a><ul>
<li class="chapter" data-level="7.1" data-path="model-validation-how-do-we-know-what-we-know.html"><a href="model-validation-how-do-we-know-what-we-know.html#when-knowing-the-answer-is-not-enough"><i class="fa fa-check"></i><b>7.1</b> When knowing the answer is not enough</a></li>
<li class="chapter" data-level="7.2" data-path="model-validation-how-do-we-know-what-we-know.html"><a href="model-validation-how-do-we-know-what-we-know.html#converting-a-farcical-scenario-into-practical-knowledge"><i class="fa fa-check"></i><b>7.2</b> Converting a farcical scenario into practical knowledge</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html"><i class="fa fa-check"></i><b>8</b> Continuous Problems: How much should we expect…?</a><ul>
<li class="chapter" data-level="8.1" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#an-ordinary-case-of-regression"><i class="fa fa-check"></i><b>8.1</b> An Ordinary Case of Regression</a><ul>
<li class="chapter" data-level="8.1.1" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#interpretation"><i class="fa fa-check"></i><b>8.1.1</b> Interpretation</a></li>
<li class="chapter" data-level="8.1.2" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#assumptions-matter"><i class="fa fa-check"></i><b>8.1.2</b> Assumptions matter</a></li>
<li class="chapter" data-level="8.1.3" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#in-the-code"><i class="fa fa-check"></i><b>8.1.3</b> In the code</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#more-than-plain-vanilla-regression"><i class="fa fa-check"></i><b>8.2</b> More Than Plain Vanilla Regression</a><ul>
<li class="chapter" data-level="8.2.1" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#the-ridge-and-the-lasso"><i class="fa fa-check"></i><b>8.2.1</b> The Ridge and the LASSO</a></li>
<li class="chapter" data-level="8.2.2" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#why-regularized-methods-matter"><i class="fa fa-check"></i><b>8.2.2</b> Why regularized methods matter</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>8.3</b> K-Nearest Neighbors</a><ul>
<li class="chapter" data-level="8.3.1" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#formulation"><i class="fa fa-check"></i><b>8.3.1</b> Formulation</a></li>
<li class="chapter" data-level="8.3.2" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#which-k-is-the-right-k"><i class="fa fa-check"></i><b>8.3.2</b> Which K is the right K?</a></li>
<li class="chapter" data-level="8.3.3" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#usage"><i class="fa fa-check"></i><b>8.3.3</b> Usage</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#diy-5"><i class="fa fa-check"></i><b>8.4</b> DIY</a><ul>
<li class="chapter" data-level="8.4.1" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#whats-a-good-way-to-fill-in-missing-data"><i class="fa fa-check"></i><b>8.4.1</b> What’s a good way to fill-in missing data?</a></li>
<li class="chapter" data-level="8.4.2" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#what-do-i-do-when-there-are-too-many-features"><i class="fa fa-check"></i><b>8.4.2</b> What do I do when there are too many features?</a></li>
<li class="chapter" data-level="8.4.3" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#what-level-of-demandstaff-should-i-expect"><i class="fa fa-check"></i><b>8.4.3</b> What level of [demand/staff] should I expect?</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="continuous-problems-how-much-should-we-expect.html"><a href="continuous-problems-how-much-should-we-expect.html#exercises-9"><i class="fa fa-check"></i><b>8.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>9</b> Classification</a><ul>
<li class="chapter" data-level="9.1" data-path="classification.html"><a href="classification.html#healthcare-sans-the-politics"><i class="fa fa-check"></i><b>9.1</b> Healthcare sans the politics</a></li>
<li class="chapter" data-level="9.2" data-path="classification.html"><a href="classification.html#what-goes-into-a-classifier"><i class="fa fa-check"></i><b>9.2</b> What goes into a classifier?</a></li>
<li class="chapter" data-level="9.3" data-path="classification.html"><a href="classification.html#six-common-techniques"><i class="fa fa-check"></i><b>9.3</b> Six Common Techniques</a><ul>
<li class="chapter" data-level="9.3.1" data-path="classification.html"><a href="classification.html#knn"><i class="fa fa-check"></i><b>9.3.1</b> KNN</a></li>
<li class="chapter" data-level="9.3.2" data-path="classification.html"><a href="classification.html#logistic-regression"><i class="fa fa-check"></i><b>9.3.2</b> Logistic Regression</a></li>
<li class="chapter" data-level="9.3.3" data-path="classification.html"><a href="classification.html#decision-trees"><i class="fa fa-check"></i><b>9.3.3</b> Decision trees</a></li>
<li class="chapter" data-level="9.3.4" data-path="classification.html"><a href="classification.html#random-forests"><i class="fa fa-check"></i><b>9.3.4</b> Random Forests</a></li>
<li class="chapter" data-level="9.3.5" data-path="classification.html"><a href="classification.html#support-vector-machines"><i class="fa fa-check"></i><b>9.3.5</b> Support Vector Machines</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="classification.html"><a href="classification.html#diy-6"><i class="fa fa-check"></i><b>9.4</b> DIY</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-manipulation-wrangling-processing" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Data Manipulation / Wrangling / Processing</h1>
<div id="motivation" class="section level2">
<h2><span class="header-section-number">3.1</span> Motivation</h2>
<p>Speech contains a wealth of information. As humans, we are taught to understand verbal and written communication – pick out the nouns, verbs, and adjectives, then combine the information to decipher meaing. Take the following excerpt from the 2010 State of the Union:</p>
<blockquote>
<p>Now, one place to start is serious financial reform. Look, I am not interested in punishing banks. I’m interested in protecting our economy. A strong, healthy financial market makes it possible for businesses to access credit and create new jobs. It channels the savings of families into investments that raise incomes. But that can only happen if we guard against the same recklessness that nearly brought down our entire economy. We need to make sure consumers and middle-class families have the information they need to make financial decisions. We can’t allow financial institutions, including those that take your deposits, to take risks that threaten the whole economy.</p>
</blockquote>
<p>To many, text might not be considered data despite the fact that any analytical mind with a command of the English language can identify key terms:</p>
<blockquote>
<p><del>Now, one place to start is serious</del> financial reform. <del>Look, I am not interested in</del> punishing banks. <del>I’m interested in</del> protecting our economy. <del>A</del> strong, healthy financial market <del>makes it possible for</del> businesses <del>to access</del> credit <del>and</del> create new jobs. <del>It channels the</del> savings of families <del>into</del> investments <del>that</del> raise incomes. <del>But that can only happen if we guard against the same</del> recklessness <del>that nearly brought down our entire</del> economy. <del>We need to make sure</del> consumers <del>and</del> middle-class families <del>have the information they need to make</del>financial decisions. <del>We can’t allow</del> financial institutions, <del>including those that take your</del> deposits,<del>to take risks that threaten the whole</del> economy.</p>
</blockquote>
<p>Much like the logic that guides keyword identification, text can be shaped from an unstructured dataset into a well-defined, structured dataset:</p>
<table>
<caption><span id="tab:unnamed-chunk-53">Table 3.1: </span>Most frequent terms found in excerpt.</caption>
<thead>
<tr class="header">
<th align="left">Terms</th>
<th align="right">Frequency of Term</th>
<th align="right">Number of Characters</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">financial</td>
<td align="right">4</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">economy</td>
<td align="right">3</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">families</td>
<td align="right">2</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">interested</td>
<td align="right">2</td>
<td align="right">10</td>
</tr>
</tbody>
</table>
<p>Of course, this process could be done manually, but imagine sorting through all 7,304 words in the 2010 address or scaling the process to the roughly <a href="http://www.presidency.ucsb.edu/sou_words.php"><em>1.9 million words</em></a> in addresses State of the Union addresses between 1790 and 2016. All the steps required to convert unstructured text into usable data can be done with a little bit of planning, technical imagination and data manipulation. Every little detail about the data needs to be considered and meticulously converted into a usable form. From a data format perspective, capitalized characters are not the same as lower case. Contractions are not the same as terms that are spelled out. Punctuation affect spacing. Carriage returns and new line markers, while not visible in reading mode, are recorded.</p>
<p>Let’s take one line from above and dissect the changes that need to be made:</p>
<blockquote>
<p>“We need to make sure consumers and middle-class families have the information they need to make financial decisions. We can’t allow financial institutions, including those that take your deposits, to take risks that threaten the whole economy.”</p>
</blockquote>
<p>We then turn everything into lower case so all letters of the alphabet are read the same.</p>
<blockquote>
<p>“we need to make sure consumers and middle-class families have the information they need to make financial decisions. we can’t allow financial institutions, including those that take your deposits, to take risks that threaten the whole economy.”</p>
</blockquote>
<p>Then, we get rid of punctuation by substituting values with empty quotations (<code>&quot;&quot;</code>).</p>
<blockquote>
<p>“we need to make sure consumers and middleclass families have the information they need to make financial decisions we cant allow financial institutions including those that take your deposits to take risks that threaten the whole economy”</p>
</blockquote>
<p>Each space between each word can be used as a <em>delimiter</em> that can be used as a symbol for a program to break apart words into elements in a list.</p>
<table>
<caption><span id="tab:unnamed-chunk-54">Table 3.2: </span>Terms</caption>
<tbody>
<tr class="odd">
<td align="left">we</td>
<td align="left">families</td>
<td align="left">financial</td>
<td align="left">those</td>
<td align="left">that</td>
</tr>
<tr class="even">
<td align="left">need</td>
<td align="left">have</td>
<td align="left">decisions</td>
<td align="left">that</td>
<td align="left">threaten</td>
</tr>
<tr class="odd">
<td align="left">to</td>
<td align="left">the</td>
<td align="left">we</td>
<td align="left">take</td>
<td align="left">the</td>
</tr>
<tr class="even">
<td align="left">make</td>
<td align="left">information</td>
<td align="left">cant</td>
<td align="left">your</td>
<td align="left">whole</td>
</tr>
<tr class="odd">
<td align="left">sure</td>
<td align="left">they</td>
<td align="left">allow</td>
<td align="left">deposits</td>
<td align="left">economy</td>
</tr>
<tr class="even">
<td align="left">consumers</td>
<td align="left">need</td>
<td align="left">financial</td>
<td align="left">to</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">and</td>
<td align="left">to</td>
<td align="left">institutions</td>
<td align="left">take</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">middleclass</td>
<td align="left">make</td>
<td align="left">including</td>
<td align="left">risks</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>There are words in there that don’t add much value as they are commonplace and filler. In text processing, these words are known as <em>stop words</em>. In each domain, the list of stop words likely differs, thus data scientists may need to build a customized list. For simplicity, we’ve used a stop words list that is used in the mySQL – an open source relational database management system. The result is the list of remaining words.</p>
<table>
<caption><span id="tab:unnamed-chunk-55">Table 3.3: </span>Terms after removing stop words</caption>
<tbody>
<tr class="odd">
<td align="left">make</td>
<td align="left">information</td>
<td align="left">financial</td>
<td align="left">risks</td>
</tr>
<tr class="even">
<td align="left">consumers</td>
<td align="left">make</td>
<td align="left">institutions</td>
<td align="left">threaten</td>
</tr>
<tr class="odd">
<td align="left">middleclass</td>
<td align="left">financial</td>
<td align="left">including</td>
<td align="left">economy</td>
</tr>
<tr class="even">
<td align="left">families</td>
<td align="left">decisions</td>
<td align="left">deposits</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>From that data, we can aggregate the data into a form that is meaningful to answer a research question. For example, the frequency of words may provide a clue as to what the text is about. In this case, each “financial” and “make” appear twice in the text, perhaps indicating that there is an orientation towards action (make) for financial considerations.</p>
<table>
<caption><span id="tab:unnamed-chunk-56">Table 3.4: </span>Term Frequencies</caption>
<thead>
<tr class="header">
<th align="left">Term</th>
<th align="right">Freq</th>
<th align="left">Term</th>
<th align="left">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">financial</td>
<td align="right">2</td>
<td align="left">including</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">make</td>
<td align="right">2</td>
<td align="left">information</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">consumers</td>
<td align="right">1</td>
<td align="left">institutions</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">decisions</td>
<td align="right">1</td>
<td align="left">middleclass</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">deposits</td>
<td align="right">1</td>
<td align="left">risks</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">economy</td>
<td align="right">1</td>
<td align="left">threaten</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">families</td>
<td align="right">1</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>This is just the tip of the iceberg. Text processing is just one example of <em>feature engineering</em> – or the creation and derivation of new information from data that is not in the best of formats. There is often information hidden within information and mastering feature engineering and data manipulation more generally unlocks new possibilities and insights.</p>
<p>Much of a data scientist’s time is spent extracting, cleaning, and transforming data for use. In database circles, this process is sometimes referred to as Extract-Transform-Load. In general data circles, it is referred to as data wrangling or data munging. Regardless of the term, without a reputable study to cite, the author supposes based on his and colleagues’ experiences that as much of 80% of a data project is spent manipulating information. Thus, it is evermore important to master the basic skills. Stronger one’s command of programming data manipulations, the faster one can code, the soon one can get to the more interest aspects of using data as a strategy.</p>
<p>This chapter is dedicated to building the fundamental skills on which all data projects rely. We begin by highlighting introducing the mechanics of cell level (e.g. text operations, formats) and structural level (e.g. sorting, subsetting, merging) data manipulation. We then proceed to introducing programming paradigms, namely control structures and functions, that vastly improve the efficiency when handling data. The chapter ends on a number of DIY cases.</p>

</div>
<div id="cell-level-operations" class="section level2">
<h2><span class="header-section-number">3.2</span> Cell-Level Operations</h2>
<p>Cell-level operations is a matter of changing the contents of data elements. With numeric data, this may involve various arithmetic operations like subtraction and multiplication, but that is applicable assuming that data is already of good quality. More often than not, data cleansing involves finding, extracting, and replacing the contents of string values. For example, below is a vector of four string values:</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  budget &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Captain&#39;s Log, Stardate 1511.8. I have $10.20 for a big galactic mac.&quot;</span>,
            <span class="st">&quot;The ensign has $1,20 in her pocket.&quot;</span>, 
            <span class="st">&quot;The ExO spent has $0.25 left after paying for overpriced warp core fuel.&quot;</span>,
            <span class="st">&quot;Chief medical officer is the high roller with $53,13.&quot;</span>)</code></pre></div>

<p>What if we need to extract the total available funds available to buy galactic big macs? All four elements contain dollar values, which can benefit from feature engineering. To do so, we use a combination of text manipulation functions and <em>regular expressions</em> or <em>regex</em> – a series of characters that describe a regularly occurring text pattern.</p>
<p>First, commas should be replaced with a period using <code>gsub()</code>, assigning the result to a new object <code>new</code>. Note that in some regions, such as Europe, commas are used as decimals rather than periods.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  new &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;,&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>, budget)</code></pre></div>

<p>Second, find the elements that contain the following pattern: a dollar sign followed by one to two digits, followed by a period, then another two digits (<code>\\$\\d{1,2}\\.\\d{2}</code>). The pattern can be used with the functions <code>regexpr()</code> to find the positions of the matching patterns in the text, then <code>regmatches()</code> is used to extract.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  indices &lt;-<span class="st"> </span><span class="kw">regexpr</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">$</span><span class="ch">\\</span><span class="st">d{1,2}</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">d{2}&quot;</span>, new)
  numbers &lt;-<span class="st"> </span><span class="kw">regmatches</span>(new, indices)
  <span class="kw">print</span>(numbers)</code></pre></div>
<pre><code>## [1] &quot;$10.20&quot; &quot;$1.20&quot;  &quot;$0.25&quot;  &quot;$53.13&quot;</code></pre>

<p>Third, we should replace dollar sign with blank and strip out any leading white space using <code>trimws()</code>. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  numbers &lt;-<span class="st"> </span><span class="kw">trimws</span>(<span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">$&quot;</span>,<span class="st">&quot;&quot;</span>, numbers))
  <span class="kw">print</span>(numbers)</code></pre></div>
<pre><code>## [1] &quot;10.20&quot; &quot;1.20&quot;  &quot;0.25&quot;  &quot;53.13&quot;</code></pre>

<p>Lastly, convert the character vector to numeric, then sum the vector. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  money &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(numbers)
  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Total galactic big mac funds = $&quot;</span>, <span class="kw">sum</span>(money)))</code></pre></div>
<pre><code>## [1] &quot;Total galactic big mac funds = $64.78&quot;</code></pre>

<p>A number of observations. In steps one through three, you will have noticed that the characters <code>&quot;$&quot;</code>, <code>&quot;.&quot;</code>, and <code>&quot;d&quot;</code> were preceded by double backslash. These are known as <em>escaped characters</em> as the double backslash preceding the characters changes their meanings. In step two, a sequence of unusual characters (<code>\\$\\d{1,2}\\.\\d{2}</code>) was used to find the <code>$x.xx</code> pattern, which can be broken into specific commands:</p>
<ul>
<li><code>\\$</code> is a dollar sign.</li>
<li><code>\\d{1,2}</code> is a series of numerical characters that is between one to two digits long.</li>
<li><code>\\.</code> is a period.</li>
<li><code>\\d{2}</code> is a series of numerical characters that is exactly two digits long.</li>
</ul>
<p>Mastering <em>regex</em> is a productivity multiplier, opening the possibility of ultra-precise text replacement, extraction, and other manipulation. Imagine scenarios where raw data is not quality controlled and mass errors plague the usefulness of the data. An analyst may spend days if not weeks or months cleaning data by hand (or rather through find and replace). With regex, haphazard cleaning is no longer an issue. To make the most of regex requires a command of both <em>text manipulation functions</em> that are designed to interpret regex as well as <em>regex</em> itself.</p>
<div id="text-manipulation-functions" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Text manipulation functions</h3>
<p>Find and replace are useful functions in most word processing and spreadsheet softwares. But what does it take to do find and replace at scale. The following seven text manipulation functions are commonly implemented in programming languages. Each searches for a user-defined pattern and returns a result in a well-defined format.</p>
<ul>
<li><p><code>grep()</code>: Returns either the index position of a matched string or the string containing the matched portion.</p></li>
<li><p><code>grepl()</code>: Returns a logical vector – a vector of TRUE/FALSE for whether a matched string was found.</p></li>
<li><p><code>gsub()</code>: Searches and replaces patterns in strings.</p></li>
<li><p><code>regexpr()</code>: Returns the character position of a pattern in a string.</p></li>
<li><p><code>strsplit()</code>: Splits strings into a list of values based on a delimiter.</p></li>
<li><p><code>regmatches()</code>: Extract substring using information from <code>regexpr()</code></p></li>
<li><p><code>substr()</code>: Extract substring from a string based on string positions.</p></li>
</ul>
<p>Traditionally, functions like <code>grep()</code> are available through command line interfaces and are a core offering of the R programming language. On their own, some basic tasks can be accomplished such as exact matches of specific text. As will be seen later, these functions combined with regex are quite powerful. To illustrate the basic functionality, let’s assume we have four sentences that indicate when four US laws were signed.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  laws &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;. Dodd-Frank Act was signed into federal law on July 21, 2010.&quot;</span>, 
      <span class="st">&quot;Glass-Steagall Act was signed into federal law by FDR on June 16, 1933&quot;</span>, 
      <span class="st">&quot;Hatch Act went into effect on August 2, 1939&quot;</span>, 
      <span class="st">&quot;Sarbanes-Oxley Act was signed into law on July 30, 2002&quot;</span>)</code></pre></div>

<div id="example-task-i-need-to-find-all-sentences-about-laws-that-were-sponsored-by-two-congressmen." class="section level4 unnumbered">
<h4>Example Task: I need to find all sentences about laws that were sponsored by two congressmen.</h4>
<p>Suppose we need to find acts that are named for two congressmen. The <code>grep()</code> function can be used to find the index positions of elements in a vector that contain <code>&quot;-&quot;</code>. Otherwise stated, return the row number for each sentence that contains a hyphen. In this case, the 1st, 2nd, and 4th elements in the <code>laws</code> vector contain hyphens.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">grep</span>(<span class="st">&quot;-&quot;</span>, laws)</code></pre></div>
<pre><code>## [1] 1 2 4</code></pre>

<p><code>grep()</code> can also return the matched value when the option <code>value</code> is set to <code>TRUE</code>. This is handy for inspecting the accuracy of matches. In practice, with large data sets that contain variable names that follow a common convention, column names can be efficiently searched.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">grep</span>(<span class="st">&quot;-&quot;</span>, laws, <span class="dt">value =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] &quot;. Dodd-Frank Act was signed into federal law on July 21, 2010.&quot;        
## [2] &quot;Glass-Steagall Act was signed into federal law by FDR on June 16, 1933&quot;
## [3] &quot;Sarbanes-Oxley Act was signed into law on July 30, 2002&quot;</code></pre>

<p>This can also be expressed in a different way. The <code>grepl()</code> function can be used to obtain a vector of logical values (<code>TRUE</code>/<code>FALSE</code>) that is the same length as the input vector <code>laws</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">grepl</span>(<span class="st">&quot;-&quot;</span>, laws)</code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE  TRUE</code></pre>
</div>
<div id="example-task-i-need-to-find-text-about-laws-passed-in-the-21st-century." class="section level4 unnumbered">
<h4>Example Task: I need to find text about laws passed in the 21st century.</h4>
<p>The same functions can be used to find laws that were passed int he 21st century. We can look for sentences that contain <code>20</code> followed by any two digits. This is a regex expression that will be elaborated upon in the following section.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">grep</span>(<span class="st">&quot;20</span><span class="ch">\\</span><span class="st">d{2}&quot;</span>, laws)</code></pre></div>
<pre><code>## [1] 1 4</code></pre>

</div>
<div id="example-task-i-need-to-find-the-names-of-co-sponsored-laws." class="section level4 unnumbered">
<h4>Example Task: I need to find the names of co-sponsored laws.</h4>
<p>Similar to <code>grep()</code>, <code>regexpr()</code> enables more precise search and extraction. Rather than returning which element contains a matched string pattern, <code>regexpr()</code> returns two sets of attributes. The first indicates the position of the first character that is matched in each string (e.g. 7 indicates that the <code>-</code> value is the fifth character is the first string) whereas the second set of attributes indicate the length of the match. Positive values indicate the number of characters and a value of -1 indicates no match.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">regexpr</span>(<span class="st">&quot;-&quot;</span>, laws)</code></pre></div>
<pre><code>## [1]  7  6 -1  9
## attr(,&quot;match.length&quot;)
## [1]  1  1 -1  1
## attr(,&quot;useBytes&quot;)
## [1] TRUE</code></pre>

<p>For even greater precision, a regex search can be used to turn up positions of within an element that contains a match. In the example below, <code>\\w</code> is used to find any alphanumeric character. The numbers <code>{3,20}</code> indicate how many characters – in this case, we’re searching for substrings that are between three and 20 charaters long, separated by a hyphen. The result is two set of values. The first set of numbers indicates the position of the first string character that matches the pattern (e.g. 3 indicates that Dodd-Frank starts in the 3rd space in the string). The second number in the following row indicates the length of the match (e.g. 10 indicates that Dodd-Frank is 10 characters long). More of these regex oeprators are described later in this chapter.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">regexpr</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">w{3,20}-</span><span class="ch">\\</span><span class="st">w{3,20}&quot;</span>, laws)</code></pre></div>
<pre><code>## [1]  3  1 -1  1
## attr(,&quot;match.length&quot;)
## [1] 10 14 -1 14
## attr(,&quot;useBytes&quot;)
## [1] TRUE</code></pre>

<p><code>regexpr</code> alone is not all that useful, but is incredibly powerful when combined with <code>regmatches()</code>, which extracts character values based on the output of <code>regexpr()</code>. Below, we place the results of a search for two alphabetic strings separated by a hyphen in the object <code>result</code>, then pass both the <code>laws</code> vector and the <code>regexpr()</code> <code>result</code> in <code>regmatches()</code>. We print to console the resulting vector.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  result &lt;-<span class="st"> </span><span class="kw">regexpr</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">w{3,20}-</span><span class="ch">\\</span><span class="st">w{3,20}&quot;</span>, laws)
  matched &lt;-<span class="st"> </span><span class="kw">regmatches</span>(laws, result)
  <span class="kw">print</span>(matched)</code></pre></div>
<pre><code>## [1] &quot;Dodd-Frank&quot;     &quot;Glass-Steagall&quot; &quot;Sarbanes-Oxley&quot;</code></pre>

</div>
<div id="example-task-i-need-to-remove-a-pesky-hyphen." class="section level4 unnumbered">
<h4>Example Task: I need to remove a pesky hyphen.</h4>
<p>To remove the hyphen, we can use <code>gsub()</code> to find “-” and replace with a space &quot; “.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  cleaned &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;-&quot;</span>,<span class="st">&quot; &quot;</span>, matched)
  <span class="kw">print</span>(cleaned)</code></pre></div>
<pre><code>## [1] &quot;Dodd Frank&quot;     &quot;Glass Steagall&quot; &quot;Sarbanes Oxley&quot;</code></pre>

</div>
<div id="example-task-i-need-to-make-a-catchy-abbreviation-for-these-law-names." class="section level4 unnumbered">
<h4>Example Task: I need to make a catchy abbreviation for these law names.</h4>
<p>Using <code>substr()</code>, substrings or parts of strings can be extracted based on their position. To get the first two letters of each law, we can do the following: </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">substr</span>(laws,<span class="dv">1</span>,<span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] &quot;. &quot; &quot;Gl&quot; &quot;Ha&quot; &quot;Sa&quot;</code></pre>

<p>Or create new vectors that are a concatenation of the first two letters of each name like <em>SoHo</em>, <em>NoHo</em>, or any trendy name.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Get index of second name (search for space followed by two characters)</span>
  indices &lt;-<span class="st"> </span><span class="kw">regexpr</span>(<span class="st">&quot; </span><span class="ch">\\</span><span class="st">w{2}&quot;</span>,cleaned)
  
<span class="co">#extract first two letters </span>
  secondhalf &lt;-<span class="st"> </span><span class="kw">trimws</span>(<span class="kw">regmatches</span>(cleaned, indices))
  <span class="kw">paste0</span>(<span class="kw">substr</span>(cleaned,<span class="dv">1</span>,<span class="dv">2</span>), secondhalf)</code></pre></div>
<pre><code>## [1] &quot;DoFr&quot; &quot;GlSt&quot; &quot;SaOx&quot;</code></pre>

</div>
<div id="example-task-i-need-to-extract-the-last-names-of-each-congressman-who-co-sponsored-bills." class="section level4 unnumbered">
<h4>Example Task: I need to extract the last names of each congressman who co-sponsored bills.</h4>
<p>Lastly, <code>strsplit()</code> can be used to create a list of all names that have been used in laws, simply by using the <code>-</code> as a separator or delimiter.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">print</span>(matched)</code></pre></div>
<pre><code>## [1] &quot;Dodd-Frank&quot;     &quot;Glass-Steagall&quot; &quot;Sarbanes-Oxley&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  lawnames &lt;-<span class="st"> </span><span class="kw">strsplit</span>(matched, <span class="st">&quot;-&quot;</span>)
  <span class="kw">print</span>(lawnames)</code></pre></div>
<pre><code>## [[1]]
## [1] &quot;Dodd&quot;  &quot;Frank&quot;
## 
## [[2]]
## [1] &quot;Glass&quot;    &quot;Steagall&quot;
## 
## [[3]]
## [1] &quot;Sarbanes&quot; &quot;Oxley&quot;</code></pre>

<p>Note that a list object is not the same as a vector. Lists can contain multiple instances of another class of object. The list returned from <code>strsplit()</code> contains multiple vectors. To access each item, simply refer to the element in the list using an index number. To access the Glass-Steagall objects, we can refer to the 2nd object in <code>[[]]</code>.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  lawnames[[<span class="dv">2</span>]]</code></pre></div>
<pre><code>## [1] &quot;Glass&quot;    &quot;Steagall&quot;</code></pre>

</div>
</div>
<div id="regular-expressions" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Regular Expressions</h3>
<p>Next up: <em>Regex</em>. These powerful commands give users the flexibility to search data and surface results with possible matches. Before proceeding into more complex string combinations, knowledge of a few cleverly designed capabilities may go a long way:</p>
<ol style="list-style-type: decimal">
<li><p>Alternatives (e.g. “OR” searches) can be surfaced by using a pipe “<code>|</code>”. For example, a string search for “Bob or Moe” would be represented as “Bob|Moe”.</p></li>
<li><p>The extent of a search should be denoted by parentheses <code>()</code>. For example, a string search for “Jenny” or an alternative spelling like Jenny would be represented as “Jenn(y|i)”.&quot;</p></li>
<li><p>A search for one specific character should be placed between square brackets <code>[]</code>.</p></li>
<li><p>The number of characters is placed between curly brackets <code>{}</code>.</p></li>
</ol>
<p>In New York City, the famed avenue <em>Broadway</em> is may be written and abbreciated in a number of ways. The vector <code>streets</code> contains a few instances of spellings of Broadway mixed in with other streets that start with the letter <code>B</code>.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#A sampling of street names</span>
  streets &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Bruckner Blvd&quot;</span>, <span class="st">&quot;Bowery&quot;</span>, <span class="st">&quot;Broadway&quot;</span>, <span class="st">&quot;Bway&quot;</span>, <span class="st">&quot;Bdway&quot;</span>, 
        <span class="st">&quot;Broad Street&quot;</span>, <span class="st">&quot;Bridge Street&quot;</span>, <span class="st">&quot;B&#39;way&quot;</span>)
  
<span class="co">#Search for two specific options</span>
  <span class="kw">grep</span>(<span class="st">&quot;Broadway|Bdway&quot;</span>, streets, <span class="dt">value =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] &quot;Broadway&quot; &quot;Bdway&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Search for two variations of Broadway</span>
  <span class="kw">grep</span>(<span class="st">&quot;B(road|&#39;)way&quot;</span>, streets, <span class="dt">value =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] &quot;Broadway&quot; &quot;B&#39;way&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Search for cases where either d or apostrophe are between B and way</span>
  <span class="kw">grep</span>(<span class="st">&quot;B[d&#39;]way&quot;</span>, streets, <span class="dt">value =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] &quot;Bdway&quot; &quot;B&#39;way&quot;</code></pre>

<div id="escaped-characters" class="section level4">
<h4><span class="header-section-number">3.2.2.1</span> Escaped characters</h4>
<p>Quite a few single characters hold a special meaning in addition to the literal meaning. To disambiguate their meaning, a backslash precedes these characters to denote the alternative meaning. A few include:</p>
<ul>
<li><p><code>\n</code>: new line</p></li>
<li><p><code>\r</code>: carriage return</p></li>
<li><p><code>\t</code>: tab</p></li>
<li><p><code>\'</code>: single quote when in a string enclosed in single quotes (<code>'Nay, I can\'t'</code>)</p></li>
<li><p><code>\&quot;</code>: double quote when in a string enclosed in double quotes (<code>&quot;I have a \&quot;guy\&quot;.&quot;</code>)</p></li>
</ul>
<p>In other cases, double backslashes should be used:</p>
<ul>
<li><p><code>\\.</code>: period. Otherwise, un-escaped periods indicate searches for <em>any</em> single character.</p></li>
<li><p><code>\\$</code>: dollar sign. A dollar sign without backslashes indicates to find patterns at the end of a string.</p></li>
</ul>
</div>
<div id="character-classes" class="section level4">
<h4><span class="header-section-number">3.2.2.2</span> Character Classes</h4>
<p>A <em>character class</em> or <em>character set</em> is used to identify specific characters within a string. How would one represent “12.301.1034” or “?!?!?!”? One or more of the following character classes can do the job:</p>
<ul>
<li><p><code>[:punct:]</code>: Any and all punctuation such as periods, commas, semicolons, etc. For specific specific punctuation, simply enclose the characters between two brackets. For example, to find only commas and carrots, use <code>[&lt;&gt;,]</code>.</p></li>
<li><p><code>[:alpha:]</code>: Alphabetic characters such as a, b, c, etc. With other languages including R, it is commonly written as <code>[a-z]</code> for lower case and <code>[A-Z]</code> for upper case.</p></li>
<li><p><code>[:digit:]</code>: Numerical values. With other languages including R, it is commonly written as <code>\\d</code> or <code>[0-9]</code>. For any non-digit, write <code>\\D</code>.</p></li>
<li><p><code>[:alnum:]</code>: Alphanumeric characters (mix of letters and numbers). With other languages including R, it is indicated using to as <code>[0-9A-Za-z]</code> or <code>\\w</code>. For any non-alphanumeric character, use <code>\\W</code>.</p></li>
<li><p><code>[:space:]</code>: Spaces such as tabs, carriage returns, etc. For any white space, use <code>\\s</code>. For any non-whitespace character, use <code>\\S</code>.</p></li>
<li><p><code>[:graph:]</code>: Human readable characters including <code>[:alnum:]</code> and <code>[:punct:]</code>.</p></li>
<li><p><code>\\b</code>: Used to denote “whole words”. <code>\\b</code> should be placed before and after a regex pattern. For example, <code>\\b\\w{10}\\b</code> indicates a 10 letter word.</p></li>
</ul>
<p>There are quite a few character classes not listed above, but for these constitute the lion’s share. It is worth keeping in mind that the implementation of character classes may differ between programming languages. A number of the above are extensions that have been implemented in R in a specific manner.</p>
</div>
<div id="quantifiers" class="section level4">
<h4><span class="header-section-number">3.2.2.3</span> Quantifiers</h4>
<p>Each character class on its own indicates a search for <em>one and only one character</em>. In practice, most character searches will involve a search for more than just one character. To indicate such a search, regex relies on <em>quantifiers</em> to indicate the length of patterns. For example, a search for a year between the year 1980 and 2000 will require exactly four digits, but a search for the speed of a gust of wind will likely vary between 1 and 3 digits. The following six quantifiers provide a degree of both flexibility and specificity to accomplish search tasks:</p>
<ul>
<li><p><code>{n}</code>: match pattern n times for a preceding character class. For example <code>&quot;\\d{4}&quot;</code> looks for a four digit number.</p></li>
<li><p><code>{n, m}</code>: match pattern at least n-times and not more than m times for a preceding character class. For example <code>&quot;\\d{1,4}&quot;</code> looks for one to four digit number.</p></li>
<li><p><code>{n, }</code>: match at least n times for a preceding character class. For example <code>&quot;\\d{4,}&quot;</code> looks for a number that has at least four digits.</p></li>
<li><p><code>*</code>: Wildcard, or match at least 0 times.</p></li>
<li><p><code>+</code>: Match at least once.</p></li>
<li><p><code>?</code>: Match at most once.</p></li>
</ul>
<p>In the example below, quantifiers are used to extract specific number patterns with a high degree of accuracy. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  dates &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Octavian became Augustus on 16 Jan 27 BCE&quot;</span>, 
             <span class="st">&quot;In the year 2000, a computer bug was expected to topple society.&quot;</span>, 
             <span class="st">&quot;In the 5400000000 years, our sun will become a red dwarf.&quot;</span>)
  
<span class="co">#Match an element with a 9 digit number</span>
  <span class="kw">grep</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">d{9}&quot;</span>, dates, <span class="dt">value =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] &quot;In the 5400000000 years, our sun will become a red dwarf.&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Match an element with a 9 digit number</span>
  <span class="kw">grep</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">b</span><span class="ch">\\</span><span class="st">d{4}</span><span class="ch">\\</span><span class="st">b&quot;</span>, dates, <span class="dt">value =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] &quot;In the year 2000, a computer bug was expected to topple society.&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Match a date that follows 16 January 27 BCE</span>
  <span class="kw">grep</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">d{2}</span><span class="ch">\\</span><span class="st">s</span><span class="ch">\\</span><span class="st">w{3}</span><span class="ch">\\</span><span class="st">s</span><span class="ch">\\</span><span class="st">d{2}</span><span class="ch">\\</span><span class="st">s</span><span class="ch">\\</span><span class="st">w{3}&quot;</span>, dates, <span class="dt">value =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] &quot;Octavian became Augustus on 16 Jan 27 BCE&quot;</code></pre>

</div>
<div id="position-matching" class="section level4">
<h4><span class="header-section-number">3.2.2.4</span> Position matching</h4>
<p>Regex builds in functionality to search for patterns based on position of a substring in a string, such as at the start or end of a string. There are quite a few other position matching patterns, but the following two are the workhorses.</p>
<ul>
<li><p><code>$</code>: Search at the end of a string.</p></li>
<li><p><code>^</code>: Start of string when placed at the beginning of a regex pattern.</p></li>
</ul>
<p>To demonstrate these patterns, we’ll apply <code>grep()</code> to three headlines from the BBC.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  headlines &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;May to deliver speech on Brexit&quot;</span>, 
           <span class="st">&quot;Pound falls with May&#39;s comments&quot;</span>, 
           <span class="st">&quot;May: Brexit plans to be laid out in new year&quot;</span>)
  <span class="kw">print</span>(headlines)</code></pre></div>
<pre><code>## [1] &quot;May to deliver speech on Brexit&quot;             
## [2] &quot;Pound falls with May&#39;s comments&quot;             
## [3] &quot;May: Brexit plans to be laid out in new year&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Find elements that contain May at the beginning of the string</span>
  <span class="kw">grep</span>(<span class="st">&quot;^May&quot;</span>, headlines, <span class="dt">value =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] &quot;May to deliver speech on Brexit&quot;             
## [2] &quot;May: Brexit plans to be laid out in new year&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Find elements that contain Brexit at the beginning of the string</span>
  <span class="kw">grep</span>(<span class="st">&quot;Brexit$&quot;</span>, headlines, <span class="dt">value =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] &quot;May to deliver speech on Brexit&quot;</code></pre>

</div>
<div id="exercises" class="section level4">
<h4><span class="header-section-number">3.2.2.5</span> Exercises</h4>
<p>Personally identifiable information or PII is often a barrier to sharing information For the following financial record, anonymize records by removing age and name using <code>gsub()</code> and <code>regmatches()</code> to extract the amount of money John owes the bank.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  statement &lt;-<span class="st"> &quot;John (SSN: 012-34-5678) owes $1004 to the bank at 49-29 Pewter Street.&quot;</span></code></pre></div>


</div>
</div>
</div>
<div id="matrix-and-data-frames" class="section level2">
<h2><span class="header-section-number">3.3</span> Matrix and Data Frames</h2>
<p>Moving onto the macro-scale, individual values of data are often placed within vectors, matrices and data frames. We already know that vectors are a series of values of the same data type (e.g. strings, numerics, booleans) and matrices are vectors but in two dimensions (<span class="math inline">\(n \times m\)</span> dimensions). Data frames are a generalization of matrices that allow for each column of data to hold different data types as well as refer to individual columns by a user-specified name.</p>
<p><em>When should each matrices and data frames be used?</em> From a pure logistical perspective, data frames are more flexible with respect to its ability to store multiple data types. Some code libraries are built specifically for matrices and others for data frames. Ultimately, it is up to the data scientist to choose.</p>
<table>
<colgroup>
<col width="12%" />
<col width="41%" />
<col width="45%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Matrices</th>
<th>Data Frames</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Pros</td>
<td>Memory efficient. Good for advanced mathematical operations.</td>
<td>Store mixed types of data types. Allows user to refer to columns by an explicit name.</td>
</tr>
<tr class="even">
<td>Cons</td>
<td>Able to store one data type at a time – leads to slightly more work required to manage multiple matrices. Columns can only be referred to by index number.</td>
<td>Not as memory efficient.</td>
</tr>
</tbody>
</table>
<p>In this section, we review among the most powerful functions for data manipulation: <code>sort</code>, <code>reshape</code>, <code>collapse</code>, and <code>merge</code>. A mastery of the logic and operations that guide matrix and data frame processing opens the possibilities to work with virtually any kind of data. To illustrate this, consider a data frame with a list of the top 25 male long jumpers and top 25 female long jumpers as found on <a href="https://en.wikipedia.org/wiki/Long_jump#All-time_top_25_athletes">Wikipedia</a>. Each row contains information about one athlete such as with their record-setting longest jump, date of jump, location of jump among other features. Imagine the sort of tasks that one could do to munged the data into a usable shape.</p>
<p>Note that data can be obtained directly from this URL (<a href="https://s3.amazonaws.com/dspp/long_jump_top25.csv" class="uri">https://s3.amazonaws.com/dspp/long_jump_top25.csv</a>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  jumps &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://s3.amazonaws.com/dspp/long_jump_top25.csv&quot;</span>)
  <span class="kw">print</span>(jumps)</code></pre></div>
<p>or alternatively using the <code>digIt()</code> function designed for this textbook.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">library</span>(digIt)
  jumps &lt;-<span class="st"> </span><span class="kw">digIt</span>(<span class="st">&quot;long_jump_top25&quot;</span>)
  <span class="kw">print</span>(jumps)</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-81">Table 3.5: </span>Example records from long jump data set</caption>
<thead>
<tr class="header">
<th align="left">sex</th>
<th align="left">rank</th>
<th align="left">athlete</th>
<th align="left">mark.meters</th>
<th align="left">date</th>
<th align="left">place</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">male</td>
<td align="left">1</td>
<td align="left">Mike Powell</td>
<td align="left">8.95</td>
<td align="left">30 August 1991</td>
<td align="left">Tokyo</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="left">2</td>
<td align="left">Bob Beamon</td>
<td align="left">8.9</td>
<td align="left">18 October 1968</td>
<td align="left">Mexico City</td>
</tr>
<tr class="odd">
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">female</td>
<td align="left">14</td>
<td align="left">Ivana Španović</td>
<td align="left">7.24</td>
<td align="left">5 March 2017</td>
<td align="left">Belgrade</td>
</tr>
<tr class="even">
<td align="left">female</td>
<td align="left">16</td>
<td align="left">Helga Radtke</td>
<td align="left">7.21</td>
<td align="left">26 July 1984</td>
<td align="left">Dresden</td>
</tr>
</tbody>
</table>
<div id="indices-and-subsetting" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Indices and Subsetting</h3>
<p>In both matrices and data frames, individual and ranges of rows and columns can be extracted by calling their index number. The jumps data contains <span class="math inline">\(n = 51\)</span> rows and <span class="math inline">\(k = 6\)</span> features for a total of <span class="math inline">\(306\)</span> data elements. Each row and each feature has a unique index number that starts from <span class="math inline">\(1\)</span> and increases sequentially. In other programming languages, index numbers start from <span class="math inline">\(0\)</span>.</p>
<p><strong><em>To extract the second row</em></strong> from <code>jumps</code>, we simply type the number <code>2</code> before the commaa in square brackets. The line below essentially indicates that given a matrix or data frame, extract the second row and all columns.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  jumps[<span class="dv">2</span>,]</code></pre></div>
<pre><code>##    sex rank     athlete mark.meters            date       place
## 2 male    2 Bob Beamon          8.9 18 October 1968 Mexico City</code></pre>

<p>To <strong><em>extract multiple records by row index</em></strong> depends on whether the request is sequential or piecemeal. Below, the first line extracts a range of rows from the 2nd through 4th rows in <code>jumps</code>, whereas the second extracts two non-overlapping ranges that are included in a vector.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  jumps[<span class="dv">2</span>:<span class="dv">4</span>, ] <span class="co"># apply the index range to extract rows</span>
  jumps[<span class="kw">c</span>(<span class="dv">1</span>:<span class="dv">2</span>,<span class="dv">10</span>:<span class="dv">11</span>), ] <span class="co"># specific indices</span></code></pre></div>

<p>The same notation can be used <strong><em>to extract all athlete names for all records</em></strong> by typing the number <code>3</code> after the comma in square brackets. The number 3 is the column index that contains <code>athlete</code> names. <em>Keep in mind that extracting one column from a matrix or data frame results in a vector – the data structure is not retained</em>.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  jumps[, <span class="dv">3</span>] </code></pre></div>

<p>In addition, data frames provide a few additional methods of extracting the <code>athlete</code> column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  jumps[, <span class="st">&quot;athlete&quot;</span>] <span class="co"># extract column with &quot;athlete&quot; label</span>
  jumps[[<span class="st">&quot;athlete&quot;</span>]] <span class="co"># list syntax to extract column from data frame</span>
  jumps$athlete <span class="co">#compact version of data column manipulation</span></code></pre></div>
<p>To <strong><em>extract two or more columns</em></strong> follows a familiar pattern, making use of either a range of column indices or a vector of column names. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  jumps[, <span class="dv">3</span>:<span class="dv">4</span>] <span class="co"># extract multiple columns</span>
  jumps[, <span class="kw">c</span>(<span class="st">&quot;athlete&quot;</span>, <span class="st">&quot;mark.meters&quot;</span>)] <span class="co"># multiple column labels</span></code></pre></div>

<p>To <strong><em>extract rows that meet one specific criterion</em></strong> requires the creation of either a vector of booleans than indicate if the criterion is <code>TRUE</code> or <code>FALSE</code> for each row (logical vector has the same number of rows as the data), or a list of row index numbers that meet the criterion. The example below performs operations on a data frame. </p>
<p><strong><em>Example 1</em></strong>: Create a vector of booleans over 8.8 meters, then select rows based on whether a row contains a <code>TRUE</code> value. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  group1 &lt;-<span class="st"> </span>jumps$mark.meters &gt;<span class="st"> </span><span class="fl">8.8</span> <span class="co"># return vector of booleans for jumps over 8.8 meters</span>
  jumps[group1, ] <span class="co"># select the indices</span></code></pre></div>

<p><strong><em>Example 2</em></strong>: Find row indices that contain the place “Eugene”, then use the vector of matching row indices to extract rows from <code>jumps</code>.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  group2 &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;Eugene&quot;</span>, jumps$place)
  jumps[group2, ] </code></pre></div>

<p><strong><em>Example 3</em></strong>: Find record setting jumps in Tokyo, Mexico City and New York City using the <code>%in%</code> operator.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Find place in vector of cities</span>
  group3 &lt;-<span class="st"> </span>jumps$place %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;New York City&quot;</span>, <span class="st">&quot;Mexico City&quot;</span>, <span class="st">&quot;Tokyo&quot;</span>)

<span class="co">#Return matching entries </span>
  jumps[group3, ]
  
<span class="co">#Return non-matching entries</span>
  jumps[!group3, ]</code></pre></div>

<p><strong><em>Extract rows that meet two criteria</em></strong> is as simple as using logical operators. To search for two non-overlapping criteria, the pipe operator <code>&quot;|&quot;</code> should be used to represent <em>OR</em>, whereas <code>&quot;&amp;&quot;</code> represents <em>AND</em>.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Find athletes who jumped beyond 8.9m or below 7.2m</span>
  group2 &lt;-<span class="st"> </span>(jumps$mark.meters &gt;<span class="st"> </span><span class="fl">8.8</span>) |<span class="st"> </span>(jumps$mark.meters &lt;<span class="st"> </span><span class="fl">7.2</span>)
  jumps[group2, ] <span class="co"># select the indices</span></code></pre></div>

<p><strong><em>Rows and columns can be re-ordered</em></strong> simply by enumerating indices in a specified order. For example, columns can be re-ordered by passing a vector of column indices into a data frame.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Original order</span>
  <span class="kw">colnames</span>(jumps)</code></pre></div>
<pre><code>## [1] &quot;sex&quot;         &quot;rank&quot;        &quot;athlete&quot;     &quot;mark.meters&quot; &quot;date&quot;       
## [6] &quot;place&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Reorder according vector of column indices</span>
  jumps &lt;-<span class="st"> </span>jumps[, <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">5</span>)]
  
<span class="co">#Check new order</span>
  <span class="kw">colnames</span>(jumps)</code></pre></div>
<pre><code>## [1] &quot;rank&quot;        &quot;mark.meters&quot; &quot;athlete&quot;     &quot;place&quot;       &quot;sex&quot;        
## [6] &quot;date&quot;</code></pre>
<p>To <strong><em>sort a column</em></strong> can be done using <code>order()</code>, which returns a vector of row indicies in ascending order. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">order</span>(jumps$mark.meters)</code></pre></div>
<pre><code>##  [1] 49 50 51 47 48 43 44 45 46 41 42 39 40 38 37 34 35 36 33 32 31 30 29
## [24] 28 27 26 24 25 22 23 21 19 20 17 18 16 15 14 13 12 11  9 10  8  5  6
## [47]  7  4  3  2  1</code></pre>

<p>This simple function can be included in the rows index to sort a entire data frame. To sort descending, add a <code>&quot;-&quot;</code> before the feature to be sorted. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  jumps[<span class="kw">order</span>(jumps$mark.meters), ] <span class="co"># order records by mark.meters</span>
  jumps[<span class="kw">order</span>(-jumps$mark.meters), ] <span class="co"># order records by mark.meters, decreasing</span>
  jumps[<span class="kw">order</span>(jumps$mark.meters, <span class="dt">decreasing=</span><span class="ot">TRUE</span>), ]<span class="co"># order records by mark.meters, decreasing</span></code></pre></div>

<p>To <strong><em>sort on multiple columns</em></strong> is a matter of adding additional fields separated by commas. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># first by rank, then sex, then place</span>
  jumps[<span class="kw">order</span>(jumps$rank, jumps$sex, jumps$place), ] 

 <span class="co"># first desc. by rank, then sex, then place</span>
  jumps[<span class="kw">order</span>(-jumps$rank, jumps$sex,  jumps$place), ]</code></pre></div>

<div id="exercises-1" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>Extract records with female athletes who are ranked greater than rank #10.</li>
<li>Extract records with jump marks greater than 7.250 meters and less than 8.625 meters.</li>
</ol>
</div>
</div>
<div id="reshape" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Reshape</h3>
<p>Data usually takes on two basic <em>shapes</em>: <strong>wide</strong> and <strong>long</strong>. The data frame in the previous section is in <strong>long</strong> format in which each row represents an individual that is ranked among the top 25 within each sex. Each row has a value (<code>mark.meters</code>) associated with the characteristics that make that row unique (<code>athlete</code>, <code>place</code>, <code>rank</code>, <code>sex</code>, <code>date</code>).</p>
<p>We will find that the <strong>wide</strong> form is also useful. For those who have familiarity with spreadsheet software, reshaping data essentially is the functionality behind a pivot table. Some features can be used to identify rows and others features can be used to stratify the data by discrete bins. The <code>reshape()</code> function can be used to convert a data frame such that each row contains values for each rank (1 to 25) placing the distance jumped by each sex in separate columns.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">reshape</span>(&lt;data&gt;, 
          <span class="dt">idvar =</span> &lt;ID variables&gt;,
          <span class="dt">timevar =</span> &lt;column variables&gt;,
          <span class="dt">direction =</span> &lt;direction&gt;)</code></pre></div>

<ul>
<li><code>&lt;data&gt;</code> is the data set</li>
<li><code>&lt;ID variables&gt;</code> is a variable or a combination of variables that serves as a unique identifier for each row</li>
<li><code>&lt;column variables&gt;</code> is a variable that will be used to define multiple measurements per row</li>
<li><code>&lt;direction&gt;</code> indicates if the data will be converted into long or wide form.</li>
</ul>
<p>To illustrate <code>reshape()</code>, the data is whittled down to a three feature set containing <code>rank</code>, <code>sex</code> and <code>mark.meters</code>. These features are then input into the <code>reshape()</code> to convert a long form data set into wide form.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  example &lt;-<span class="st">  </span>jumps[, <span class="kw">c</span>(<span class="st">&quot;rank&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;mark.meters&quot;</span>)]
  wide &lt;-<span class="st"> </span><span class="kw">reshape</span>(example, 
          <span class="dt">idvar =</span> <span class="st">&quot;rank&quot;</span>, <span class="dt">timevar =</span> <span class="st">&quot;sex&quot;</span>, <span class="dt">direction =</span> <span class="st">&quot;wide&quot;</span>)
  <span class="kw">head</span>(wide, <span class="dv">5</span>)</code></pre></div>
<pre><code>##   rank mark.meters.male mark.meters.female
## 1    1             8.95               7.52
## 2    2             8.90               7.49
## 3    3             8.87               7.48
## 4    4             8.86               7.43
## 5    5             8.74               7.42</code></pre>

<p>There are now 21 rows, where there were previously 51. Returning to the original <strong>long</strong> format is straightforward; but we aren’t left with the exact same data table. There are artifacts of the change-in-shape for both the column and row names. Sort of like data manipulation breadcrumbs. This will be cleaned up in the next subsection.</p>
<div id="rename-row-and-column-headers" class="section level4 unnumbered">
<h4>Rename row and column headers</h4>
<p>The newly assigned column or row names may not match the meaning in the data. It is good practice to maintain the column headers at each stage of analysis, even if you don’t immediately use the intermediate data table. Otherwise editing code gets confusing, quickly. The column names are stored in an attribute of the data frame:</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Two ways of obtaining data frame field names</span>
  <span class="kw">names</span>(wide)</code></pre></div>
<pre><code>## [1] &quot;rank&quot;               &quot;mark.meters.male&quot;   &quot;mark.meters.female&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">colnames</span>(wide)</code></pre></div>
<pre><code>## [1] &quot;rank&quot;               &quot;mark.meters.male&quot;   &quot;mark.meters.female&quot;</code></pre>

<p>Renaming column headers using the built-in, base functions in <code>R</code> looks confusing. In words, the following code identifies the positions in <code>names(wide)</code> where the values are <code>mark.meters.male</code> and <code>mark.meters.female</code>. At the specified positions, the values is reassigned with new values <code>male.mark</code> and <code>female.mark</code>, respectively.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">names</span>(wide)[<span class="kw">names</span>(wide) ==<span class="st"> &quot;mark.meters.male&quot;</span>] &lt;-<span class="st"> &quot;male.mark&quot;</span>
  <span class="kw">names</span>(wide)[<span class="kw">names</span>(wide) ==<span class="st"> &quot;mark.meters.female&quot;</span>] &lt;-<span class="st"> &quot;female.mark&quot;</span>
  <span class="kw">head</span>(wide, <span class="dv">5</span>)</code></pre></div>
<pre><code>##   rank male.mark female.mark
## 1    1      8.95        7.52
## 2    2      8.90        7.49
## 3    3      8.87        7.48
## 4    4      8.86        7.43
## 5    5      8.74        7.42</code></pre>

<p>Alternatively, groups of fields can be renamed based on the index position in the names list. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">colnames</span>(wide)[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;rank.num&quot;</span>, <span class="st">&quot;female.mark&quot;</span>)</code></pre></div>

</div>
</div>
<div id="collapse" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Collapse</h3>
<p>Reshape and collapse are often used in conjunction in order to calculate summary statistics by group. The <code>aggregate()</code> function is the workhorse for summarizing data. It accepts three arguments:</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">aggregate</span>(&lt;x&gt;, <span class="dt">by =</span> <span class="kw">list</span>(&lt;groups&gt;), <span class="dt">FUN =</span> &lt;function&gt;)<span class="er">)</span></code></pre></div>

<ul>
<li><code>&lt;function&gt;</code> is the specific function that will be applied to the data. Commonly used functions included <code>mean</code>, <code>sum</code>, <code>length</code> (count), <code>sd</code> (standard deviation), among others.</li>
<li><code>&lt;x&gt;</code> is the R object on which the function will be applied. This generally should be a numerical value.</li>
<li><code>&lt;groups&gt;</code> is a variable that contains groups for which the mathematical function will be calculated. This needs to be provided as a <code>list()</code>.</li>
</ul>
<p>Consider this function to <strong><em>estimate the jump distance average by sex</em></strong>. To arrive at the answer, we will collapse the data frame by <code>sex</code> to create a new data frame with the average jump distance by sex. Notice that the group variable can be named within the list and the number of observations is reduced to only two.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(out &lt;-<span class="st"> </span><span class="kw">aggregate</span>(jumps$mark.meters, <span class="dt">by =</span> <span class="kw">list</span>(<span class="dt">athlete.sex =</span> jumps$sex), <span class="dt">FUN =</span> mean))</code></pre></div>
<pre><code>##   athlete.sex      x
## 1      female 7.2850
## 2        male 8.6588</code></pre>

<p>How about tabulations? <strong><em>count medals by country</em></strong></p>
<p><br />
Note that data can be obtained directly from this URL (<a href="https://s3.amazonaws.com/whoa-data/long_jump_olympics.csv" class="uri">https://s3.amazonaws.com/whoa-data/long_jump_olympics.csv</a>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  jumps &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://s3.amazonaws.com/whoa-data/long_jump_olympics.csv&quot;</span>)
  <span class="kw">print</span>(jumps)</code></pre></div>
<p>or alternatively using the <code>digIt()</code> function designed for this textbook.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  olympics &lt;-<span class="st"> </span><span class="kw">digIt</span>(<span class="st">&quot;long_jump_olympics&quot;</span>)
  <span class="kw">head</span>(olympics,<span class="dv">3</span>)</code></pre></div>

<p>The USA had won 56 olympic long jump medals through 2017. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  cty_medals &lt;-<span class="st"> </span><span class="kw">aggregate</span>(olympics$country, <span class="dt">by =</span> <span class="kw">list</span>(<span class="dt">country =</span> olympics$country), <span class="dt">FUN =</span> length)
  <span class="kw">head</span>(cty_medals[<span class="kw">order</span>(-cty_medals$x),], <span class="dv">3</span>)</code></pre></div>
<pre><code>##    country  x
## 33     USA 56
## 32     URS 12
## 12     GBR  8</code></pre>
<p></p>
<p>The built-in <code>R</code> functions are effective, but new, memory efficient libraries have arisen to augment <code>R</code>’s capabilites.</p>
<div id="exercises-2" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>Load the <a href="http://stat.ethz.ch/R-manual/R-devel/library/datasets/html/iris.html"><code>iris</code></a> dataset using the <code>datasets</code> package. Calculate the average and maximum sepal length for each Iris species. (<strong>Bonus</strong>: Write the commands without error messages.)</li>
<li>Use the <code>aggregate()</code> function to count the number of observations of sepal width for each species.</li>
<li>(<em>Difficult</em>) Create a data frame with the 35th observation of sepal width for each species.</li>
</ol>
</div>
</div>
<div id="join" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Join</h3>
<p>Joining is one of the most critical steps in a data analytics project as it allows one data set to be augmented by another.</p>
<p><img src="assets/manipulation/img/key.jpg" alt="Join terminology" /> </p>
<div class="figure">
<img src="assets/manipulation/img/join_types.jpg" alt="Types of joins" />
<p class="caption">Types of joins</p>
</div>
<p></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">merge</span>(x, y, <span class="dt">by =</span> ids, <span class="dt">all.x =</span> <span class="ot">TRUE</span>, <span class="dt">all.y =</span> <span class="ot">TRUE</span>)<span class="er">)</span></code></pre></div>

<ul>
<li><code>x</code> is the left-hand side data frame;</li>
<li><code>y</code> is the right-hand side data frame;</li>
<li><code>by = ids</code> is a string vector of variable names to be joined. Note that this is used when the variable names are identical in both <code>x</code> and <code>y</code>. If column names are different, use <code>by.x</code> to specify <code>x</code> column names and <code>by.y</code> for <code>y</code> column names.</li>
<li><code>all.x</code> and <code>all.y</code> are logical parameters (<code>TRUE</code>/<code>FALSE</code>) that control the type of join:</li>
<li><em>Inner join</em>: By default, both parameters are set to <code>FALSE</code>.</li>
<li><em>Left outer join</em>: set <code>all.x = TRUE</code>.</li>
<li><em>Right outer join</em>: set <code>all.y = TRUE</code>.</li>
<li><em>Outer join</em>: set <code>all.x = TRUE</code> and <code>all.y = TRUE</code> .</li>
</ul>
<p>To illustrate the power of joins, we apply basic data manipulation to answer a few exploratory questions.</p>
<p><strong><em>Which of the top 25 athletes hold an Olympic medal?</em></strong> This can be done by a left join.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Aggregate number of medals by athlete</span>
  medals &lt;-<span class="st"> </span><span class="kw">aggregate</span>(olympics$country, 
                      <span class="dt">by =</span> <span class="kw">list</span>(<span class="dt">athlete =</span> olympics$athlete), 
                      <span class="dt">FUN =</span> length)

<span class="co">#Join jumps with medals</span>
  inner_join &lt;-<span class="st"> </span><span class="kw">merge</span>(<span class="dt">x =</span> jumps[, <span class="kw">c</span>(<span class="st">&quot;athlete&quot;</span>,<span class="st">&quot;mark.meters&quot;</span>)], 
                      <span class="dt">y =</span> medals, 
                      <span class="dt">by =</span> <span class="st">&quot;athlete&quot;</span>)
  
<span class="co">#See top 10</span>
  <span class="kw">head</span>(inner_join[!<span class="kw">is.na</span>(inner_join$x), ], <span class="dv">10</span>)</code></pre></div>
<pre><code>##                athlete mark.meters x
## 1          Bob Beamon         8.90 1
## 2      Brittney Reese         7.31 1
## 3          Carl Lewis         8.87 4
## 4     Dwight Phillips         8.74 1
## 5  Galina Chistyakova         7.52 1
## 6     Greg Rutherford         8.51 2
## 7     Heike Drechsler         7.48 3
## 8      Inessa Kravets         7.37 1
## 9     Irina Meleshina         7.27 1
## 10    Irving Saladino         8.73 1</code></pre>

<p><strong><em>How many of the 51 top long jumpers did not earn an Olympic medal?</em></strong> Left outer join by specifying <code>all.x = TRUE</code> to keep all left side values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Merge</span>
  left_outer &lt;-<span class="st"> </span><span class="kw">merge</span>(<span class="dt">x =</span> jumps[, <span class="kw">c</span>(<span class="st">&quot;athlete&quot;</span>,<span class="st">&quot;mark.meters&quot;</span>)], 
                      <span class="dt">y =</span> medals, 
                      <span class="dt">by =</span> <span class="st">&quot;athlete&quot;</span>, 
                      <span class="dt">all.x =</span> <span class="ot">TRUE</span>)

<span class="co">#Print the number of rows </span>
  <span class="kw">nrow</span>(left_outer[<span class="kw">is.na</span>(left_outer$x), ])</code></pre></div>
<pre><code>## [1] 27</code></pre>

<p><strong><em>How many Olympic medalists are not on the top 25 list?</em></strong> Right outer join by specifying <code>all.y = TRUE</code> to keep all right side values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Merge</span>
  right_outer &lt;-<span class="st"> </span><span class="kw">merge</span>(<span class="dt">x =</span> jumps[, <span class="kw">c</span>(<span class="st">&quot;athlete&quot;</span>,<span class="st">&quot;mark.meters&quot;</span>)], 
                       <span class="dt">y =</span> medals, 
                       <span class="dt">by =</span> <span class="st">&quot;athlete&quot;</span>, 
                       <span class="dt">all.y =</span> <span class="ot">TRUE</span>)

<span class="co">#Print the number of rows </span>
  <span class="kw">nrow</span>(right_outer[<span class="kw">is.na</span>(right_outer$mark.meters), ])</code></pre></div>
<pre><code>## [1] 93</code></pre>
<div id="exercises-3" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>The <code>datasets</code> library is a base package in R that contains a number of data sets for learning and practice. Use the <code>state</code> datasets (take a look at the <a href="http://stat.ethz.ch/R-manual/R-devel/library/datasets/html/state.html">documentation</a>) to calculate identify the state division (e.g. New England) that the state with the highest murder rate.</li>
<li>What was the recorded population by region?</li>
</ol>
<p><strong>Answers</strong>.</p>
<ol style="list-style-type: decimal">
<li><em>Aggregate, then sort</em>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Set data as a data frame</span>
  df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(state.x77)

<span class="co">#Roll up by division, calculating max</span>
out &lt;-<span class="st"> </span><span class="kw">aggregate</span>(df$Murder, 
                 <span class="dt">by =</span> <span class="kw">list</span>(state.division),
                 <span class="dt">FUN =</span> max)

<span class="co">#Re-order</span>
  out &lt;-<span class="st"> </span>out[<span class="kw">order</span>(-out[,<span class="dv">2</span>]), ]
  out[<span class="dv">1</span>, ]</code></pre></div>
<pre><code>##              Group.1    x
## 4 East South Central 15.1</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><em>Aggregate</em>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Set data as a data frame</span>
  df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(state.x77)

<span class="co">#Roll up by division, calculating max</span>
out &lt;-<span class="st"> </span><span class="kw">aggregate</span>(df$Population, 
                 <span class="dt">by =</span> <span class="kw">list</span>(state.region),
                 <span class="dt">FUN =</span> sum)
out</code></pre></div>
<pre><code>##         Group.1     x
## 1     Northeast 49456
## 2         South 67330
## 3 North Central 57636
## 4          West 37899</code></pre>

</div>
</div>
</div>
<div id="control-structures" class="section level2">
<h2><span class="header-section-number">3.4</span> Control Structures</h2>
<p>Much of data science requires developing specialized code to handle the eccentricities of a dataset. Re-running blocks of code is required, often times on multiple data samples and subpopulations. It’s simply not scalable to manually change variables and assumptions of the code everytime.</p>
<p>Variables are typically treated differently based on their quality and characteristics. In order to accomplish analytical and programming tasks, control structures are used to determine how a program will treat a given variable given conditions and parameters. In this section, we will cover two commonly used control structures: if…else statements and for loops.</p>
<div id="if-and-ifelse-statement" class="section level3">
<h3><span class="header-section-number">3.4.1</span> If and If…Else Statement</h3>
<p>If statements evaluate a logical statement, then execute a script based on whether the evaluated statement is true or false. If the statement is <code>TRUE</code>, then the code block is executed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  budget &lt;-<span class="st"> </span><span class="dv">450</span>
  if(budget &gt;<span class="st"> </span><span class="dv">400</span>){
    <span class="co">#If statement true, run script goes here</span>
    <span class="kw">print</span>(<span class="st">&quot;You&#39;re over budget. Cut back.&quot;</span>)
  }</code></pre></div>
<pre><code>## [1] &quot;You&#39;re over budget. Cut back.&quot;</code></pre>
<p>In cases where there are two or more choices, if…else statements would be appropriate. In addition to the <code>if()</code> statement, an <code>else</code> statement is included to handle cases where the logical statement is <code>FALSE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  budget &lt;-<span class="st"> </span><span class="dv">399</span>  
  if(budget &gt;=<span class="st"> </span><span class="dv">400</span>){
    <span class="co">#If statement true, run script goes here</span>
    <span class="kw">print</span>(<span class="st">&quot;You&#39;re over budget. Cut back.&quot;</span>)
  } else {
    <span class="co">#else, run script goes here</span>
    <span class="kw">print</span>(<span class="st">&quot;You&#39;re under budget, but watch it.&quot;</span>)
  }</code></pre></div>
<p>The complexity of these statements can be as simple as <code>if(x &gt; 10){ print(&quot;Hello&quot;)}</code> more complex trees:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  age &lt;-<span class="st"> </span><span class="dv">23</span>
    
  if(age &lt;=<span class="st"> </span><span class="dv">12</span>){
      <span class="kw">print</span>(<span class="st">&quot;kid&quot;</span>)
    } else if(age &gt;<span class="dv">12</span> &amp;&amp;<span class="st"> </span>age &lt;<span class="dv">20</span>) {
      <span class="kw">print</span>(<span class="st">&quot;teenager&quot;</span>)
    } else if(age &gt;=<span class="dv">20</span> &amp;&amp;<span class="st"> </span>age &lt;<span class="dv">65</span>) {
      <span class="kw">print</span>(<span class="st">&quot;adult&quot;</span>)
    } else{
      <span class="kw">print</span>(<span class="st">&quot;senior&quot;</span>)
    }</code></pre></div>
<pre><code>## [1] &quot;adult&quot;</code></pre>
</div>
<div id="for-loops" class="section level3">
<h3><span class="header-section-number">3.4.2</span> For-loops</h3>
<p>Loops can be used to run the a given statement of code multiple times for a specified number of times or a list of index value. This is a functionality that is available in most programming languages, but the programming syntax will be different. Conceptually, for loops can be likened to an assembly line in a car factory. In order to build a car, a series of well-defined, well-timed processes need to coordinated in a serial fashion. To build 500 cars, the process needs to be executed 500 times. For-loops are essentially the same: Given a well-defined, self-contained process, a process can be be iterativelyapplied to address repetive tasks.</p>
<p>Let’s take the following example. The code block essentially says “print values for the range of 1 through 5”, where <code>i</code> is an <em>index value</em>. When executing the statement, R will push the first value in the sequence of 1:5 into the index (in this case, it’s the number 1), then the code block in between the <code>{}</code> (curly brackets) will be executed, treating <code>i</code> as if it’s the number 1. Upon executing the code without error, R will advance to the next value in the sequence and repeat the process until all values in the sequence have been completed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  for(i in <span class="dv">1</span>:<span class="dv">5</span>){
    <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Car #&quot;</span>, i))
  }</code></pre></div>
<pre><code>## [1] &quot;Car #1&quot;
## [1] &quot;Car #2&quot;
## [1] &quot;Car #3&quot;
## [1] &quot;Car #4&quot;
## [1] &quot;Car #5&quot;</code></pre>
<p>We can do the same for a vector or list of values. In the example below, the vector <code>news</code> contains six terms. Using a for-loop, we can print out each word in the vector.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  news &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;The&quot;</span>,<span class="st">&quot;Dow&quot;</span>,<span class="st">&quot;Is&quot;</span>,<span class="st">&quot;Up&quot;</span>,<span class="st">&quot;By&quot;</span>,<span class="st">&quot;400pts&quot;</span>)
  for(i in news){
    <span class="kw">print</span>(i)
  }</code></pre></div>
<pre><code>## [1] &quot;The&quot;
## [1] &quot;Dow&quot;
## [1] &quot;Is&quot;
## [1] &quot;Up&quot;
## [1] &quot;By&quot;
## [1] &quot;400pts&quot;</code></pre>
<p>For-loops has a few qualities that users should be aware. First, what happens within the for-loop is written to the R environment as <em>global variables</em>. That means that any object (e.g. calculations, models) that is created in the loop will be accessible in the programming enviromment even after the loop ends. This may be a good or bad, depending on the use case: Good if one wants to keep copies of the intermediate results of a loop iteration, but bad if the user is not careful to take note of the potential floor of extraneous objects that may effect downstream calculations. Second, one of the most common mistakes when using loops is failing to record the result of the loop. There are functions in R that are designed to log and package results from loops, but in plain vanilla loops, this is not the case.</p>
<p><strong>A common paradigm</strong> with for-loops is to iteratively execute repetitive tasks. For example, if a calculation needed to be applied to each of one million files and the results need to be logged, then for-loops are a good option. Typically, the paradigm proceeds as follows:</p>
<ol style="list-style-type: decimal">
<li>Create placeholder object (e.g. a vector, matrix, or data frame);</li>
<li>Initialize loop; and</li>
<li>Add outputs to placeholder at the end of each loop iteration.</li>
</ol>
<p>This may be applied in a broad variety of cases such as processes each data set in a repository of many large data sets, calculating complex statistics for various strata and subsets within the data, among others. Best practices with loops start with initializing new placeholder objects to full length before the loop rather than increasing the object size within the loop<a href="#fn25" class="footnoteRef" id="fnref25"><sup>25</sup></a>. In R, this is particularly important issue for efficient data processing.</p>
<p>In the example below, we would like to calculate the minimum and maximum of each of 1000 randomly generated normal distributions with <span class="math inline">\(\mu = 1000\)</span> and <span class="math inline">\(\sigma = 10\)</span>. To do this, a placeholder data frame <code>x</code> with three columns (iteration, min and max) is created with <span class="math inline">\(n = 1000\)</span> rows for each of the random distributions to be generated. Then, we use <code>Sys.time()</code> to capture when the loop starts and end – a common practice for optimizing code. The loop is initiated for 1 to 1000 iterations to calculate the mininum and maximum. At the end of each iteration, the min and max results are overwritten to the row that corresponds to the iteration in the placeholder <code>x</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Set placeholder data frame with n rows</span>
  n &lt;-<span class="st"> </span><span class="dv">1000</span>
  x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">iteration =</span> <span class="dv">1</span>:n, 
                  <span class="dt">min =</span> <span class="kw">numeric</span>(n), 
                  <span class="dt">max =</span> <span class="kw">numeric</span>(n))

<span class="co">#Loop</span>
  start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
  for(i in <span class="dv">1</span>:n){
    y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10000</span>, <span class="dv">1000</span>, <span class="dv">10</span>)
    x$min[i] &lt;-<span class="st"> </span><span class="kw">min</span>(y)
    x$max[i] &lt;-<span class="st"> </span><span class="kw">max</span>(y)
  }
  <span class="kw">Sys.time</span>() -<span class="st"> </span>start</code></pre></div>
<pre><code>## Time difference of 0.95297 secs</code></pre>
<p>The above process required roughly 0.8 seconds to process. <em>What happens if the placeholder length were not pre-specified?</em> For the given parameters, the task normally may last between 1.2 and 1.5 seconds. This may not seem to be much time, but at scale with millions if not billions of records and iterations, the time does tend to add up.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Set placeholder data frame without dimensions</span>
  n &lt;-<span class="st"> </span><span class="dv">1000</span>
  x &lt;-<span class="st"> </span><span class="kw">data.frame</span>()

<span class="co">#Loop</span>
  start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
  for(i in <span class="dv">1</span>:n){
    <span class="kw">set.seed</span>(i)
    y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10000</span>, <span class="dv">1000</span>, <span class="dv">10</span>)
    x &lt;-<span class="st"> </span><span class="kw">rbind</span>(x, <span class="kw">cbind</span>(<span class="dt">iteration =</span> i, 
                  <span class="dt">min =</span> <span class="kw">min</span>(y), 
                  <span class="dt">max =</span> <span class="kw">max</span>(y)))
  }
  <span class="kw">Sys.time</span>() -<span class="st"> </span>start</code></pre></div>
<pre><code>## Time difference of 1.356999 secs</code></pre>
<div id="r-specific-apply" class="section level4">
<h4><span class="header-section-number">3.4.2.1</span> R-specific: <code>apply</code></h4>
<p>For-loops are common across all languages, but the efficiency of their implementation will vary. As was described in the previous chapter, R is an interpretted language optimized for mathematical and statistical calculation – quite different than other languages. This means that programming in R is most optimal when vectorizing calculation – linear algebra calculations of vectors and matrices using operations such as <code>+</code>, <code>-</code>, <code>*</code>, <code>%*%</code>, among others.</p>
<p>In R, the speed of for-loops may be improved using <code>lapply()</code> under certain circumstances. <code>lapply()</code>, or <em>list apply</em> Whereas the intermediate objects in for-loops are global variables, <code>lapply()</code> creates temporary <em>local variables</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Set n</span>
  n &lt;-<span class="st"> </span><span class="dv">1000</span>

<span class="co">#Loop</span>
  start &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
  x &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dv">1</span>:n, function(i){
     y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10000</span>, <span class="dv">1000</span>, <span class="dv">10</span>)
     <span class="kw">return</span>(<span class="kw">cbind</span>(<span class="dt">iteration =</span> i, 
                  <span class="dt">min =</span> <span class="kw">min</span>(y), 
                  <span class="dt">max =</span> <span class="kw">max</span>(y)))
  })
  x &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, x)
  <span class="kw">Sys.time</span>() -<span class="st"> </span>start</code></pre></div>
<pre><code>## Time difference of 0.808532 secs</code></pre>
</div>
</div>
<div id="while" class="section level3">
<h3><span class="header-section-number">3.4.3</span> While</h3>
<p>Whereas for loops require a range or list of values through which to iterate, <code>while()</code> statements keep iterating until some condition is met. The <code>while()</code> statement is formulated as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  while([condition is true]){
    
    [execute this statement]
    
  }</code></pre></div>
<p>A simple case may involve drawing a random value <span class="math inline">\(x\)</span> from a normal distribution (<span class="math inline">\(\mu = 1.0\)</span>, <span class="math inline">\(\sigma = 0.5\)</span>) while <span class="math inline">\(x\)</span> is greater than 0.01.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  x &lt;-<span class="st"> </span><span class="dv">1</span>
  while(x &gt;<span class="st"> </span><span class="fl">0.01</span>){
    x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)
    <span class="kw">print</span>(x)
  }</code></pre></div>
<pre><code>## [1] 0.6867731
## [1] 1.091822
## [1] 0.5821857
## [1] 1.79764
## [1] 1.164754
## [1] 0.5897658
## [1] 1.243715
## [1] 1.369162
## [1] 1.287891
## [1] 0.8473058
## [1] 1.755891
## [1] 1.194922
## [1] 0.6893797
## [1] -0.1073499</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">print</span>(<span class="st">&quot;done!&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;done!&quot;</code></pre>
<div id="exercises-4" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>Write an if-else statement that classifies a number as positive number as “up” and a negative number as “down”. Then, write a forloop to classify each record of <code>x</code> from <code>x_2</code> to <code>x_100</code> is up or down relative to the preceding record Then, use <code>table()</code> to tabular the number of up days versus down days.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  n &lt;-<span class="st"> </span><span class="dv">500</span>
  series &lt;-<span class="st"> </span><span class="kw">sin</span>((<span class="dv">1</span>:n)/<span class="dv">100</span>) +<span class="st"> </span><span class="kw">cos</span>((<span class="dv">1</span>:n)/<span class="dv">80</span>)</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Fibonacci numbers are defined as <span class="math inline">\(F_n = F_{n-1} + F_{n-2}\)</span>, or numbers that are defined as the sum of the preceding two numbers. For example, given an initial sequence of <code>0, 1</code>, the next five numbers are <code>1, 2, 3, 5, 8</code>. Using a <code>while()</code> loop, find the Fibonacci number that precedes 1,000,000.</li>
<li>Often times, data files are stored in smaller chunks to save space and enhance searchability. In some cases, data is stored in daily chunks. The National Oceanic and Atmospheric Administration (NOAA) releases data every day on environmental and atmospheric conditions, including storms. Download the data using <code>digIt(&quot;hail_201601&quot;, download = TRUE)</code> and unzip the files, then use <code>list.files()</code>, then write a loop to record the following measures in a data frame:</li>
</ol>
<ul>
<li>month and year</li>
<li>number of rows</li>
<li>maximum hail size from the <code>maxsize</code> field</li>
</ul>
<p><strong>Answers</strong></p>
<ol style="list-style-type: decimal">
<li><em>If-Else Statement</em>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#define series </span>
  n &lt;-<span class="st"> </span><span class="dv">500</span>
  series &lt;-<span class="st"> </span><span class="kw">sin</span>((<span class="dv">1</span>:n)/<span class="dv">100</span>) +<span class="st"> </span><span class="kw">cos</span>((<span class="dv">1</span>:n)/<span class="dv">80</span>)
  
<span class="co">#write if-else for i = 2</span>
  temp &lt;-<span class="st"> </span><span class="kw">c</span>()
  if(series[<span class="dv">2</span>] &gt;=<span class="st"> </span>series[<span class="dv">2-1</span>]){
      temp &lt;-<span class="st"> </span><span class="kw">c</span>(temp, <span class="st">&quot;up&quot;</span>)
    } else{
      temp &lt;-<span class="st"> </span><span class="kw">c</span>(temp, <span class="st">&quot;down&quot;</span>)
    }
  
<span class="co">#set empty vector</span>
  temp &lt;-<span class="st"> </span><span class="kw">c</span>()
  
<span class="co">#loop through if-statement</span>
  for(i in <span class="dv">2</span>:<span class="kw">length</span>(series)){
    if(series[i] &gt;=<span class="st"> </span>series[i<span class="dv">-1</span>]){
      temp &lt;-<span class="st"> </span><span class="kw">c</span>(temp, <span class="st">&quot;up&quot;</span>)
    } else{
      temp &lt;-<span class="st"> </span><span class="kw">c</span>(temp, <span class="st">&quot;down&quot;</span>)
    }
  }
  <span class="kw">table</span>(temp)</code></pre></div>
<pre><code>## temp
## down   up 
##  267  232</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><em>Fibonacci Sequence</em>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#define variables</span>
  n &lt;-<span class="st"> </span><span class="dv">0</span>
  n0 &lt;-<span class="st"> </span><span class="dv">0</span>
  n1 &lt;-<span class="st"> </span><span class="dv">1</span>
  f &lt;-<span class="st"> </span><span class="dv">0</span>
  s &lt;-<span class="st"> </span><span class="kw">c</span>()

<span class="co">#enter into loop</span>
  while(f &lt;<span class="st"> </span><span class="dv">1000000</span>){
    f &lt;-<span class="st"> </span>n0 +<span class="st"> </span>n1
    n0 &lt;-<span class="st"> </span>n1
    n1 &lt;-<span class="st"> </span>f
    n &lt;-<span class="st"> </span>n +<span class="st"> </span><span class="dv">1</span>
    s &lt;-<span class="st"> </span><span class="kw">c</span>(s, f)
  }
  
<span class="co">#get result in the (n-1)th position </span>
  <span class="kw">print</span>(s[n<span class="dv">-1</span>])</code></pre></div>
<pre><code>## [1] 832040</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><em>Hail files</em>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Download the hail files to the current working directory</span>
  <span class="kw">library</span>(digIt)
  <span class="kw">digIt</span>(<span class="st">&quot;hail_201601&quot;</span>, <span class="dt">download =</span> <span class="ot">TRUE</span>)
  
<span class="co">#Unzip the zip file</span>
  <span class="kw">unzip</span>(<span class="st">&quot;compressed.zip&quot;</span>)

<span class="co">#Get all files that start with hail</span>
  hail &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">pattern =</span> <span class="st">&quot;^hail_</span><span class="ch">\\</span><span class="st">d{6}&quot;</span>)

<span class="co">#create empty dataframe</span>
  temp &lt;-<span class="st"> </span><span class="kw">data.frame</span>()
  for(rec in hail){
    df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(rec)
    maxhail &lt;-<span class="st"> </span><span class="kw">max</span>(df$MAXSIZE)
    date &lt;-<span class="st"> </span><span class="kw">regmatches</span>(rec,<span class="kw">regexpr</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">d{6}&quot;</span>, rec))
    rows &lt;-<span class="st"> </span><span class="kw">nrow</span>(df)
    temp &lt;-<span class="st"> </span><span class="kw">rbind</span>(temp, <span class="kw">data.frame</span>(<span class="dt">max.hail =</span> maxhail, <span class="dt">date =</span> date, <span class="dt">rows =</span> rows))
  }</code></pre></div>
</div>
</div>
</div>
<div id="functions" class="section level2">
<h2><span class="header-section-number">3.5</span> Functions</h2>
<p>Functions are generalizable sets of code that can be used to calculate a single value, process an entire dataset, print graphs, among other things. A strong software engineering habit involves building narrowly defined functions and low-level functions that can be put together to do high-level tasks.</p>
<p>A typical function is constructed as follows. The function name is assigned to an object, followed by a list of parameters that will be used as inputs into the function, followed by the script that will be executed using the input parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  function1 &lt;-<span class="st"> </span>function(parameter1, ...){
    <span class="co">#Script goes here</span>
    <span class="kw">return</span>([output goes here])
  }</code></pre></div>
<p>To execute the function, we will simply need to pass call the function and pass inputs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">function1</span>(input1)</code></pre></div>
<p>We can contextualize it by reconstructing a standard function such as the <code>mean()</code> method. <code>mean()</code> accepts accepts a vector <code>vec</code>, sums all values in <code>vec</code>, divides by the length of <code>vec</code>, then returns the result that is passed through <code>return()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Create dataset</span>
  n &lt;-<span class="st"> </span><span class="dv">1000</span>
  df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="dv">1</span>:n,
                   <span class="dt">x1 =</span> <span class="kw">rpois</span>(n,<span class="dv">3</span>), <span class="dt">x2 =</span> <span class="kw">rpois</span>(n,<span class="dv">10</span>),
                   <span class="dt">x3 =</span> <span class="kw">rpois</span>(n,<span class="dv">5</span>), <span class="dt">x4 =</span> <span class="kw">rpois</span>(n,<span class="dv">30</span>),
                   <span class="dt">x5 =</span> <span class="kw">rpois</span>(n,<span class="dv">1</span>), <span class="dt">x6 =</span> <span class="kw">rpois</span>(n,<span class="dv">1</span>),
                   <span class="dt">x7 =</span> <span class="kw">rpois</span>(n,<span class="dv">1</span>), <span class="dt">x8 =</span> <span class="kw">rpois</span>(n,<span class="dv">100</span>))

<span class="co">#Set up Function</span>
  meanToo &lt;-<span class="st"> </span>function(vec){
    <span class="co">#</span>
    <span class="co"># Desc:</span>
    <span class="co">#   Calculate mean of a vector of numeric values</span>
    <span class="co">#</span>
    <span class="co"># Args:</span>
    <span class="co">#   vec = vector of values</span>
    <span class="co"># </span>
    <span class="co"># Return:</span>
    <span class="co">#   Single mean</span>
    <span class="co">#</span>
      res &lt;-<span class="st"> </span><span class="kw">sum</span>(vec)/<span class="kw">length</span>(vec)
      <span class="kw">return</span>(res)
  }

<span class="co">#Execute </span>
  <span class="kw">meanToo</span>(df$x1)</code></pre></div>
<pre><code>## [1] 3.023</code></pre>
<p>But what if we wanted to obtain the mean for each row as opposed to each column? That can be achieved using the <code>rowMeans()</code> method, but we can also write a function to replicate the functionality. The function should:</p>
<ul>
<li>Accept the following parameters: <code>data</code> = the data frame, <code>start</code> = index value for the first column in range, <code>end</code> = index for the last column.</li>
<li>steps:
<ul>
<li>Create an empty vector <code>output</code></li>
<li>Loop through each row</li>
<li>Use the <code>mean.too()</code> function from above, calculate the row mean, append to <code>output</code></li>
<li>Return <code>output</code> as result</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Write function</span>
  rowMeans2 &lt;-<span class="st"> </span>function(data, start, end){
    <span class="co">#</span>
    <span class="co"># Desc:</span>
    <span class="co">#   Calculate mean for each rown</span>
    <span class="co">#</span>
    <span class="co"># Args:</span>
    <span class="co">#   data = data frame or matrix</span>
    <span class="co">#   start/end = column indices of first and last columns in data</span>
    <span class="co"># </span>
    <span class="co"># Return:</span>
    <span class="co">#   Vector of row means</span>
    <span class="co">#</span>
    
    output &lt;-<span class="st"> </span><span class="kw">c</span>()
    for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(data)){
      output &lt;-<span class="st"> </span><span class="kw">c</span>(output, <span class="kw">meanToo</span>(data[i, start:end]))
    }
    <span class="kw">return</span>(output)
  }

<span class="co">#Run function</span>
  df$means &lt;-<span class="st"> </span><span class="kw">rowMeans2</span>(df, <span class="dv">2</span>,<span class="dv">9</span>)
  <span class="kw">head</span>(df$means, <span class="dv">10</span>)</code></pre></div>
<pre><code>##  [1] 17.750 19.875 18.750 19.000 19.125 16.500 15.875 18.000 17.500 18.625</code></pre>
</div>
<div id="etiquette" class="section level2">
<h2><span class="header-section-number">3.6</span> Etiquette</h2>
<p>Notice how we rely on the <code>meanToo()</code> function that was previously built? There are some guiding principles that’ll ensure that your code is clean, readable, and reusable:</p>
<ol style="list-style-type: decimal">
<li><p><em>Plan your code</em>. Write or draw all the steps that are required to achieve your data processing requirements. Go through each line and cluster the steps into small, discrete modfules that can be relied upon independent of the initial context. For example, an entire data cleansing workflow should be broken into smaller functions rather than be converted into one long function.</p></li>
<li><p><em>Make your actions clear</em>. Write your code in a manner that can be re-usable and interpreted by other humans. The code should be self-explanatory. Annotate to make the logic and coding choices clear. For each function, include at least three descriptors so others may use your code: <code>Desc</code> for description of the function, <code>Args</code> for arguments or parameters in the code along with defaults, and <code>Return</code> indicating the output form. For example:</p></li>
<li><p><em>Pretty code is readable code</em>. To make readable code, do:</p></li>
</ol>
<ul>
<li>Indent lines: indent using two spaces to dependencies such as if-statements, loops, etc.;</li>
<li>Spacing: add spaces before and after operators (e.g. <code>10 + 2</code> rather than <code>10+2</code>);</li>
<li>Use <code>&lt;-</code> instead of <code>=</code> except for when there are function calls;</li>
<li>Limit each line of the code to a common page width (~140 characters).</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li><em>Name objects consistently</em>. Name new data objects and functions should follow a naming convention, such as the <a href="https://google.github.io/styleguide/Rguide.xml#identifiers">Google R Guide</a>.</li>
</ol>
<ul>
<li>Variable names should be all lower case without punctuation or spaces. If a space is required, replace with a period “<code>.</code>”.</li>
<li>Function names should follow the style of “functionName” – no spaces, the first letter of the second word (if any) is capitalized. Most importantly, name functions in a meaninful fashion.</li>
</ul>
<p>As an example of these rules in action:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Function for calculating a mean absolute percentage error</span>
mape &lt;-<span class="st"> </span>function(actual, predicted, <span class="dt">nas =</span> <span class="ot">TRUE</span>, <span class="dt">text =</span> <span class="ot">FALSE</span>){
    <span class="co">#</span>
    <span class="co"># Desc:</span>
    <span class="co">#   Calculates mean absolute percentage error, often used for forecasting</span>
    <span class="co">#</span>
    <span class="co"># Args:</span>
    <span class="co">#   actual = vector of original values</span>
    <span class="co">#   predicted = vector of predicted values</span>
    <span class="co">#   nas = logical (default = TRUE) to remove NA values</span>
    <span class="co">#   text = logical (default = FALSE) to return in textual percentage form (e.g. &quot;30%&quot;)</span>
    <span class="co"># </span>
    <span class="co"># Return:</span>
    <span class="co">#   A single MAPE value</span>
    <span class="co">#</span>
  
    <span class="co">#Calculate mape</span>
      out &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">abs</span>((predicted /<span class="st"> </span>actual)-<span class="dv">1</span>), <span class="dt">na.rm =</span> nas)
      
    <span class="co">#If statement for output options</span>
    if(text ==<span class="st"> </span><span class="ot">TRUE</span>){
      
      <span class="co">#return percentage readable text </span>
      <span class="kw">return</span>(<span class="kw">paste0</span>(out*<span class="dv">100</span>, <span class="st">&quot;%&quot;</span>))
      
    } else{
      
      <span class="co">#return raw</span>
      <span class="kw">return</span>(out)
    }
}

<span class="co">#Create data frame of example data</span>
  df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>),
                 <span class="dt">yhat =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">1.2</span>, <span class="dv">3</span>, <span class="fl">3.5</span>, <span class="dv">6</span>))

<span class="co">#Calculate mape for df</span>
  <span class="kw">mape</span>(df$y, df$yhat)</code></pre></div>
<div id="exercises-5" class="section level4 unnumbered">
<h4>Exercises</h4>
<ol style="list-style-type: decimal">
<li>Write a function that replicates the <code>unique()</code> method.</li>
<li>N-grams are a sequence of n-number of words in a sentence that are commonly relied upon for natural language processing and text analysis. Take the following sentence from the great statistician John Tukey: “Seek simplicity and distrust it.” 2-grams from this sentence would include: <code>&quot;seek simplicity&quot;, &quot;simplicity and&quot;, &quot;and distrust&quot;, &quot;distrust it&quot;</code>. A 1-gram would be a vector of all words parsed by spaces. Write a function that can return n-grams for any sentence.</li>
</ol>
<p><strong>Answers.</strong></p>
<ol style="list-style-type: decimal">
<li><em>Replicate <code>unique()</code></em>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uniq &lt;-<span class="st"> </span>function(vec){
    <span class="co">#</span>
    <span class="co"># Desc:</span>
    <span class="co">#   Deduplicate and return unique values in a vector</span>
    <span class="co">#</span>
    <span class="co"># Args:</span>
    <span class="co">#   vec = vector of values</span>
    <span class="co">#</span>
    <span class="co"># Return:</span>
    <span class="co">#   A vector of unique values</span>
    <span class="co">#</span>
  
  <span class="co">#create empty vector</span>
    uniq &lt;-<span class="st"> </span><span class="kw">c</span>()
    
  <span class="co">#loop through </span>
    for(i in vec){
      if(!(i %in%<span class="st"> </span>uniq)){
        uniq &lt;-<span class="st"> </span><span class="kw">c</span>(uniq, i)
      }
    }
  <span class="co">#return</span>
    <span class="kw">return</span>(uniq)
}

<span class="co">#Try it out on a short series</span>
  a &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dv">10</span>)
  <span class="kw">uniq</span>(a)</code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><em>n-grams</em>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  ngrams &lt;-<span class="st"> </span>function(vec, delimiter, num.grams){
  
    <span class="co">#</span>
    <span class="co"># Desc:</span>
    <span class="co">#   Produce all unique sequential n-grams for each element in a string vector</span>
    <span class="co">#</span>
    <span class="co"># Args:</span>
    <span class="co">#   vec = vector of string values</span>
    <span class="co">#   delimiter = character that separates words</span>
    <span class="co">#   num.grams = number of grams (word combinations)</span>
    <span class="co">#</span>
    <span class="co"># Return:</span>
    <span class="co">#   A vector of n-grams</span>
    <span class="co">#</span>
    
    <span class="co">#split characters by </span>
      vec2 &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(vec, delimiter))
    
    <span class="co">#create placeholder then loop through each word</span>
      grams &lt;-<span class="st"> </span><span class="kw">c</span>()
      for(k in num.grams:<span class="kw">length</span>(vec2)){
        grams &lt;-<span class="st"> </span><span class="kw">c</span>(grams, <span class="kw">paste</span>(vec2[k -<span class="st"> </span><span class="dv">1</span>], vec2[k]))
      }
      <span class="kw">return</span>(grams)
  }

  <span class="co">#Test it</span>
    <span class="kw">ngrams</span>(<span class="st">&quot;Seek simplicity and distrust it.&quot;</span>, <span class="st">&quot; &quot;</span>, <span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] &quot;Seek simplicity&quot; &quot;simplicity and&quot;  &quot;and distrust&quot;    &quot;distrust it.&quot;</code></pre>
</div>
<div id="what-can-you-do-with-control-structures" class="section level3">
<h3><span class="header-section-number">3.6.1</span> What can you do with control structures?</h3>
<p>Loops are a critical part of all parts of data science, enabling data cleaning, optimization, and automation. Loops are helpful when an function cannot be applied globally, meaning that each element, column, observation or iteration needs to be done on its own. For example, taking the sum of a random variable <code>x</code> can be done without looping as R is designed to operate with column-wise functionality. However, a moving average of 10 records would require a forloop.</p>
<div id="example-smoothing-time-series-of-eia-gasoline-spot-price-data" class="section level4 unnumbered">
<h4>Example: Smoothing time series of EIA Gasoline Spot Price Data</h4>
<p>What if we had a time series dataset with a fair amount of random variability and swings in volume? This sounds very much like financial and economic data – it’s often filled with noise. Let’s take the <a href="">US Energy Information Administration’s</a> spot price data, specifically the retail <a href="http://www.eia.gov/dnav/pet/xls/PET_PRI_SPT_S1_D.xls">gasoline data</a>. An extract has been made available via the <code>digIt()</code> library or from the link <a href="https://s3.amazonaws.com/whoa-data/doe_spot_prices_readme.zip" class="uri">https://s3.amazonaws.com/whoa-data/doe_spot_prices_readme.zip</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Call rio library to open </span>
  <span class="kw">library</span>(digIt)
  df &lt;-<span class="st"> </span><span class="kw">digIt</span>(<span class="st">&quot;doe_gas_price&quot;</span>)</code></pre></div>
<pre><code>## doe_gas_price has been loaded into memory.</code></pre>
<pre><code>## Dimensions: n = 7903, k = 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Call rio library to open </span>
  <span class="kw">library</span>(rio)
  df &lt;-<span class="st"> </span><span class="kw">import</span>(<span class="st">&quot;https://s3.amazonaws.com/dspp/doe_spot_prices_readme.xls&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Inspect the data</span>
  <span class="kw">dim</span>(df)</code></pre></div>
<pre><code>## [1] 7903    3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">head</span>(df,<span class="dv">1</span>)</code></pre></div>
<pre><code>##         Date
## 1 1986-06-02
##   New York Harbor Conventional Gasoline Regular Spot Price FOB (Dollars per Gallon)
## 1                                                                             0.468
##   U.S. Gulf Coast Conventional Gasoline Regular Spot Price FOB (Dollars per Gallon)
## 1                                                                             0.445</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Clean and format data</span>
  <span class="kw">colnames</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;date&quot;</span>,<span class="st">&quot;ny.values&quot;</span>,<span class="st">&quot;us.gulf.values&quot;</span>)
  df$date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="kw">as.character</span>(df$date), <span class="st">&quot;%Y-%m-%d&quot;</span>)

<span class="co">#Plot the data using ggplot</span>
  <span class="kw">library</span>(ggplot2)
  <span class="kw">ggplot</span>(df, <span class="kw">aes</span>(date,ny.values)) +<span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="Data_Science__A_Practical_Strategy_files/figure-html/unnamed-chunk-136-1.png" width="672" /></p>
<p>While here is a pre-built smoothing function known as <code>smooth()</code> that is optimized for this task, we will write a moving average function to illustrate control structures on the <code>ny.values</code> series.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  moving &lt;-<span class="st"> </span>function(vec, lag){
    
    <span class="co">#</span>
    <span class="co"># Desc:</span>
    <span class="co">#   Produce rolling average</span>
    <span class="co">#</span>
    <span class="co"># Args:</span>
    <span class="co">#   vec = numeric vector </span>
    <span class="co">#   lag = number of periods to add to lag</span>
    <span class="co">#</span>
    <span class="co"># Return:</span>
    <span class="co">#   A vector of n-grams</span>
    <span class="co">#</span>
    
    new.vec &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, lag -<span class="st"> </span><span class="dv">1</span>)
    
    <span class="co">#Loop range from *size* to number of rows in vec minus *size*</span>
    for(i in lag:<span class="kw">length</span>(vec)){
      
        <span class="co">#Extract values of *x* from positions i-size to i</span>
        extract &lt;-<span class="st"> </span><span class="kw">mean</span>(vec[(i -<span class="st"> </span>lag):i], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
        
        <span class="co">#Calculate mean of *extract*, store to the ith value of *new*</span>
        new.vec &lt;-<span class="st"> </span><span class="kw">c</span>(new.vec, extract)
    }
    <span class="kw">return</span>(new.vec)
  }</code></pre></div>
<p>Now we can test <code>moving()</code> using a 14-day window and plot the <code>ny.values</code> versus the 14-day moving average.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Calculate 14-day moving average</span>
  df$new &lt;-<span class="st"> </span><span class="kw">moving</span>(df$ny.values, <span class="dv">14</span>)

<span class="co">#Plot result</span>
 <span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> ny.values)) +<span class="st"> </span>
<span class="st">   </span><span class="kw">geom_line</span>(<span class="dt">colour=</span><span class="st">&quot;grey&quot;</span>) +
<span class="st">   </span><span class="kw">geom_line</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> new))</code></pre></div>
<p><img src="Data_Science__A_Practical_Strategy_files/figure-html/unnamed-chunk-138-1.png" width="672" /></p>
<p>It’s also possible to use loops within loops. What if we wanted to compare multiple window sizes, we can <em>nest</em> one loop inside another. In this case, looping through different potential window sizes helps with identifying the optimal window size.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#Vector of windows to be tested</span>
      windows &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">91</span>, <span class="dv">182</span>, <span class="dv">364</span>)
    
    <span class="co">#Outer loop (index value = *size*)</span>
    for(size in windows){
      
      <span class="co">#Calculate moving average by window</span>
        df$new &lt;-<span class="st"> </span><span class="kw">moving</span>(df$ny.values, size)
    
      <span class="co">#Calculate correlation</span>
        cor_val &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">cor</span>(df$new, df$ny.values, <span class="dt">use=</span><span class="st">&quot;complete.obs&quot;</span>), <span class="dv">2</span>)
    
      <span class="co">#Plot graph</span>
      g &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> ny.values)) +<span class="st"> </span>
<span class="st">            </span><span class="kw">geom_line</span>(<span class="dt">colour =</span> <span class="st">&quot;grey&quot;</span>) +
<span class="st">            </span><span class="kw">geom_line</span>(<span class="dt">data =</span> df, <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> new), <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>) +<span class="st"> </span>
<span class="st">            </span><span class="kw">ggtitle</span>( <span class="kw">paste</span>(<span class="st">&quot;window =&quot;</span>,size,<span class="st">&quot;, rho =&quot;</span>, cor_val))
      
      <span class="co">#Assign new name for plot object to avoid overwriting results</span>
        <span class="kw">assign</span>(<span class="kw">paste0</span>(<span class="st">&quot;g&quot;</span>,size), g)
  }
    
  <span class="co">#Compare graphs. Requires gridExtra library to allow for graph juxtapositionx</span>
    <span class="kw">library</span>(gridExtra)
    <span class="kw">grid.arrange</span>(g7, g91, g182, g364, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="Data_Science__A_Practical_Strategy_files/figure-html/unnamed-chunk-139-1.png" width="672" /></p>
<p>Note that there are some pre-canned functions that can assist with smoothing; However, coding the function from scratch will provide you with greater flexibility to tackle the task at hand.</p>

</div>
</div>
</div>
<div id="getting-into-the-mentality" class="section level2">
<h2><span class="header-section-number">3.7</span> Getting into the mentality</h2>
<blockquote>
<p><strong><em>Writing just any piece of code is easy. The challenging thing is to ensure that it works well and is repeatable.</em></strong></p>
</blockquote>
<p>To be successful in the wild requires the appropriate mindset and an embrace of data etiquette. Data processing is not like a vampiric feeding frenzy of the sort that might be seen on Buffy the Vampire slayer (the TV show): one simply does not arbitrarily chomp at and slice data without any thought as to what comes next. It requires discipline and finesse to acquire a raw piece of information and extract the empirical substance.</p>
<p>Hypothetically, imagine that you have conducted a three-month analytics project, rushing to obtain to a result. If asked to provide backup, documentation, and a process, it may very well require an additional few months to decipher your passionate but hasty explorations. Where did this data come from? Why did I take a dot product in this equation? What happened to the raw file? Who is Bob mentioned in this email? Ultimately, the data scientist is in control and should be empowered to conduct data processing in a structured, scientific manner. <em>So, what exact does that mean?</em> Here are five guidelines that make for successful, scalable data science projects:</p>
<ul>
<li><p><em>Define a file structure and stick to it</em>. Create a folder for <em>scripts</em> to store all code, another for <em>raw</em> data, a folder for <em>outputs</em> from data processing, and another for <em>documentation</em>. Choose any file structure, but make sure it is consistent and always followed.</p></li>
<li><p><em>Think modularly</em>. One of the greatest human inventions is the assembly line. Each step in the process is discrete, requiring workers to specialize in one set of well-defined tasks. As a worker becomes specialized, production speed increases as workers focus on a repetitive task as opposed to switching between tasks. Also, if any step in the process needs to be improved, revised, or replaced, all other steps in the process are not disrupted – only one step needs to be addressed. This standardization of processes is the only way to scale. Coding is the same. Each group of similar tasks can be rolled up into a function that is comprised of generic actions. For example, a function could transform involve downloading a file, unzipping it, loading into memory, and extract a specific set of fields, then saving out the extracted data.</p></li>
<li><p><em>Adopt and stick to a coding style</em>. Each file, data field, and function should follow a style so that the logic is cohesive, readable and traceable. The <a href="https://google.github.io/styleguide/Rguide.xml">Google R Style Guide</a>, for example, sets easy to follow rules. For example, variable names should be labeled as lower case characters with a <code>&quot;.&quot;</code> as a separator: <code>variable.name</code>. Functions should be named in proper case without spaces: <code>NewFunction</code> or <code>MyFunction</code>. Regardless of the style guide, file names should be meaningful and the only punctuation used should be <code>&quot;_&quot;</code> for spaces and <code>&quot;.&quot;</code> to accompany the file type: <code>gdp_2014_10_02.json</code>. Be vigilent with your code style as it may be the difference between a successful and a failed project.</p></li>
<li><p><em>Work forward, not in circles</em>. Raw meats should never be placed with cooked meats. It’s a one way street to keep things clean and sanitary. Data is also a one way street Start from the raw data, make a copy when working with the raw, do thy bidding on the data, then output results or processed data as a new file. Never overwrite the raw file as this is the equivalent to repeatedly refridgerating and re-cooking already cooked meat – the result may be less than desirable in the future.</p></li>
<li><p><em>Version up</em>. Each time code is written, modified, amended, or updated, a new version should be saved. Saving can be done in one many ways. If on a local computer, simply adding a version number to the code file name would suffice with an entry to a log file. The log file can be as simple as a text file with time stamps indicating the date fo the edit, the file name and the nature of the edit. Services such as <a href="https://github.com/">Github</a> are particularly useful for version control and working on code in groups.</p></li>
</ul>
<p>Following these basic guidelines is the difference between successful, scalable projects and ones that get stuck in the mud.</p>
</div>
<div id="diy-1" class="section level2">
<h2><span class="header-section-number">3.8</span> DIY</h2>

<div id="how-do-i-auto-populate-text-and-stences-pro-forma" class="section level3">
<h3><span class="header-section-number">3.8.1</span> How do I auto-populate text and stences pro forma?</h3>
<p>In 2014, an automated script was the first produced by the L.A. Times was the first to <a href="http://www.slate.com/blogs/future_tense/2014/03/17/quakebot_los_angeles_times_robot_journalist_writes_article_on_la_earthquake.html">report on an earthquake around Los Angeles</a>. Everytime the United States Geological Survey issues an earthquake over a certain severity level, the robot is able to pick out key pieces of information and populate an article <em>pro forma</em>. In the wild, many well-structured data sources that are issued as alerts are well-suited for automation. What if we have the following statement. What if specific information could be auto-populated?</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  original &lt;-<span class="st"> &quot;Maria was a Category 5 with max wind speeds of 175 mph.&quot;</span></code></pre></div>

<p>We need to first find key items and replace with unique placeholders. The unique placeholders can be used as a standardized search. Notice that each modification to the original string <code>original</code> is assigned to the new object <code>warn.line</code> in order to avoid overwriting the gold copy.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Replace Category 5 with &lt;hurricane_level&gt;</span>
  warn.line &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;Category </span><span class="ch">\\</span><span class="st">d&quot;</span>, <span class="st">&quot;Category &lt;hurricane_level&gt;&quot;</span>, original)
  
<span class="co">#Search for Maria as a five-letter word with &lt;name&gt;</span>
  warn.line &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">b[[:alpha:]]{5}</span><span class="ch">\\</span><span class="st">b&quot;</span>, <span class="st">&quot;&lt;name&gt;&quot;</span>, warn.line)
  
<span class="co">#Replace 175 with &lt;wind_speed&gt;</span>
  (warn.line &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">d{3}&quot;</span>, <span class="st">&quot;&lt;wind_speed&gt;&quot;</span>, warn.line))</code></pre></div>
<pre><code>## [1] &quot;&lt;name&gt; was a Category &lt;hurricane_level&gt; with max wind speeds of &lt;wind_speed&gt; mph.&quot;</code></pre>

<p>As information becomes available, this sentence can be populated with event-specific information. Below is a list of a few hurricanes that occurred in the 2017 season.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  hurricanes &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">storm.name =</span> <span class="st">&quot;Irma&quot;</span>, <span class="dt">speed =</span> <span class="dv">185</span>, <span class="dt">level =</span> <span class="dv">5</span>),
            <span class="kw">data.frame</span>(<span class="dt">storm.name =</span> <span class="st">&quot;Jose&quot;</span>, <span class="dt">speed =</span> <span class="dv">155</span>, <span class="dt">level =</span> <span class="dv">4</span>),
            <span class="kw">data.frame</span>(<span class="dt">storm.name =</span> <span class="st">&quot;Katia&quot;</span>, <span class="dt">speed =</span> <span class="dv">105</span>, <span class="dt">level =</span> <span class="dv">2</span>),
            <span class="kw">data.frame</span>(<span class="dt">storm.name =</span> <span class="st">&quot;Harvey&quot;</span>, <span class="dt">speed =</span> <span class="dv">130</span>, <span class="dt">level =</span> <span class="dv">4</span>))</code></pre></div>

<p>To auto-populate the sentence, we can write a simple function that accepts key inputs, then outputs a storm summary. Note that the function includes descriptive text to help future users understand how to use the code.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  warningText &lt;-<span class="st"> </span>function(model.sentence, storm.name, level, speed){
    <span class="co">#</span>
    <span class="co"># Converts key hurricane information into summary text</span>
    <span class="co">#</span>
    <span class="co"># Args:</span>
    <span class="co">#   model.sentence = model sentence with markers </span>
    <span class="co">#   storm.name = string containing storm name to replace &lt;name&gt;</span>
    <span class="co">#   level = hurricane level to replace &lt;hurricane_level&gt;</span>
    <span class="co">#   speed = maximum speed in mph to replace &lt;wind_speed&gt;</span>
    <span class="co">#</span>
    <span class="co"># Result:</span>
    <span class="co">#   Storm summary populated with storm details</span>
    <span class="co">#</span>
    
    statement &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;&lt;hurricane_level&gt;&quot;</span>, level, model.sentence)
    statement &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;&lt;wind_speed&gt;&quot;</span>, speed, statement)
    statement &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;&lt;name&gt;&quot;</span>, storm.name, statement)
    <span class="kw">return</span>(statement)
  }</code></pre></div>

<p>With the function, we can loop through each row of the data frame to generate a sentence describing each storm.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(hurricanes)){
  <span class="kw">print</span>(<span class="kw">warningText</span>(<span class="dt">model.sentence =</span> warn.line, 
                    <span class="dt">storm.name =</span> hurricanes$storm.name[i], 
                    <span class="dt">level =</span> hurricanes$level[i], 
                    <span class="dt">speed =</span> hurricanes$speed[i]))
}</code></pre></div>
<pre><code>## [1] &quot;Irma was a Category 5 with max wind speeds of 185 mph.&quot;
## [1] &quot;Jose was a Category 4 with max wind speeds of 155 mph.&quot;
## [1] &quot;Katia was a Category 2 with max wind speeds of 105 mph.&quot;
## [1] &quot;Harvey was a Category 4 with max wind speeds of 130 mph.&quot;</code></pre>

</div>
<div id="what-is-the-overlap-between-these-two-lists" class="section level3">
<h3><span class="header-section-number">3.8.2</span> What is the overlap between these two lists?</h3>
<div id="motivation-1" class="section level4 unnumbered">
<h4>Motivation</h4>
<p>Bill de Blasio, the 109th Mayor of New York City, was not always known as <em>Bill de Blasio</em>. In fact, he has changed his name twice and he has had three legal names, including <em>Warren Wilhelm Jr.</em>, <em>Warren de Blasio-Wilhelm</em> and <em>Bill de Blasio</em>.<a href="#fn26" class="footnoteRef" id="fnref26"><sup>26</sup></a> His current name first appeared in 1990 as a working name and was only officially with a court petition in 2001. In addition, his close network addresses him as <em>Billy</em>.<a href="#fn27" class="footnoteRef" id="fnref27"><sup>27</sup></a> While his entities are well-covered in the press and are common knowledge for New Yorkers, to others it may not be. Name changes are quite common throughout society. Some people may choose to change part of or their entire name at major life events, such as at joyous occassions like marriage or more clandestine efforts with witness protection. The way in which people refer to themselves colloquially also tends to differ such as nicknames (e.g. Bob = Robert, Dick = Richard, Jen = Jennifer) and stage names (e.g. George Michael = Georgios Kyriacos Panayiotou, Stevie Wonder = Stevland Hardaway Judkins). Organizations may use the same acronyms to refer to themselves. CIA can refer to the clandestine Central Intelligence Agency or the more gastronomically inclined Culinary Institute of America.</p>
<p>In data science, <em>entity resolution</em> (ER) or the disambiguation of names and entities is paramount in the early stages of developing data sets for analysis and application. ER is also referred to as record linakge and as deduplication in certain contexts – essentially being able to systematically map aliases to a canonical identifier. This process goes beyond simply names and spellings, but other identiable information that can be used to triangulate upon an entity or identity.</p>
<p>For example, a unique identifier in the US is the social security number (SSN). Composite identifiers can be developed using a number of pieces of information, such as the last four digits of the social security number (SSN4), a person’s last name, and birth date. For businesses, an identifier might be the tax identification number (TIN) or even commercial email address in certain cases.</p>
<p>Through successfully resolving entities, fundamental business analysis problems can be solved:</p>
<ul>
<li>How many people do I have in these customer lists?</li>
<li>How many customers return more than once per year?</li>
<li>How many records overlap between these two lists?</li>
<li>I have two data sets with data about people. How do I combine them to augment my knowledge about those people?</li>
</ul>
</div>
<div id="principles" class="section level4 unnumbered">
<h4>Principles</h4>
<p>The goal of entity resolution is to get entity <span class="math inline">\(A\)</span> in one set of information to equate <span class="math inline">\(A\)</span> in another set of information. On one level, getting identifiers to line up, such as names, is a matter of ensuring that characters in two sets of information are the same. On another level, it is a matter of identifying the right combination of fields that have enough identifiable information to make the linkage. There are a broad set of complex techniques that can be applied to achieve this task. To start, the mastering the following can go a long way:</p>
<ul>
<li>Text may be processed to remove punctuation and spacing as well as standardize capitalization. For example, <code>Bill de Blasio-Wilhelm</code> and <code>billdeblasiowilhelm</code> are the same name.</li>
<li>Misspellings and alternative spellings are a common problem. In NYC, Broadway has been known to be spelled as B-way, B’way, Bwy, Bdway, among others. <em>Fuzzy matching</em> can be used to find candidate matches among strings based on how they sound or are spelled words. <em>Phonetic algorithms</em>, such as Soundex, are useful with indexing names based on how they sound in English as opposed to their spelling. In Soundex, for example, names are represented as a letter and three numbers as derived by encoding rules<a href="#fn28" class="footnoteRef" id="fnref28"><sup>28</sup></a> The soundex for the name “Boston” is “B-235”. Other names that would have the same soundex are “Bostin”, “Bawstin”, and “Bastin” – all of which would be phonetic matches. When spelling matters, methods such as <em>Levenshtein Distance</em> or <em>Edit Distances</em> can be used to calculate the number of character insertions, deletions and substitutions are required to convert a source string into a target – essentially a character similarity measure. The Levenshtein Distance from “Boston” to “Bawstin” is 3 and to “Bostin” is 1. Note that matching based on Levenshtein Distance would require the user to specify an acceptable cutoff distance.</li>
<li>Disambiguation is reliant on linking known names to a canonical name. Bill can be linked to Billy and Warren in de Blasio’s case, but not in the case of Bill Clinton or Bill Nye. Typically, these linkages are surfaced through manual investigation and keeping track of the “Also Known As” or “AKA” may accomplish more than any text manipulation ever could.</li>
</ul>
</div>
<div id="a-worked-example" class="section level4 unnumbered">
<h4>A Worked example</h4>
<p>Publicly available PII is becoming increasingly abundant due to cybersecurity breaches. But, published PII is officially published on sanction lists and watch lists. A number of nations and governing bodies publically publish such lists of enemies of the state and their many aliases so that companies and people conducting global commerce can follow international sanctions. Indeed, the value of data here is one of a serious and grave nature, but without such lists, diplomacy and policy is hard to implement and enforce.</p>
<p>For this example, four sanctions lists have been assembled:</p>
<ul>
<li>US Consolidated Screening List: <a href="http://2016.export.gov/ecr/eg_main_023148.asp" class="uri">http://2016.export.gov/ecr/eg_main_023148.asp</a></li>
<li>UK Financial sanctions targets: list of all targets: <a href="https://www.gov.uk/government/publications/financial-sanctions-consolidated-list-of-targets/consolidated-list-of-targets" class="uri">https://www.gov.uk/government/publications/financial-sanctions-consolidated-list-of-targets/consolidated-list-of-targets</a></li>
<li>UN Sanctions List: <a href="https://scsanctions.un.org/resources/xml/en/consolidated.xml" class="uri">https://scsanctions.un.org/resources/xml/en/consolidated.xml</a></li>
<li>EU Sanctions List: <a href="http://ec.europa.eu/external_relations/cfsp/sanctions/list/version4/global/global.xml" class="uri">http://ec.europa.eu/external_relations/cfsp/sanctions/list/version4/global/global.xml</a></li>
</ul>
<p>For simplicity, we will focus only on the UN and EU lists to create a cleaned set of names in order to determine the number of unique entities in each list, then conduct matching to determine the overlap. To start, we will directly read the EU and UN data using the <code>digIt()</code> library.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">library</span>(digIt)
  un &lt;-<span class="st"> </span><span class="kw">digIt</span>(<span class="st">&quot;watch_list_un&quot;</span>)
  eu &lt;-<span class="st"> </span><span class="kw">digIt</span>(<span class="st">&quot;watch_list_eu&quot;</span>)</code></pre></div>

<p>As a first step, we will examine a few records. There are quite a few fields that could be used for matching such as name, birth date, and citizenship. Typically, it is best to clean and prepare multiple fields for matching.</p>

<table>
<caption><span id="tab:unnamed-chunk-147">Table 3.6: </span>Comparison of EU and UN lists.</caption>
<thead>
<tr class="header">
<th align="left">EU Variables</th>
<th></th>
<th align="left">UN Variables</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">id</td>
<td>13</td>
<td align="left">rec_type</td>
<td align="left">individual</td>
</tr>
<tr class="even">
<td align="left">legal_basis</td>
<td>1210/2003 (OJ L169)</td>
<td align="left">id</td>
<td align="left">6908048</td>
</tr>
<tr class="odd">
<td align="left">reg_date</td>
<td>2003-07-07</td>
<td align="left">version_number</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">lastname</td>
<td>Hussein Al-Tikriti</td>
<td align="left">firstname</td>
<td align="left">SADDAM</td>
</tr>
<tr class="odd">
<td align="left">firstname</td>
<td>Saddam</td>
<td align="left">secondname</td>
<td align="left">HUSSEIN</td>
</tr>
<tr class="even">
<td align="left">middlename</td>
<td></td>
<td align="left">thirdname</td>
<td align="left">AL-TIKRITI</td>
</tr>
<tr class="odd">
<td align="left">wholename</td>
<td>Saddam Hussein Al-Tikri</td>
<td align="left">un_list_type</td>
<td align="left">Iraq</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td>M</td>
<td align="left">ref_num</td>
<td align="left">IQi.001</td>
</tr>
<tr class="odd">
<td align="left">title</td>
<td></td>
<td align="left">listed_on</td>
<td align="left">2003-06-27</td>
</tr>
<tr class="even">
<td align="left">func_role</td>
<td></td>
<td align="left">comments</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">language</td>
<td></td>
<td align="left">designation</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">birthdate</td>
<td>1937-04-28</td>
<td align="left">citizen_country</td>
<td align="left">Iraq</td>
</tr>
<tr class="odd">
<td align="left">birth_place</td>
<td>al-Awja, near Tikrit</td>
<td align="left">list_type</td>
<td align="left">UN List</td>
</tr>
<tr class="even">
<td align="left">birth_country</td>
<td>IRQ</td>
<td align="left">date_updated</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">passport_number</td>
<td></td>
<td align="left">alias</td>
<td align="left">Abu Ali</td>
</tr>
<tr class="even">
<td align="left">passport_country</td>
<td></td>
<td align="left">alias_quality</td>
<td align="left">Low</td>
</tr>
<tr class="odd">
<td align="left">citizen_country</td>
<td>IRQ</td>
<td align="left">country</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">pdf_link</td>
<td><a href="http://eur-lex.europa.e" class="uri">http://eur-lex.europa.e</a></td>
<td align="left">birthdate</td>
<td align="left">1937-04-28</td>
</tr>
<tr class="odd">
<td align="left">programme</td>
<td>IRQ</td>
<td align="left">birthdate_type</td>
<td align="left">EXACT</td>
</tr>
<tr class="even">
<td align="left"></td>
<td></td>
<td align="left">birth_place</td>
<td align="left">al-Awja, near Tikrit</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td></td>
<td align="left">birth_country</td>
<td align="left">Iraq</td>
</tr>
<tr class="even">
<td align="left"></td>
<td></td>
<td align="left">passport_number</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td></td>
<td align="left">passport_country</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td></td>
<td align="left">sort_key</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td></td>
<td align="left">sort_key_mod</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>For this example, we will rely largely on the EU <code>wholename</code> field and construct a similar fields from the UN list using <code>firstname</code>, <code>secondname</code>, and <code>thirdname</code>. A first step in preparation is to fill all <code>NA</code> values with an empty quotation as concatenating multiple <code>NA</code> values will be erroneously interpretted as a string value “NA” (e.g. “Saddam NA Hussein”). As a cursory check, we match both the <code>eu</code> and <code>un</code> data sets by the <code>wholename</code> field, which reveals that only four of hundreds of records are readily matchable.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#PRE-PROCESSING</span>
  eu[<span class="kw">is.na</span>(eu)] &lt;-<span class="st"> &quot;&quot;</span>
  un[<span class="kw">is.na</span>(un)] &lt;-<span class="st"> &quot;&quot;</span>

<span class="co">#Concatenate names in UN set</span>
  un$wholename &lt;-<span class="st"> </span><span class="kw">paste</span>(un$firstname, un$secondname, un$thirdname)

<span class="co">#Test straight up matches (only for records that match without any changes)</span>
  base.merge &lt;-<span class="st"> </span><span class="kw">merge</span>(eu, un, <span class="dt">by =</span> <span class="st">&quot;wholename&quot;</span>)
  <span class="kw">paste</span>(<span class="st">&quot;Number of matched rows =&quot;</span>,<span class="kw">nrow</span>(base.merge))</code></pre></div>
<pre><code>## [1] &quot;Number of matched rows = 4&quot;</code></pre>

<p>To build out the entity resolution process, we will need to write two functions. The first function to be named <code>cleanEntity()</code> will clean, deduplicate and standardize a vector of names.</p>
<ul>
<li>Computers interpret characters <em>as is</em>, thus a capital “A” is not he same a a lower case “a” and one space is not the same as a tab indent. To clean, spaces and punctuation will be stripped out. In addition, all characters will be turned into lower case and trim excess white space from the beginning and end of each string.</li>
<li>Deduplication will be conduct on the resulting cleaned string vector. This is a key step to ensure that matching is conducted as close to a 1:1 basis, otherwise we run the risk of a Cartesian Product (all duplicate matches can matched to one another, thereby multiplying the number of matched records).</li>
</ul>
<p>The result is a data frame containing both the original whole name and the cleaned whole name.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Write function to cleaning data</span>
cleanEntity &lt;-<span class="st"> </span>function(x){
  <span class="co">#</span>
  <span class="co"># Desc: </span>
  <span class="co">#   Accepts a vector of names, returns a cleaned, deduplicated, data frames</span>
  <span class="co">#</span>
  <span class="co"># Args:</span>
  <span class="co">#   x = a string vector</span>
  <span class="co">#</span>
  <span class="co"># Returns:</span>
  <span class="co">#   Data frame with two fields: Original string and a cleaned name</span>
  
  x &lt;-<span class="st"> </span>x[!<span class="kw">duplicated</span>(x)]
  lower &lt;-<span class="st"> </span><span class="kw">trimws</span>(<span class="kw">tolower</span>(x))
  nopunct &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>, <span class="st">&quot;&quot;</span>, lower)
  nospace &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;[[:space:]]&quot;</span>, <span class="st">&quot;&quot;</span>, nopunct)
  <span class="kw">return</span>(<span class="kw">data.frame</span>(<span class="dt">original =</span> x, <span class="dt">cleaned =</span> nospace))
  
}</code></pre></div>

<p>As a proof of concept, we run the <code>cleanEntity()</code> function and examine the first five records. For the most part, the names look fairly standardized.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Check to see that it works</span>
  test.match &lt;-<span class="st"> </span><span class="kw">cleanEntity</span>(eu$wholename)
  <span class="kw">head</span>(test.match, <span class="dv">5</span>)</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-151">Table 3.7: </span>Cursory comparison of original and cleaned string vectors</caption>
<thead>
<tr class="header">
<th align="left">original</th>
<th align="left">cleaned</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Robert Gabriel Mugabe</td>
<td align="left">robertgabrielmugabe</td>
</tr>
<tr class="even">
<td align="left">Saddam Hussein Al-Tikriti</td>
<td align="left">saddamhusseinaltikriti</td>
</tr>
<tr class="odd">
<td align="left">Qusay Saddam Hussein Al-Tikriti</td>
<td align="left">qusaysaddamhusseinaltikriti</td>
</tr>
<tr class="even">
<td align="left">Uday Saddam Hussein Al-Tikriti</td>
<td align="left">udaysaddamhusseinaltikriti</td>
</tr>
<tr class="odd">
<td align="left">Abid Hamid Mahmud Al-Tikriti</td>
<td align="left">abidhamidmahmudaltikriti</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>The next step is to write a function called <code>canonicalNames()</code> that is designed to find which raw, uncleaned name in one data set matches with a raw, uncleaned name in a second data set. This is accomplished by translating two vectors of names into a standardized form, then conducts matching. The function starts by using <code>cleanNames()</code> to standardize the two name vectors. Notice the modularity – how a user-defined function is designed to work as part of a more complex function. Upon transforming each vector, <code>canonicalNames()</code> conducts two rounds of matching: one with the uncleaned names as these contain arguably the highest quality matches, then another round on cleaned names. The result of this function is a data frame that contains matched, untransformed names that can be used as a key to join data between data sets.</p>


<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">canonicalNames &lt;-<span class="st"> </span>function(a, b){
  <span class="co">#</span>
  <span class="co"># Desc:</span>
  <span class="co">#   Accepts two vectors of identifiers, returns matches</span>
  <span class="co"># </span>
  <span class="co"># Args: </span>
  <span class="co">#   a and b are string vectors of names</span>
  <span class="co">#</span>
  <span class="co"># Result:</span>
  <span class="co">#   A matched list with original names in each dataset</span>
  
  <span class="co">#Clean Data</span>
  a &lt;-<span class="st"> </span><span class="kw">cleanEntity</span>(a)
  b &lt;-<span class="st"> </span><span class="kw">cleanEntity</span>(b)
  
  <span class="co">#Change field names</span>
  <span class="kw">colnames</span>(a) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;a.&quot;</span>,<span class="kw">colnames</span>(a))
  <span class="kw">colnames</span>(b) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;b.&quot;</span>,<span class="kw">colnames</span>(b))
  
  <span class="co">#Match on originals </span>
  overlap1 &lt;-<span class="st"> </span><span class="kw">merge</span>(a, b, <span class="dt">by.x =</span> <span class="st">&quot;a.original&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;b.original&quot;</span>)
  overlap1$step &lt;-<span class="st"> &quot;original&quot;</span>
  overlap1$b.original &lt;-<span class="st"> </span>overlap1$a.original
  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Original: # matches = &quot;</span>, <span class="kw">nrow</span>(overlap1)))
  
  <span class="co">#Match on cleaned </span>
  overlap2 &lt;-<span class="st"> </span><span class="kw">merge</span>(a, b, <span class="dt">by.x =</span> <span class="st">&quot;a.cleaned&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;b.cleaned&quot;</span>)
  overlap2$step &lt;-<span class="st"> &quot;cleaned&quot;</span>
  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Cleaned: # matches = &quot;</span>, <span class="kw">nrow</span>(overlap2)))
  
  <span class="co">#Create master</span>
  master &lt;-<span class="st"> </span><span class="kw">rbind</span>(overlap1[,<span class="kw">c</span>(<span class="st">&quot;a.original&quot;</span>,<span class="st">&quot;b.original&quot;</span>, <span class="st">&quot;step&quot;</span>)], 
                  overlap2[,<span class="kw">c</span>(<span class="st">&quot;a.original&quot;</span>,<span class="st">&quot;b.original&quot;</span>, <span class="st">&quot;step&quot;</span>)])
  
  <span class="co">#De-dupe</span>
  master &lt;-<span class="st"> </span>master[ !<span class="kw">duplicated</span>(<span class="kw">paste</span>(master$a.original), master$b.original), ]
  <span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Total de-duplicated matches  = &quot;</span>, <span class="kw">nrow</span>(master)))
  <span class="kw">return</span>(master)
}</code></pre></div>

<p>When we apply these functions to the UN and EU data, we find <span class="math inline">\(n = 667\)</span> matches out of <span class="math inline">\(n = 1046\)</span> in the UN data set and <span class="math inline">\(n = 2016\)</span> in the EU data set.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  eu.un &lt;-<span class="st"> </span><span class="kw">canonicalNames</span>(un$wholename, eu$wholename)</code></pre></div>
<p>A closer examination of matches reveals that punctuation and capitalization accounts for the majority of the differences between names. This, however, omits name disambiguation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">tail</span>(eu.un, <span class="dv">6</span>)</code></pre></div>
<pre><code>## [1] &quot;Original: # matches = 4&quot;
## [1] &quot;Cleaned: # matches = 671&quot;
## [1] &quot;Total de-duplicated matches  = 667&quot;</code></pre>
<table>
<caption><span id="tab:unnamed-chunk-155">Table 3.8: </span>Comparison of Matched Records</caption>
<thead>
<tr class="header">
<th></th>
<th align="left">a.original</th>
<th align="left">b.original</th>
<th align="left">step</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>662</td>
<td align="left">ZAFAR IQBAL</td>
<td align="left">Zafar Iqbal</td>
<td align="left">cleaned</td>
</tr>
<tr class="even">
<td>663</td>
<td align="left">ZAKARYA ESSABAR</td>
<td align="left">Zakarya Essabar</td>
<td align="left">cleaned</td>
</tr>
<tr class="odd">
<td>664</td>
<td align="left">ZAKI-UR-REHMAN LAKHVI</td>
<td align="left">Zaki-ur-Rehman Lakhvi</td>
<td align="left">cleaned</td>
</tr>
<tr class="even">
<td>665</td>
<td align="left">ZIA-UR-RAHMAN MADANI</td>
<td align="left">Zia-ur-Rahman Madani</td>
<td align="left">cleaned</td>
</tr>
<tr class="odd">
<td>666</td>
<td align="left">ZULKARNAEN</td>
<td align="left">Zulkarnaen</td>
<td align="left">cleaned</td>
</tr>
<tr class="even">
<td>667</td>
<td align="left">ZULKIFLI ABDUL HIR</td>
<td align="left">Zulkifli Abdul Hir</td>
<td align="left">cleaned</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#JOINING</span>
  un.new &lt;-<span class="st"> </span><span class="kw">merge</span>(un, eu.un, 
                  <span class="dt">by.x =</span> <span class="st">&quot;wholename&quot;</span>, 
                  <span class="dt">by.y =</span> <span class="st">&quot;a.original&quot;</span>, 
                  <span class="dt">all.x =</span> <span class="ot">TRUE</span>)
  
  eu.new &lt;-<span class="st"> </span><span class="kw">merge</span>(eu, eu.un, 
                  <span class="dt">by.x =</span> <span class="st">&quot;wholename&quot;</span>, 
                  <span class="dt">by.y =</span> <span class="st">&quot;b.original&quot;</span>, 
                  <span class="dt">all.x =</span> <span class="ot">TRUE</span>)
  
  joint &lt;-<span class="st"> </span><span class="kw">merge</span>(un.new, eu.new,
                 <span class="dt">by.x =</span> <span class="st">&quot;b.original&quot;</span>, 
                 <span class="dt">by.y =</span> <span class="st">&quot;wholename&quot;</span>)</code></pre></div>

</div>
<div id="exercises-6" class="section level4 unnumbered">
<h4>Exercises</h4>
<ul>
<li>Conduct the same process on the US and UK data sets using the functions that you have written for cleaning and resolution.</li>
<li>Determine the total number of people who overlap between the UK and UN sanction lists, doing so also considering primary and secondary (AKA) aliases. In the UN file, aliases are listed under the <code>alias</code> field. In the UK list, entities are listed in long form, thus use a combination of the <code>Alias.Type</code> and <code>Group.ID</code> fields to identify unique individuals. Note that matching may require more than just character changes to names.</li>
</ul>

</div>
</div>
<div id="what-do-i-do-find-trends-in-transactional-or-event-level-data" class="section level3">
<h3><span class="header-section-number">3.8.3</span> What do I do find trends in transactional or event-level data?</h3>
<div id="motivation-2" class="section level4 unnumbered">
<h4>Motivation</h4>
<p>Before entering the world of statistical models and algorithms, cursory analysis of data is reliant on <em>aggregation</em>. Patterns emerge when the most granular records are aggregated,<a href="#fn29" class="footnoteRef" id="fnref29"><sup>29</sup></a> meaning that as information is summed and averaged by some unit of analysis, some aggregated units will be unambiguously higher than others – a sustained deviation away from random. But how exactly are records aggregated into summary statistics?</p>
<ul>
<li><p><em>Investment analysts</em> and in the <em>earth scientists</em> employ rolling averages – averaging data over a longer time window. The size of the window depends on what the data is being used for and the frequency of the data. Stock trades are refreshed in real-time, thus the rolling average window may be only minutes or hours. Satellite imagery on vegetation may be as frequent as daily or every two weeks, meaning the rolling average may be quite a bit wider such as a monthly-level average. For measures concerning the atmosphere, earth scientists will calculate a 30-year average that is known as a <em>climate normal</em> that shows the historically prevailing conditions.</p></li>
<li><p><em>Demographers</em> and <em>economists</em> count the number of people in the United States at the address of residence every 10 years. Since the data is <em>personally identifiable information</em> or <em>PII</em>, it is aggregated by discrete units of geography known as Census blocks, which is defined as a boundary that contains “at least 30,000 square feet (0.69 acre) for polygons bounded entirely by roads or 40,000 square feet (0.92 acres) for other polygons.”<a href="#fn30" class="footnoteRef" id="fnref30"><sup>30</sup></a> These blocks neatly roll up into higher units of analysis such as Census Block Groups, Census Tracts, Counties and States.</p></li>
</ul>
<p>It is easy to aggregate data in a way that emphasizes a misleading pattern. Perhaps the best known example is <em>gerrymandering</em>, which is the act of “drawing political boundaries to give your party a numeric advantage over an opposing party.”<a href="#fn31" class="footnoteRef" id="fnref31"><sup>31</sup></a> In theory in a representative democratic model, the proportion of the popular vote that is for a given party should be approximately equal to the number of elected congresspeople in the US House of Representatives. In 2012, while democrats had won roughly 49 percent of the House vote compared to 48.2 percent for Republicans, the scales swung in the favor of the Republicans winning a 234 seats and the Democrats with only 201 seats.<a href="#fn32" class="footnoteRef" id="fnref32"><sup>32</sup></a></p>
<p>We will thus be vigilant in ensuring that data analytics is free of gerrymandered insights.</p>
</div>
<div id="questions-this-answers" class="section level4 unnumbered">
<h4>Questions this answers</h4>
<p>By aggregating data into more meaningful units, we can begin to answer sim - When is the most busy period of the year? - Which units move together? -</p>
</div>
<div id="principles-1" class="section level4 unnumbered">
<h4>Principles</h4>
<ul>
<li>Better to obtain raw transactional data so that you have more control and options for aggregating data</li>
<li>Keep in mind that when sample is not randomly sampled or is not the entire potential universe, aggregation can be misleading</li>
<li>How you aggregate depends on the use of the data and the methods that one is comfortable with using.</li>
</ul>
</div>
<div id="a-worked-example-1" class="section level4 unnumbered">
<h4>A Worked example</h4>
<p>The Washington Area Transit Authority (WMATA or colloquially known as “The Metro”) reported that its 2017Q1 performance attained a train arrival on-time rate of 69%. This is a cursory, high-level measure that does not provide much insight. What data underlies those estimates?</p>
<div class="figure">
<img src="assets/manipulation/img/wmata.png" alt="Washington Metropolitan Area Transit Authority 2017Q1 Performance Report - Source: https://www.wmata.com/about/records/scorecard/index.cfm" />
<p class="caption">Washington Metropolitan Area Transit Authority 2017Q1 Performance Report - Source: <a href="https://www.wmata.com/about/records/scorecard/index.cfm" class="uri">https://www.wmata.com/about/records/scorecard/index.cfm</a></p>
</div>
<p>By scraping the WMATA website, it is possible to dive deeper into the delay patterns to develop a better understanding of delay patterns across the metro system, which in turn can help riders of the Metro gain insight about smart planning. The data set that has been assembled for this exercise was scraped for the period of July 2016 to July 2017.</p>
<p>What answers should we attempt to answer through simple aggregation?</p>
<ul>
<li>How long are delays?</li>
<li>When are delays most likely to occur?</li>
<li>Is there a time of year when delays are likely?</li>
<li>Which line has the longest delays</li>
</ul>
<p>To start, we load in the data from the <code>digIt</code> library. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(digIt)
wmata &lt;-<span class="st"> </span><span class="kw">digIt</span>(<span class="st">&quot;wmata&quot;</span>)</code></pre></div>

<p>First we’ll take a cursory glance at the data. To answer the questions, we will need only a few fields,</p>

<table>
<caption><span id="tab:unnamed-chunk-159">Table 3.9: </span>Example delay records</caption>
<thead>
<tr class="header">
<th align="left">field</th>
<th align="left">1</th>
<th align="left">1000</th>
<th align="left">3000</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">date</td>
<td align="left">July 30, 2016</td>
<td align="left">August 17, 2016</td>
<td align="left">December 09, 2016</td>
</tr>
<tr class="even">
<td align="left">dayofweek</td>
<td align="left">Saturday</td>
<td align="left">Wednesday</td>
<td align="left">Friday</td>
</tr>
<tr class="odd">
<td align="left">link</td>
<td align="left"><a href="https://www.wmata" class="uri">https://www.wmata</a>.</td>
<td align="left"><a href="https://www.wmata" class="uri">https://www.wmata</a>.</td>
<td align="left"><a href="https://www.wmata" class="uri">https://www.wmata</a>.</td>
</tr>
<tr class="even">
<td align="left">line</td>
<td align="left">Red</td>
<td align="left">Red</td>
<td align="left">Green</td>
</tr>
<tr class="odd">
<td align="left">direction</td>
<td align="left">Glenmont</td>
<td align="left">Grosvenor</td>
<td align="left">Branch Avenue</td>
</tr>
<tr class="even">
<td align="left">delay</td>
<td align="left">7</td>
<td align="left">11</td>
<td align="left">20</td>
</tr>
<tr class="odd">
<td align="left">time.occur</td>
<td align="left">11:27AM</td>
<td align="left">6:10AM</td>
<td align="left">11:12PM</td>
</tr>
<tr class="even">
<td align="left">text</td>
<td align="left">11:27 am A Glenmo</td>
<td align="left">6:10 am A Grosveno</td>
<td align="left">11:12 pm A Branch</td>
</tr>
<tr class="odd">
<td align="left">reason.spacing</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">reason.medical</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">reason.police</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">reason.brake</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">reason.equipment</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">reason.door</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">reason.operational</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">reason.disabled.tr</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">reason.arcing.insu</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">outcome.offboard</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">outcome.singletrac</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">outcome.shuttle</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">in.station</td>
<td align="left">Shady Grove</td>
<td align="left">Friendship Heights</td>
<td align="left">Columbia Heights</td>
</tr>
<tr class="even">
<td align="left">bw.station.1</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">bw.station.2</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>We’ll now create a date-time object. To do so, we’ll use <code>paste()</code> to concatenate date and time separated by a space and assign to a new vector. </p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">date.time &lt;-<span class="st"> </span><span class="kw">paste</span>(wmata$date, wmata$time.occur)
date.time[<span class="dv">1</span>]</code></pre></div>
<pre><code>## [1] &quot;July 30, 2016 11:27AM&quot;</code></pre>
<p>This new vector <code>date.time</code> is then processed using <code>strptime()</code> to convert strings into what is known as <em>POSIXlt</em>, a class of data objects that represent the number of seconds relative to the beginning of 1970 UTC.<a href="#fn33" class="footnoteRef" id="fnref33"><sup>33</sup></a> This makes it easier to keep track and calculate time at a granular level. The tricky part of this process is to accurately representing the time using conversion specifications. For the date above, the following specification is most appropriate:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spec &lt;-<span class="st">  &quot;%B %d,%Y %I:%M%p&quot;</span>
wmata$datetime &lt;-<span class="st"> </span><span class="kw">strptime</span>(date.time, spec)</code></pre></div>
<p>From the new date-time object, we can use <code>format()</code> to extract parts elements from <em>POSIXlt</em>, such as months (<code>%m</code>) and hours (<code>%H</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wmata$month &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">format</span>(wmata$datetime, <span class="st">&quot;%m&quot;</span>))
wmata$hour &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">format</span>(wmata$datetime, <span class="st">&quot;%H&quot;</span>))</code></pre></div>

<p>With the data prepped, we can proceed to roll up data by different dimensions. To start,</p>
<p>We’ll calculate the average, standard deviation and sample size for each station.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wmata.line &lt;-<span class="st"> </span><span class="kw">aggregate</span>(wmata$delay, 
                   <span class="dt">by =</span> <span class="kw">list</span>(<span class="dt">hour =</span> wmata$hour),
                   <span class="dt">FUN =</span> mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="kw">colnames</span>(wmata.line) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;station&quot;</span>,<span class="st">&quot;avg&quot;</span>)


<span class="kw">options</span>(<span class="dt">knitr.kable.NA =</span> <span class="st">&#39;&#39;</span>)
knitr::<span class="kw">kable</span>(wmata.line, <span class="dt">caption =</span> <span class="st">&quot;Average delay&quot;</span>, <span class="dt">digits =</span> <span class="dv">1</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">booktab =</span> <span class="ot">TRUE</span>)</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-163">Table 3.10: </span>Average delay</caption>
<thead>
<tr class="header">
<th align="right">station</th>
<th align="right">avg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">14.4</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">10.0</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">21.6</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">9.3</td>
</tr>
<tr class="odd">
<td align="right">6</td>
<td align="right">7.2</td>
</tr>
<tr class="even">
<td align="right">7</td>
<td align="right">7.5</td>
</tr>
<tr class="odd">
<td align="right">8</td>
<td align="right">7.4</td>
</tr>
<tr class="even">
<td align="right">9</td>
<td align="right">8.4</td>
</tr>
<tr class="odd">
<td align="right">10</td>
<td align="right">9.1</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="right">9.5</td>
</tr>
<tr class="odd">
<td align="right">12</td>
<td align="right">9.2</td>
</tr>
<tr class="even">
<td align="right">13</td>
<td align="right">8.8</td>
</tr>
<tr class="odd">
<td align="right">14</td>
<td align="right">9.0</td>
</tr>
<tr class="even">
<td align="right">15</td>
<td align="right">6.9</td>
</tr>
<tr class="odd">
<td align="right">16</td>
<td align="right">6.8</td>
</tr>
<tr class="even">
<td align="right">17</td>
<td align="right">8.4</td>
</tr>
<tr class="odd">
<td align="right">18</td>
<td align="right">8.5</td>
</tr>
<tr class="even">
<td align="right">19</td>
<td align="right">10.1</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="right">9.4</td>
</tr>
<tr class="even">
<td align="right">21</td>
<td align="right">11.3</td>
</tr>
<tr class="odd">
<td align="right">22</td>
<td align="right">10.9</td>
</tr>
<tr class="even">
<td align="right">23</td>
<td align="right">11.1</td>
</tr>
</tbody>
</table>
</div>
<div id="exericse" class="section level4 unnumbered">
<h4>Exericse</h4>
<p>In 10 or fewer lines of code, write a function to extract the time at which train delays occurred and how long they lasted. The function should accept a string vector and return a data frame with two fields: a string field that contains the hour, minute, and time of day (AM or PM) time and a numeric field for the delay in minutes.</p>
<p>Include standard annotation in the function to indicate how to use it. Test your function on the ‘text’ field in the wmata data set, then check the accuracy of results against the time and delay fields.</p>
<p>Tip: <em>Use regular expressions!</em></p>

</div>
</div>
<div id="i-have-a-lot-of-text.-how-do-extract-basic-keywords" class="section level3">
<h3><span class="header-section-number">3.8.4</span> I have a lot of text. How do extract basic keywords?</h3>
<div id="motivation-3" class="section level4 unnumbered">
<h4>Motivation</h4>
<p>Tabular data can sometimes be a luxury. For it to exist, it requires someone to spend time and effort to meticulously collect and structure data into a clean, well-defined format. Textual data, in contrast, does not have structure. As is obvious to most people, text conveys meaning, but not all of the words in a document are necessary to understand its contents. We naturally search for keywords and groups of keywords, which then become structured information. From the structure information, we can glean what topics are contained in numerous documents. When done at scale, it becomes possible to traverse boundless amounts of textual information and sift the things that matter.</p>
<p>This is the basic idea of text processing and natural language processing (NLP). Text and language can be manipulated to glean insight at scale, enabling one to answer questions such as:</p>
<ul>
<li>What are keywords best describe a text? (e.g. tagging)</li>
<li>How do two texts relate to one another?</li>
<li>Which other texts are similar?</li>
<li>What’s the tone of a corpus of documents?</li>
<li>What distinct topics are mentioned in the text and by whom?</li>
</ul>
</div>
<div id="principles-2" class="section level4 unnumbered">
<h4>Principles</h4>
<p>NLP is a vast and growing field. Similar to the example presented at the beginning of the chapter, basic text manipulation starts with <em>tokenization</em>, or the process of parsing a character sequence or string into smaller pieces referred to as tokens. In the case of a sentence, a token may be a word, but it also may take on the form of a n-word phrase. The goal is to convert strings into smaller more comparable units. Thus, before tokenization is applied to a sentence, strings are converted into comparable formats such as capitalization (<code>tolower()</code> or <code>toupper()</code>), without punctuation (<code>gsub()</code>), among others.</p>
<p>Upon cleaning the text, <em>n-grams</em> – a sequence of n-sequential tokens – can be derived from each sentence. For example, let’s suppose we were to tokenize the following two sentences:</p>
<blockquote>
<p>Maya is a physical scientist. Olivia is a data scientist.</p>
</blockquote>
<p>From these two sentence, we can derive a vector of uni-grams and bi-grams for each sentence:</p>
<table>
<caption><span id="tab:unnamed-chunk-164">Table 3.11: </span>n-grams for two sentences</caption>
<thead>
<tr class="header">
<th align="left">Sentence</th>
<th align="left">1-gram</th>
<th align="left">2-grams</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">Maya</td>
<td align="left">Maya is</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">is</td>
<td align="left">is a</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">a</td>
<td align="left">a physical</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">physical</td>
<td align="left">physical scientist</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">scientist</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">Olivia</td>
<td align="left">Olivia is</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">is</td>
<td align="left">is a</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">a</td>
<td align="left">a data</td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">data</td>
<td align="left">data scientist</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">scientist</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>This should result in a vector of many words and short phrases. Notice that short sentences quickly grow into a larger number of records. Imagine when a corpus of documents contains thousands of records that need to be analyzed. To whittle down the data to essential terms, stop words such as “is and”an&quot; can be removed, which remove words that are essentially the padding that makes language sound good. Removing stop words also reduces the storage and process requirements.</p>
<p>From the vector of words, term frequencies can be tabulated for each sentence or document. In some cases, term frequencies can be used to identify topics or represent the absolutely significance of certain words. But, more often than not, the <em>relative</em> importance of words is more meaningful. <em>Term Frequency - Inverse Document Frequency</em> (TF-IDF), a simple term re-weighting calculation, can vastly improve ranking of importance of words by converting frequencies into values that reflect relative importance between textual documents. TF-IDF is widely used in information indexing and search systems to help re-rank documents based on terms The calculation is as follows:</p>
<p><span class="math display">\[\text{TF-IDF} = \frac{n_{it}}{n_i} \times ln(\frac{N}{N_t})\]</span></p>
<p>where <span class="math inline">\(n_t\)</span> is the number of times term <span class="math inline">\(t\)</span> appears in a document <span class="math inline">\(i\)</span>, <span class="math inline">\(n\)</span> is the number of terms in document <span class="math inline">\(i\)</span>, <span class="math inline">\(N\)</span> is the total number of documents, and <span class="math inline">\(N_t\)</span> is the number of documents that contain term <span class="math inline">\(t\)</span>. This two step calculation compares the relative prevalence of a term in a document and scales it by that term’s prevalence in the corpus – a simple, but powerful analytical trick. From these fundamental processing steps, more advanced techniques can be built on top such as topic modeling, which is used to find latent groups of topics within documents, as well as build content-based recommendation engines that suggest products based on how the qualities of a product overlap with a consumer’s interest profile. There are plenty of libraries designed to make text processing easy, such as <code>tm</code> and <code>tidyr</code>, but to understand the underlying mechanics, we will illustrate basic processing with base R functionality.</p>
</div>
<div id="a-worked-example-2" class="section level4 unnumbered">
<h4>A Worked example</h4>
<p>Political scientists and journalists often times count the number of times Congress applauds the President when delivering the State of the Union (SOTU) Address as well as analyzes the number of times words are used. While it is not a clear science, applying data manipulation techniques to create an analyzable dataset can certainly be fascinating. To illustrate a real clean up workflow with some data manipulation, we will use the SOTU transcripts from the Obama Administration. An interesting attribute of the transcripts are that they reflect the number of applause breaks as planned for by the speechwriters and policymakers as opposed to the actual number. Using this data, we will answer the following three questions:</p>
<ol style="list-style-type: decimal">
<li>How many breaks were planned in 2010 vs 2016?</li>
<li>What were the top 10 words used in each of those state of the unions?</li>
<li>Which words experienced relatively greater use?</li>
</ol>
<p><strong>How many planned applause breaks in 2010 versus 2016?</strong> To start, let’s load just the 2010 data into memory and inspect one paragraph from the speech. Looking at the data, the speechwriters included queues for applause as denoted as <code>(Applause.)</code>.</p>
<p>The 2010 data can be accessed using the <code>digIt()</code> function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">library</span>(digIt)
  speech &lt;-<span class="st"> </span><span class="kw">digIt</span>(<span class="st">&quot;speech_2010&quot;</span>)</code></pre></div>
<p>or using <code>readLines()</code> to import the data directly via from the Amazon Web Services server that hosts the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  speech &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;https://s3.amazonaws.com/dspp/speech_2010.txt&quot;</span>)</code></pre></div>
<p>Upon loading the data, we remove blank lines and take a look at a randomly selected line in the speech.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  speech &lt;-<span class="st"> </span>speech[speech!=<span class="st">&quot;&quot;</span>]
  speech[<span class="dv">12</span>]</code></pre></div>
<pre><code>## [1] &quot;It&#39;s because of this spirit -\xd0 this great decency and great strength -\xd0 that I have never been more hopeful about America&#39;s future than I am tonight.  (Applause.)  Despite our hardships, our union is strong.  We do not give up.  We do not quit.  We do not allow fear or division to break our spirit.  In this new decade, it&#39;s time the American people get a government that matches their decency; that embodies their strength.  (Applause.)   &quot;</code></pre>
<p>Using that piece of information, we can write a relatively short set of steps to match the <em>Applause</em> pattern. 57 breaks were planned in 2010, which is 11 more than the 46 breaks planned in 2016. While the same code was run two separate times, we will learn in a subsequent chapter how to automate repetitive tasks.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#2010</span>
  <span class="co">#read in lines from the text</span>
  speech10 &lt;-<span class="st"> </span><span class="kw">digIt</span>(<span class="st">&quot;speech_2010&quot;</span>)</code></pre></div>
<pre><code>## speech_2010 has been loaded into memory.</code></pre>
<pre><code>## Dimensions: # lines = 223</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co">#remove any blank lines</span>
  speech10 &lt;-<span class="st"> </span>speech10[speech10!=<span class="st">&quot;&quot;</span>]
  
  <span class="co">#get string position of each Applause (returns positive values if matched)</span>
  ind &lt;-<span class="st"> </span><span class="kw">regexpr</span>(<span class="st">&quot;Applause&quot;</span>, speech10)
  <span class="kw">sum</span>(<span class="kw">attr</span>(ind,<span class="st">&quot;match.length&quot;</span>)&gt;<span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] 57</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#2016</span>
  speech16 &lt;-<span class="st"> </span><span class="kw">digIt</span>(<span class="st">&quot;speech_2016&quot;</span>)</code></pre></div>
<pre><code>## speech_2016 has been loaded into memory.</code></pre>
<pre><code>## Dimensions: # lines = 172</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  speech16 &lt;-<span class="st"> </span>speech16[speech16!=<span class="st">&quot;&quot;</span>]
  ind &lt;-<span class="st"> </span><span class="kw">regexpr</span>(<span class="st">&quot;Applause&quot;</span>, speech16)
  <span class="kw">sum</span>(<span class="kw">attr</span>(ind,<span class="st">&quot;match.length&quot;</span>)&gt;<span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] 46</code></pre>

<p><strong>What were the top words in 2010 vs 2016</strong></p>
<p>To do this, we’ll need to do some basic cleaning to start (e.g. remove punctuation, remove numbers, remove non-graphical characters like <code>\r</code>), parse the words into a vector of words or ‘bag of words’, and aggregate words into word counts.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#2010</span>
  <span class="co">#Clean up and standardize values</span>
  clean10 &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>,<span class="st">&quot;&quot;</span>,speech10)
  clean10 &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;[[:digit:]]&quot;</span>,<span class="st">&quot;&quot;</span>,clean10)
  clean10 &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;[^[:graph:]]&quot;</span>,<span class="st">&quot; &quot;</span>,clean10)
  
  <span class="co">#convert into bag of words</span>
  bag10 &lt;-<span class="st"> </span><span class="kw">strsplit</span>(clean10,<span class="st">&quot; &quot;</span>)
  bag10 &lt;-<span class="st"> </span><span class="kw">tolower</span>(<span class="kw">trimws</span>(<span class="kw">unlist</span>(bag10)))
  
  <span class="co">#Count the number of times a word shows up</span>
  counts10 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(bag10, <span class="dt">by=</span><span class="kw">list</span>(bag10), <span class="dt">FUN=</span>length)
  <span class="kw">colnames</span>(counts10) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;word&quot;</span>,<span class="st">&quot;freq&quot;</span>)
  counts10$len &lt;-<span class="st"> </span><span class="kw">nchar</span>(<span class="kw">as.character</span>(counts10$word))
  counts10 &lt;-<span class="st"> </span>counts10[counts10$len&gt;<span class="dv">2</span>,]
  counts10 &lt;-<span class="st"> </span>counts10[<span class="kw">order</span>(-counts10$freq),]
  <span class="kw">head</span>(counts10, <span class="dv">10</span>)</code></pre></div>
<pre><code>##          word freq len
## 1478      the  338   3
## 76        and  237   3
## 1476     that  149   4
## 1030      our  120   3
## 87   applause  116   8
## 603       for   84   3
## 1649     will   61   4
## 1493     this   60   4
## 91        are   57   3
## 695      have   53   4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#2016</span>
  clean16 &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;[[:punct:]]&quot;</span>,<span class="st">&quot;&quot;</span>,speech16)
  clean16 &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;[[:digit:]]&quot;</span>,<span class="st">&quot;&quot;</span>,clean16)
  clean16 &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;[^[:graph:]]&quot;</span>,<span class="st">&quot; &quot;</span>,clean16)
  
  bag16 &lt;-<span class="st"> </span><span class="kw">strsplit</span>(clean16,<span class="st">&quot; &quot;</span>)
  bag16 &lt;-<span class="st"> </span><span class="kw">tolower</span>(<span class="kw">trimws</span>(<span class="kw">unlist</span>(bag16)))
  
  counts16 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(bag16, <span class="dt">by=</span><span class="kw">list</span>(bag16), <span class="dt">FUN=</span>length)
  <span class="kw">colnames</span>(counts16) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;word&quot;</span>,<span class="st">&quot;freq&quot;</span>)
  counts16$len &lt;-<span class="st"> </span><span class="kw">nchar</span>(<span class="kw">as.character</span>(counts16$word))
  counts16 &lt;-<span class="st"> </span>counts16[counts16$len &gt;<span class="st"> </span><span class="dv">2</span>,]
  counts16 &lt;-<span class="st"> </span>counts16[<span class="kw">order</span>(-counts16$freq),]
  <span class="kw">head</span>(counts16, <span class="dv">10</span>)</code></pre></div>
<pre><code>##          word freq len
## 1366      the  284   3
## 57        and  193   3
## 1364     that  146   4
## 935       our   94   3
## 70   applause   89   8
## 530       for   59   3
## 1377     this   41   4
## 1521      who   41   3
## 898       not   40   3
## 182       but   39   3</code></pre>

<p>Looking at the words above, it feels a bit unsatisfying. To improve the list, we’ll use a stop word list to remove words that hold little meaning (e.g. the padding language).</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Import and remove stop words</span>
 stopwords &lt;-<span class="st"> </span><span class="kw">digIt</span>(<span class="st">&quot;stopwords&quot;</span>)</code></pre></div>
<pre><code>## stopwords has been loaded into memory.</code></pre>
<pre><code>## Dimensions: n = 543, k = 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> stopwords &lt;-<span class="st"> </span><span class="kw">as.vector</span>(stopwords)
  
<span class="co">#Remove stop words</span>
  counts10 &lt;-<span class="st"> </span>counts10[!(counts10$word %in%<span class="st"> </span>stopwords),]
  counts16 &lt;-<span class="st"> </span>counts16[!(counts16$word %in%<span class="st"> </span>stopwords),]</code></pre></div>

<p>In addition, the importance of words may not be well-represented using term frequencies. The words “America” and “Freedom” are likely to appear in many SOTU speeches, but do not reflect the distinct foci of each address. We can write a simple function to calculate <code>TF-IDF</code> in order to surface terms of relative importance with respect to each speech.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tfidf &lt;-<span class="st"> </span>function(terms, freq, doc){
  <span class="co">#</span>
  <span class="co"># Desc:</span>
  <span class="co">#   Returns a TF-IDF index for a set of terms and documents</span>
  <span class="co">#</span>
  <span class="co"># Args:</span>
  <span class="co">#   terms = vector of terms</span>
  <span class="co">#   freq = vector of frequencies for each term</span>
  <span class="co">#   doc = vector of document membership </span>
  <span class="co">#</span>
  <span class="co"># Returns:</span>
  <span class="co">#   TF-IDF values for each term by document</span>
  
  <span class="co">#Calculate components</span>
    N &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(doc))
    Nt &lt;-<span class="st"> </span><span class="kw">aggregate</span>(doc, <span class="dt">by =</span> <span class="kw">list</span>(terms), <span class="dt">FUN =</span> length)
    <span class="kw">colnames</span>(Nt)[<span class="dv">2</span>] &lt;-<span class="st"> &quot;Nt&quot;</span>
    nit &lt;-<span class="st"> </span>freq
    ni &lt;-<span class="st"> </span><span class="kw">aggregate</span>(freq, <span class="dt">by =</span> <span class="kw">list</span>(doc), <span class="dt">FUN =</span> sum)
    <span class="kw">colnames</span>(ni)[<span class="dv">2</span>] &lt;-<span class="st"> &quot;ni&quot;</span>
    
  <span class="co">#Combine  </span>
    out &lt;-<span class="st"> </span><span class="kw">data.frame</span>(terms, doc, <span class="dt">N =</span> N, <span class="dt">nit =</span> nit)
    out &lt;-<span class="st"> </span><span class="kw">merge</span>(out, Nt, <span class="dt">by.x =</span> <span class="st">&quot;terms&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;Group.1&quot;</span>, <span class="dt">all =</span> T)
    out &lt;-<span class="st"> </span><span class="kw">merge</span>(out, ni, <span class="dt">by.x =</span> <span class="st">&quot;doc&quot;</span>, <span class="dt">by.y =</span> <span class="st">&quot;Group.1&quot;</span>, <span class="dt">all =</span> T)
    out$tfidf &lt;-<span class="st"> </span>(out$nit/out$ni) *<span class="st"> </span><span class="kw">log</span>(out$N /<span class="st"> </span>out$Nt)
  
  <span class="co">#Return</span>
    <span class="kw">return</span>(out[<span class="kw">order</span>(-out$tfidf), <span class="kw">c</span>(<span class="st">&quot;doc&quot;</span>, <span class="st">&quot;terms&quot;</span>,  <span class="st">&quot;tfidf&quot;</span>)])
}</code></pre></div>
<p>We can now reweight the terms of the two speeches. Note that TFIDF values will become more distinct with a greater diversity of textual documents.</p>

<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Append data sets together</span>
  master &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">data.frame</span>(<span class="dt">doc =</span> <span class="dv">2010</span>, counts10),
                  <span class="kw">data.frame</span>(<span class="dt">doc =</span> <span class="dv">2016</span>, counts16))

<span class="co">#Weight results</span>
  reweighted &lt;-<span class="st"> </span><span class="kw">tfidf</span>(<span class="dt">terms =</span> master$word,
                      <span class="dt">freq =</span> master$freq,
                      <span class="dt">doc =</span> master$doc)
  
<span class="co">#Results</span>
  <span class="kw">head</span>(reweighted[reweighted$doc==<span class="dv">2010</span>,], <span class="dv">10</span>)
  <span class="kw">head</span>(reweighted[reweighted$doc==<span class="dv">2016</span>,], <span class="dv">10</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">doc</th>
<th align="left">terms</th>
<th align="right">tfidf</th>
<th align="right">doc</th>
<th align="left">terms</th>
<th align="right">tfidf</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2010</td>
<td align="left">lets</td>
<td align="right">0.0017457</td>
<td align="right">2016</td>
<td align="left">isil</td>
<td align="right">0.0013106</td>
</tr>
<tr class="even">
<td align="right">2010</td>
<td align="left">bill</td>
<td align="right">0.0015129</td>
<td align="right">2016</td>
<td align="left">doesn</td>
<td align="right">0.0011650</td>
</tr>
<tr class="odd">
<td align="right">2010</td>
<td align="left">theyre</td>
<td align="right">0.0015129</td>
<td align="right">2016</td>
<td align="left">him</td>
<td align="right">0.0011650</td>
</tr>
<tr class="even">
<td align="right">2010</td>
<td align="left">values</td>
<td align="right">0.0013965</td>
<td align="right">2016</td>
<td align="left">voices</td>
<td align="right">0.0011650</td>
</tr>
<tr class="odd">
<td align="right">2010</td>
<td align="left">cant</td>
<td align="right">0.0012802</td>
<td align="right">2016</td>
<td align="left">don</td>
<td align="right">0.0008737</td>
</tr>
<tr class="even">
<td align="right">2010</td>
<td align="left">deficit</td>
<td align="right">0.0011638</td>
<td align="right">2016</td>
<td align="left">opportunity</td>
<td align="right">0.0008737</td>
</tr>
<tr class="odd">
<td align="right">2010</td>
<td align="left">home</td>
<td align="right">0.0009310</td>
<td align="right">2016</td>
<td align="left">elected</td>
<td align="right">0.0007281</td>
</tr>
<tr class="even">
<td align="right">2010</td>
<td align="left">recovery</td>
<td align="right">0.0009310</td>
<td align="right">2016</td>
<td align="left">needs</td>
<td align="right">0.0007281</td>
</tr>
<tr class="odd">
<td align="right">2010</td>
<td align="left">americas</td>
<td align="right">0.0006983</td>
<td align="right">2016</td>
<td align="left">planet</td>
<td align="right">0.0007281</td>
</tr>
<tr class="even">
<td align="right">2010</td>
<td align="left">house</td>
<td align="right">0.0006983</td>
<td align="right">2016</td>
<td align="left">almost</td>
<td align="right">0.0005825</td>
</tr>
<tr class="odd">
<td align="right"></td>
<td align="left">{12pt}</td>
<td align="right"></td>
<td align="right"></td>
<td align="left"></td>
<td align="right"></td>
</tr>
</tbody>
</table>
<p>At this point, we’ve arrived at words that are more presidential sounding, but can still be whittled down to the core message. But that can be left for another day.</p>
</div>
<div id="exercises-7" class="section level4 unnumbered">
<h4>Exercises</h4>
<ul>
<li>Modify the code to compare the 2010 SOTU to the 2012 SOTU.</li>
<li>Optimize the above code to import and process 2010 through 2016 SOTUs to estimate the TF-IDF values.</li>
</ul>

</div>
</div>
<div id="edge-detection-of-images" class="section level3">
<h3><span class="header-section-number">3.8.5</span> Edge detection of images?</h3>
<div id="motivation-4" class="section level4 unnumbered">
<h4>Motivation</h4>
<p>Ever wonder how an algorithm can effortlessly identify the outline of an object in a photograph? It may seem like magic, but it is really a matter of basic mathematical operations along a grid. To build up to the magic, we begin with a few basic concepts.</p>
<p>A digital photograph is comprised of pixels, which are arrange at equal intervals in a grid. From a data perspective, pixels can hold multiple values. A photograph that is captured in RGB or Red-Green-Blue contains three channels of information based in different parts of the visible light spectrum. Each pixel in turn holds three values – one for each color, which can be brought together to represent what a camera witnessed at the time of capture. A grayscale image has only one channel that can take one of 255 unique values. A RGB photograph is essentially three overlaid matrices. A grayscale image is one matrix where each pixel is one cell in the matrix.</p>
<p>Suppose we were to look at one row of pixels in a photograph. As we progress from one side to the other, the pixel values may change – sometimes due to noise and sometimes due to different objects that are captured when composing a photograph. A meaningful change in the pixel values along each row and each column can be viewed as an edge: <em>an edge is defined as a point in an image in which values transition</em>. The noise in the photograph make <em>edge detection</em> a challenge, thus noise should be removed by blurring the image, or averaging values around each pixel in some consistent manner. The before and after results for a given row or column of pixels may resemble the result below.</p>
<pre><code>## Warning in c(rep(5, 20), 200/(1 + exp(20:-20))) + 30 - 30 * runif(41):
## longer object length is not a multiple of shorter object length</code></pre>
<pre><code>## Warning in c(rep(5, 20), 200/(1 + exp(20:-20))) + 30 - 30 * runif(41) + :
## longer object length is not a multiple of shorter object length</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-174"></span>
<img src="Data_Science__A_Practical_Strategy_files/figure-html/unnamed-chunk-174-1.png" alt="Example of raw and smoothed greyscale values along a row of pixels" width="672" />
<p class="caption">
Figure 3.1: Example of raw and smoothed greyscale values along a row of pixels
</p>
</div>
<p>Next, detecting an edge is a matter of calculating the <em>gradient</em> in the pixels, or how much change in values is observed around each pixel in both vertical and horizontal directions. <em>Gradient operators</em> are mathematical methods of calculating those gradients and are used to determine the strength of the gradient and its direction. The gradient for the example row of pixels is plotted below. Local maxima in the gradients can be used to define a edge threshold.</p>
<pre><code>## Warning in `[&lt;-.factor`(`*tmp*`, 61:nrow(df), value = structure(c(2L, 2L, :
## invalid factor level, NA generated</code></pre>
<pre><code>## Warning: Removed 62 rows containing missing values (geom_path).</code></pre>
<pre><code>## Warning: Removed 62 rows containing missing values (geom_point).</code></pre>
<div class="figure"><span id="fig:unnamed-chunk-175"></span>
<img src="Data_Science__A_Practical_Strategy_files/figure-html/unnamed-chunk-175-1.png" alt="Gradient for smoothed pixel values" width="672" />
<p class="caption">
Figure 3.2: Gradient for smoothed pixel values
</p>
</div>
<p>There are a variety of edge detection methods used in the wild, among the most commonly used is the <em>Canny Edge Detection</em> algorithm<a href="#fn34" class="footnoteRef" id="fnref34"><sup>34</sup></a> The mathematics of edge detection can be fairly straight forward; However, there is a diversified toolkit of transformations that have been developed to improve the results.</p>
</div>
<div id="a-worked-example-3" class="section level4 unnumbered">
<h4>A Worked example</h4>
<p>To illustrate how edge detection works, we will use a high contrast photograph of Marine One flying over Washington D.C. Images that are “busy” (have many overlapping objects) may prove to be more challenging to identify clear cut edges. To start, we use the <code>digIt()</code> library to retrieve the image and render it using <code>image()</code>, specifying <code>asp = 1</code> for an aspect ratio of 1:1. The helicopter is easy to identify with some propeller detail despite being a low resolution image with 134 x 157 pixels and 3 channels (RGB).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">library</span>(digIt)
<span class="kw">require</span>(raster)
  img &lt;-<span class="st"> </span><span class="kw">digIt</span>(<span class="st">&quot;image_set_marine1&quot;</span>)
  <span class="kw">image</span>(img, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">main =</span> <span class="st">&quot;Marine One&quot;</span>)</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-176"></span>
<img src="Data_Science__A_Practical_Strategy_files/figure-html/unnamed-chunk-176-1.png" alt="Raw image of Marine One" width="672" />
<p class="caption">
Figure 3.3: Raw image of Marine One
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">dim</span>(img)</code></pre></div>
<pre><code>## [1] 134 157   3</code></pre>
<p>To make the data manipulation simpler, the three color channels can be weighted to derive greyscale values.<a href="#fn35" class="footnoteRef" id="fnref35"><sup>35</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#convert to greyscale</span>
  img1 &lt;-<span class="st"> </span>img[[<span class="dv">1</span>]]*<span class="fl">0.2126</span> +<span class="st"> </span>
<span class="st">          </span>img[[<span class="dv">2</span>]]*<span class="fl">0.7152</span> +<span class="st"> </span>
<span class="st">          </span>img[[<span class="dv">3</span>]]*<span class="fl">0.0722</span>

<span class="co">#render image</span>
  <span class="kw">image</span>(img1, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">col =</span><span class="kw">paste</span>(<span class="st">&quot;gray&quot;</span>,<span class="dv">1</span>:<span class="dv">99</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-177"></span>
<img src="Data_Science__A_Practical_Strategy_files/figure-html/unnamed-chunk-177-1.png" alt="Converted to greyscale" width="672" />
<p class="caption">
Figure 3.4: Converted to greyscale
</p>
</div>
<p>Notice that the above image contains noise and pixelation, which may disrupt the detection of true edges in the photograph. A blur filter can be applied using any number of techniques. The Gaussian filter is a method that applies a kernel to an <span class="math inline">\(n \times n\)</span> areas around a given pixel, placing the greatest weight on the central pixel and less weight on pixels that are farther from the center. For the Canny approach, a <span class="math inline">\(5 \times 5\)</span> matrix – also known as a filter mask – is used as the basis to calculate a weighted average pixel value around each pixel:</p>
<p><span class="math display">\[\begin{bmatrix} 2 &amp; 4 &amp; 5 &amp; 4 &amp; 2 \\ 4&amp; 9&amp; 12&amp; 9&amp; 4\\ 5&amp; 12&amp; 15&amp; 12&amp; 5\\ 4&amp; 9&amp; 12&amp; 9&amp; 4 \\ 2&amp; 4&amp; 5&amp; 4&amp; 2 \end{bmatrix}\]</span></p>
<p>For a photograph of <span class="math inline">\(100 \times 100\)</span> pixels, the filter mask is applied to each of the 1000 pixels in order to estimate its blurred (smoothed) value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#(1) Blur Image  ---------------------------------</span>
  gaussianBlur &lt;-<span class="st"> </span>function(mat){
    <span class="co"># Blur an image using a Gaussian kernel</span>
    <span class="co"># </span>
    <span class="co"># Args:</span>
    <span class="co">#  mat = image in matrix form</span>
    <span class="co">#</span>
    <span class="co"># Returns:</span>
    <span class="co">#  Blurred image</span>
    <span class="co">#</span>
    
    filter5 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">2</span>,
                        <span class="dv">4</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">9</span>,<span class="dv">4</span>,
                        <span class="dv">5</span>,<span class="dv">12</span>,<span class="dv">15</span>,<span class="dv">12</span>,<span class="dv">5</span>,
                        <span class="dv">4</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">9</span>,<span class="dv">4</span>,
                        <span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">2</span>), 
                      <span class="dt">ncol =</span> <span class="dv">5</span>, <span class="dt">nrow =</span> <span class="dv">5</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)
    tot &lt;-<span class="st"> </span><span class="kw">sum</span>(filter5)
    
    <span class="co">#placeholder matrix</span>
    new &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol =</span> <span class="kw">ncol</span>(mat), <span class="dt">nrow =</span> <span class="kw">nrow</span>(mat))
    
    <span class="co">#loop through each cell by row and column </span>
    for(i in <span class="dv">2</span>:(<span class="kw">ncol</span>(mat)-<span class="dv">2</span>)){
      for(j in <span class="dv">2</span>:(<span class="kw">nrow</span>(mat)-<span class="dv">2</span>)){
        new[j,i] &lt;-<span class="st"> </span><span class="kw">sum</span>((mat[(j<span class="dv">-2</span>):(j<span class="dv">+2</span>), (i<span class="dv">-2</span>):(i<span class="dv">+2</span>)] *<span class="st"> </span>filter5)) /<span class="st"> </span>tot
      }
    }
    
    <span class="co">#resulting image is upside down and rotated, apply transformations to rectify</span>
    new &lt;-<span class="st"> </span><span class="kw">apply</span>(new, <span class="dv">2</span>, rev)
    new &lt;-<span class="st"> </span><span class="kw">t</span>(new)
    
    <span class="co">#return result</span>
    <span class="kw">return</span>(new)
    
  }

<span class="co">#Test blur function on Marine One</span>
  new &lt;-<span class="st"> </span><span class="kw">gaussianBlur</span>(img1)
  <span class="kw">image</span>(new, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="kw">paste</span>(<span class="st">&quot;grey&quot;</span>, <span class="dv">1</span>:<span class="dv">99</span>))</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-178"></span>
<img src="Data_Science__A_Practical_Strategy_files/figure-html/unnamed-chunk-178-1.png" alt="Gaussian blur applied to image to average out noise." width="672" />
<p class="caption">
Figure 3.5: Gaussian blur applied to image to average out noise.
</p>
</div>
<p>Next, edges can be detected using a Sobel operator. The operator makes use of two masks – one for rows and one for columns:</p>
<p><span class="math display">\[\text{kernel}_x=\begin{bmatrix} -1 &amp; 0 &amp; 1 \\ -2&amp; 0&amp; 2\\ -1&amp; 0&amp; 1 \end{bmatrix}, 
\text{  kernel}_y=\begin{bmatrix} 1 &amp; 2 &amp; 1 \\ 0&amp; 0&amp; 0\\ -1&amp; 2&amp; -1 \end{bmatrix}\]</span></p>
<p>For each pixel in the blurred image, each <span class="math inline">\(\text{kernel}_x\)</span> and <span class="math inline">\(\text{kernel}_y\)</span> are applied to produce the point estimate of the gradient <span class="math inline">\(G\)</span> as the first derivative for each the x and y axes. The resulting values can be combined to estimate the gradient strength <span class="math inline">\(G =\sqrt{G_x^2+G_y^2}\)</span> and edge direction <span class="math inline">\(\theta = atan2(\frac{|G_y|}{|G_x|}) \frac{180}{\pi}\)</span>. Below, the Sobel operator is programmed as as a function <code>sobel()</code> that accepts a blurred image in matrix form.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#(2) Gradient magnitudes</span>
  sobel &lt;-<span class="st"> </span>function(mat){
    <span class="co"># Apply a Sobel operator to image matrix, returns strength and direction of edges</span>
    <span class="co"># </span>
    <span class="co"># Args:</span>
    <span class="co">#  mat = blurred image in matrix form</span>
    <span class="co">#</span>
    <span class="co"># Returns:</span>
    <span class="co">#  A list object with two matrices: one for gradient strength and one for edges</span>
    <span class="co">#</span>
    
    <span class="co">#filters</span>
    xkernel &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(-<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>,
                        -<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>,
                        -<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>), 
                      <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)
    ykernel &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>,
                        <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,
                        -<span class="dv">1</span>, -<span class="dv">2</span>, -<span class="dv">1</span>), 
                      <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)
    
    <span class="co">#Placeholders</span>
    strength &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol =</span> <span class="kw">ncol</span>(mat), <span class="dt">nrow =</span> <span class="kw">nrow</span>(mat))
    direction &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol =</span> <span class="kw">ncol</span>(mat), <span class="dt">nrow =</span> <span class="kw">nrow</span>(mat))
    
    <span class="co">#Calculate 1st derivative gradients</span>
    for(j in <span class="dv">2</span>:(<span class="kw">nrow</span>(mat)-<span class="dv">1</span>)){
      for(i in <span class="dv">2</span>:(<span class="kw">ncol</span>(mat)-<span class="dv">1</span>)){
        <span class="co">#Calculate gradient</span>
        valx &lt;-<span class="st"> </span><span class="kw">sum</span>(mat[(j<span class="dv">-1</span>):(j<span class="dv">+1</span>), (i<span class="dv">-1</span>):(i<span class="dv">+1</span>)] *<span class="st"> </span>xkernel)
        valy &lt;-<span class="st"> </span><span class="kw">sum</span>(mat[(j<span class="dv">-1</span>):(j<span class="dv">+1</span>), (i<span class="dv">-1</span>):(i<span class="dv">+1</span>)] *<span class="st"> </span>ykernel)
        
        <span class="co">#Combine into strength and direction</span>
        strength[j,i] &lt;-<span class="st"> </span><span class="kw">sqrt</span>((valx)^<span class="dv">2</span> +<span class="st"> </span>(valy)^<span class="dv">2</span>)
        direction[j,i] &lt;-<span class="st"> </span><span class="kw">atan</span>(<span class="kw">abs</span>(valy)/<span class="kw">abs</span>(valx)) *<span class="st"> </span><span class="dv">180</span> /<span class="st"> </span>pi
      }
    }
    
    <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">strength =</span> strength,
                <span class="dt">direction =</span> direction))
  }</code></pre></div>
<p>The result of applying the Sobel operator is a thick outline around Marine One.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  gradients &lt;-<span class="st"> </span><span class="kw">sobel</span>(new)
  <span class="kw">image</span>(gradients$strength, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="kw">paste</span>(<span class="st">&quot;gray&quot;</span>,<span class="dv">1</span>:<span class="dv">99</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</code></pre></div>
<p><img src="Data_Science__A_Practical_Strategy_files/figure-html/unnamed-chunk-180-1.png" width="672" /></p>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="25">
<li id="fn25"><p><a href="https://www.r-project.org/doc/Rnews/Rnews_2008-1.pdf" class="uri">https://www.r-project.org/doc/Rnews/Rnews_2008-1.pdf</a><a href="data-manipulation-wrangling-processing.html#fnref25">↩</a></p></li>
<li id="fn26"><p><a href="http://www.nydailynews.com/news/election/de-blasio-names-de-blasio-article-1.1463591" class="uri">http://www.nydailynews.com/news/election/de-blasio-names-de-blasio-article-1.1463591</a><a href="data-manipulation-wrangling-processing.html#fnref26">↩</a></p></li>
<li id="fn27"><p><a href="https://beta.prx.org/stories/81520" class="uri">https://beta.prx.org/stories/81520</a><a href="data-manipulation-wrangling-processing.html#fnref27">↩</a></p></li>
<li id="fn28"><p><a href="https://www.archives.gov/research/census/soundex.html" class="uri">https://www.archives.gov/research/census/soundex.html</a><a href="data-manipulation-wrangling-processing.html#fnref28">↩</a></p></li>
<li id="fn29"><p>Source needed<a href="data-manipulation-wrangling-processing.html#fnref29">↩</a></p></li>
<li id="fn30"><p><a href="https://www2.census.gov/geo/pdfs/reference/GARM/Ch11GARM.pdf" class="uri">https://www2.census.gov/geo/pdfs/reference/GARM/Ch11GARM.pdf</a><a href="data-manipulation-wrangling-processing.html#fnref30">↩</a></p></li>
<li id="fn31"><p><a href="https://www.washingtonpost.com/news/wonk/wp/2015/03/01/this-is-the-best-explanation-of-gerrymandering-you-will-ever-see/?utm_term" class="uri">https://www.washingtonpost.com/news/wonk/wp/2015/03/01/this-is-the-best-explanation-of-gerrymandering-you-will-ever-see/?utm_term</a>=.f820bf35a620<a href="data-manipulation-wrangling-processing.html#fnref31">↩</a></p></li>
<li id="fn32"><p><a href="http://history.house.gov/Institution/Election-Statistics/Election-Statistics/" class="uri">http://history.house.gov/Institution/Election-Statistics/Election-Statistics/</a><a href="data-manipulation-wrangling-processing.html#fnref32">↩</a></p></li>
<li id="fn33"><p>DateTimeClasses. <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/DateTimeClasses.html" class="uri">https://stat.ethz.ch/R-manual/R-devel/library/base/html/DateTimeClasses.html</a><a href="data-manipulation-wrangling-processing.html#fnref33">↩</a></p></li>
<li id="fn34"><p>Canny, J., A Computational Approach To Edge Detection, IEEE Trans. Pattern Analysis and Machine Intelligence, 8(6):679–698 (1986)<a href="data-manipulation-wrangling-processing.html#fnref34">↩</a></p></li>
<li id="fn35"><p>ref required<a href="data-manipulation-wrangling-processing.html#fnref35">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="a-light-introduction-to-programming.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exploratory-data-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
