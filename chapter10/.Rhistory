centers = i)
sil <- silhouette(cl$cluster, dissim)
opt <- rbind(opt, data.frame(k = i, sil = mean(sil[,3])))
}
plot(opt)
load("~/Documents/Github/textbook/chapter10/city_compare.Rda")
#Scales
inputs <- cty
inputs[,4:ncol(inputs)] <- scale(inputs[,4:ncol(inputs)])
set.seed(999)
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = 2)
cty1 <- cbind(clusters = cl$cluster, cty)
plot(sqrt(cty1$est.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.5)
for(i in 4:ncol(inputs)){
inputs[,i] <- sqrt(inputs[,i] )
}
dissim <- daisy(inputs[,4:ncol(inputs)])
opt <- data.frame()
library(cluster)
for(i in 2:40){
print(i)
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = i)
sil <- silhouette(cl$cluster, dissim)
opt <- rbind(opt, data.frame(k = i, sil = mean(sil[,3])))
}
plot(opt)
load("~/Documents/Github/textbook/chapter10/city_compare.Rda")
#Scales
inputs <- cty
inputs[,4:ncol(inputs)] <- scale(inputs[,4:ncol(inputs)])
set.seed(999)
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = 2)
cty1 <- cbind(clusters = cl$cluster, cty)
plot(sqrt(cty1$est.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.5)
View(inputs)
load("~/Documents/Github/textbook/chapter10/city_compare.Rda")
#Scales
inputs <- cty
inputs[,4:ncol(inputs)] <- scale(inputs[,4:ncol(inputs)])
set.seed(999)
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = 2)
cty1 <- cbind(clusters = cl$cluster, cty)
plot(sqrt(cty1$est.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.5)
load("~/Documents/Github/textbook/chapter10/city_compare.Rda")
#Scales
inputs <- cty
for(i in 4:ncol(inputs)){
inputs[,i] <- sqrt(inputs[,i] )
}
inputs[,4:ncol(inputs)] <- scale(inputs[,4:ncol(inputs)])
set.seed(999)
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = 2)
cty1 <- cbind(clusters = cl$cluster, cty)
plot(sqrt(cty1$est.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.5)
dissim <- daisy(inputs[,4:ncol(inputs)])
opt <- data.frame()
library(cluster)
for(i in 2:40){
print(i)
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = i)
sil <- silhouette(cl$cluster, dissim)
opt <- rbind(opt, data.frame(k = i, sil = mean(sil[,3])))
}
plot(opt)
cty1 <- cbind(clusters = cl$cluster, cty)
plot(sqrt(cty1$est.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.35)
plot(sqrt(cty1$emp.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.35)
plot(sqrt(cty1$emp.target), sqrt(cty1$est.target),
col = cty1$clusters, pch = 16, cex = 0.35)
i=2
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = i)
cty1 <- cbind(clusters = cl$cluster, cty)
plot(sqrt(cty1$est.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.35)
table(cl$cluster)
i=3
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = i)
cty1 <- cbind(clusters = cl$cluster, cty)
plot(sqrt(cty1$est.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.35)
table(cl$cluster)
plot(sqrt(cty1$emp.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.35)
plot(sqrt(cty1$emp.target), sqrt(cty1$est.target),
col = cty1$clusters, pch = 16, cex = 0.35)
plot(sqrt(cty1$est.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.35)
i=4
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = i)
cty1 <- cbind(clusters = cl$cluster, cty)
plot(sqrt(cty1$est.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.35)
table(cl$cluster)
plot(opt)
load("~/Documents/Github/textbook/chapter10/city_compare.Rda")
#Scales
inputs <- cty
for(i in 4:ncol(inputs)){
inputs[,i] <- sqrt(inputs[,i] )
}
inputs[,4:ncol(inputs)] <- scale(inputs[,4:ncol(inputs)])
set.seed(999)
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = 5)
cty1 <- cbind(clusters = cl$cluster, cty)
plot(sqrt(cty1$est.target), sqrt(cty1$pct.ba),
col = cty1$clusters, pch = 16, cex = 0.5)
#Plot to see
plot(sqrt(cty1$est.target), sqrt(cty1$pct.pov),
col = cty1$clusters, pch = 16, cex = 0.5)
#Plot to see
plot(sqrt(cty1$est.target), sqrt(cty1$pct.pov),
col = cty1$clusters, pch = 16, cex = 0.5)
####################################################
#Chapter 10 k-means clustering example data set   ##
####################################################
#Set up
setwd("~/Documents/Github/textbook/chapter10/")
library(readxl)
#Read in files
#Emp
emp <- read.csv("data/cbp16co.txt", stringsAsFactors=FALSE)
#https://www.ers.usda.gov/data-products/county-level-data-sets/download-data/
ed <- read_excel("data/Education.xls", skip = 4)
#pov
pov <- read_excel("data/PovertyEstimates.xls", skip = 3)
colnames(pov) <- c("fips", "pct.pov", "median.inc")
#Keep ACS data 2012-2016
cty <- ed[, c(1,2,3,44,45,46,47)]
colnames(cty) <- c("fips", "state", "name", "pct.less.hs",
"pct.hs", "pct.some.ba", "pct.ba" )
cty[is.na(cty)] <- 0
cty[is.nan(cty)] <- 0
cty[is.infinite(cty)] <- 0
#Employ numbers from County Business Patterns
# 5112 Software publishers
# 5161 Internet publishing and broadcasting
# 5179 Other telecommunications
# 5181 Internet service providers and Web search portals
# 5182 Data processing, hosting, and related services
# 5415 Computer systems design and related services
# 5417 Scientific research-and-development services
# Create FIPS
emp$fips <- paste0(sprintf("%02d", emp$fipstate),
sprintf("%03d", emp$fipscty))
#Cut down to relevant industries
emp$naics <- gsub("[[:punct:]]", "",emp$naics)
digital_ind <- c("5112", "5161", "5179", "5181", "5182", "5415","5417","")
emp <- emp[emp$naics %in% digital_ind,]
emp$naics[emp$naics==""] <- "all"
#Create employment numbers by industry
est <- aggregate(cbind(est,emp) ~ naics + fips,
data = emp,
FUN = sum)
est <- reshape(est,
idvar = "fips",
timevar = "naics",
direction = "wide")
#Calculate the scores
est[is.na(est)] <- 0
est$emp.target <-  est$emp.5182 + est$emp.5112 +
est$emp.5179 + est$emp.5415 + est$emp.5417
#Get Employment Calculated
emp <- est[,c("fips",  "emp.all", "emp.target")]
emp[,3:ncol(emp)] <- 100*emp[,3:ncol(emp)]/emp$emp.all
emp$emp.all <-  NULL
#Get Establishments calculated
est$est.target <- est$est.5182 + est$est.5112 +
est$est.5179 + est$est.5415 + est$est.5417
est <- est[,c("fips", "est.all", "est.target")]
est[,3:ncol(est)] <- 100*est[,3:ncol(est)]/est$est.all
est[is.na(est)] <- 0
cty <- cty[cty$emp.all != 0,]
est$est.all <-  NULL
#Join together
cty <- merge(cty, emp, by = "fips")
cty <- merge(cty, est, by = "fips")
cty <- merge(cty, pov, by = "fips")
cty <- cty[!is.nan(cty$emp.target), ]
cty <- cty[!is.nan(cty$est.target), ]
#drop
cty$pct.less.hs <- cty$pct.hs <- cty$pct.some.ba <- NULL
#County save
save(cty, file = "county_compare.Rda")
####################################################
#Chapter 10 k-means clustering example data set   ##
####################################################
#Set up
setwd("~/Documents/Github/textbook/chapter10/")
library(readxl)
#Read in files
#Emp
emp <- read.csv("data/cbp16co.txt", stringsAsFactors=FALSE)
#https://www.ers.usda.gov/data-products/county-level-data-sets/download-data/
ed <- read_excel("data/Education.xls", skip = 4)
#pov
pov <- read_excel("data/PovertyEstimates.xls", skip = 3)
colnames(pov) <- c("fips", "pct.pov", "median.inc")
#Keep ACS data 2012-2016
cty <- ed[, c(1,2,3,44,45,46,47)]
colnames(cty) <- c("fips", "state", "name", "pct.less.hs",
"pct.hs", "pct.some.ba", "pct.ba" )
cty[is.na(cty)] <- 0
cty[is.nan(cty)] <- 0
cty[is.infinite(cty)] <- 0
#Employ numbers from County Business Patterns
# 5112 Software publishers
# 5161 Internet publishing and broadcasting
# 5179 Other telecommunications
# 5181 Internet service providers and Web search portals
# 5182 Data processing, hosting, and related services
# 5415 Computer systems design and related services
# 5417 Scientific research-and-development services
# Create FIPS
emp$fips <- paste0(sprintf("%02d", emp$fipstate),
sprintf("%03d", emp$fipscty))
#Cut down to relevant industries
emp$naics <- gsub("[[:punct:]]", "",emp$naics)
digital_ind <- c("5112", "5161", "5179", "5181", "5182", "5415","5417","")
emp <- emp[emp$naics %in% digital_ind,]
emp$naics[emp$naics==""] <- "all"
#Create employment numbers by industry
est <- aggregate(cbind(est,emp) ~ naics + fips,
data = emp,
FUN = sum)
est <- reshape(est,
idvar = "fips",
timevar = "naics",
direction = "wide")
#Calculate the scores
est[is.na(est)] <- 0
est$emp.target <-  est$emp.5182 + est$emp.5112 +
est$emp.5179 + est$emp.5415 + est$emp.5417
#Get Employment Calculated
emp <- est[,c("fips",  "emp.all", "emp.target")]
emp[,3:ncol(emp)] <- 100*emp[,3:ncol(emp)]/emp$emp.all
emp$emp.all <-  NULL
#Get Establishments calculated
est$est.target <- est$est.5182 + est$est.5112 +
est$est.5179 + est$est.5415 + est$est.5417
est <- est[,c("fips", "est.all", "est.target")]
est[,3:ncol(est)] <- 100*est[,3:ncol(est)]/est$est.all
est[is.na(est)] <- 0
est <- est[est$emp.all != 0,]
est$est.all <-  NULL
#Join together
cty <- merge(cty, emp, by = "fips")
cty <- merge(cty, est, by = "fips")
cty <- merge(cty, pov, by = "fips")
cty <- cty[!is.nan(cty$emp.target), ]
cty <- cty[!is.nan(cty$est.target), ]
#drop
cty$pct.less.hs <- cty$pct.hs <- cty$pct.some.ba <- NULL
#County save
save(cty, file = "county_compare.Rda")
####################################################
#Chapter 10 k-means clustering example data set   ##
####################################################
#Set up
setwd("~/Documents/Github/textbook/chapter10/")
library(readxl)
#Read in files
#Emp
emp <- read.csv("data/cbp16co.txt", stringsAsFactors=FALSE)
#https://www.ers.usda.gov/data-products/county-level-data-sets/download-data/
ed <- read_excel("data/Education.xls", skip = 4)
#pov
pov <- read_excel("data/PovertyEstimates.xls", skip = 3)
colnames(pov) <- c("fips", "pct.pov", "median.inc")
#Keep ACS data 2012-2016
cty <- ed[, c(1,2,3,44,45,46,47)]
colnames(cty) <- c("fips", "state", "name", "pct.less.hs",
"pct.hs", "pct.some.ba", "pct.ba" )
cty[is.na(cty)] <- 0
cty[is.nan(cty)] <- 0
cty[is.infinite(cty)] <- 0
#Employ numbers from County Business Patterns
# 5112 Software publishers
# 5161 Internet publishing and broadcasting
# 5179 Other telecommunications
# 5181 Internet service providers and Web search portals
# 5182 Data processing, hosting, and related services
# 5415 Computer systems design and related services
# 5417 Scientific research-and-development services
# Create FIPS
emp$fips <- paste0(sprintf("%02d", emp$fipstate),
sprintf("%03d", emp$fipscty))
#Cut down to relevant industries
emp$naics <- gsub("[[:punct:]]", "",emp$naics)
digital_ind <- c("5112", "5161", "5179", "5181", "5182", "5415","5417","")
emp <- emp[emp$naics %in% digital_ind,]
emp$naics[emp$naics==""] <- "all"
#Create employment numbers by industry
est <- aggregate(cbind(est,emp) ~ naics + fips,
data = emp,
FUN = sum)
est <- reshape(est,
idvar = "fips",
timevar = "naics",
direction = "wide")
#Calculate the scores
est[is.na(est)] <- 0
est$emp.target <-  est$emp.5182 + est$emp.5112 +
est$emp.5179 + est$emp.5415 + est$emp.5417
#Get Employment Calculated
emp <- est[,c("fips",  "emp.all", "emp.target")]
emp[,3:ncol(emp)] <- 100*emp[,3:ncol(emp)]/emp$emp.all
emp$emp.all <-  NULL
#Get Establishments calculated
est$est.target <- est$est.5182 + est$est.5112 +
est$est.5179 + est$est.5415 + est$est.5417
est <- est[,c("fips", "est.all", "est.target")]
est[,3:ncol(est)] <- 100*est[,3:ncol(est)]/est$est.all
est[is.na(est)] <- 0
est <- est[est$emp.all != 0,]
est$est.all <-  NULL
head(sil)
sil
d
summary(sil)
?sil
??silhouette
plot(sil)
####################################################
#Chapter 10 k-means clustering example data set   ##
####################################################
#Set up
setwd("~/Documents/Github/textbook/chapter10/")
library(readxl)
#Read in files
#Emp
emp <- read.csv("data/cbp16co.txt", stringsAsFactors=FALSE)
#https://www.ers.usda.gov/data-products/county-level-data-sets/download-data/
ed <- read_excel("data/Education.xls", skip = 4)
#pov
pov <- read_excel("data/PovertyEstimates.xls", skip = 3)
colnames(pov) <- c("fips", "pct.pov", "median.inc")
#Keep ACS data 2012-2016
cty <- ed[, c(1,2,3,44,45,46,47)]
colnames(cty) <- c("fips", "state", "name", "pct.less.hs",
"pct.hs", "pct.some.ba", "pct.ba" )
cty[is.na(cty)] <- 0
cty[is.nan(cty)] <- 0
cty[is.infinite(cty)] <- 0
#Employ numbers from County Business Patterns
# 5112 Software publishers
# 5161 Internet publishing and broadcasting
# 5179 Other telecommunications
# 5181 Internet service providers and Web search portals
# 5182 Data processing, hosting, and related services
# 5415 Computer systems design and related services
# 5417 Scientific research-and-development services
# Create FIPS
emp$fips <- paste0(sprintf("%02d", emp$fipstate),
sprintf("%03d", emp$fipscty))
#Cut down to relevant industries
emp$naics <- gsub("[[:punct:]]", "",emp$naics)
digital_ind <- c("5112", "5161", "5179", "5181", "5182", "5415","5417","")
emp <- emp[emp$naics %in% digital_ind,]
emp$naics[emp$naics==""] <- "all"
#Create employment numbers by industry
est <- aggregate(cbind(est,emp) ~ naics + fips,
data = emp,
FUN = sum)
est <- reshape(est,
idvar = "fips",
timevar = "naics",
direction = "wide")
#Calculate the scores
est[is.na(est)] <- 0
est$emp.target <-  est$emp.5182 + est$emp.5112 +
est$emp.5179 + est$emp.5415 + est$emp.5417
#Get Employment Calculated
emp <- est[,c("fips",  "emp.all", "emp.target")]
emp[,3:ncol(emp)] <- 100*emp[,3:ncol(emp)]/emp$emp.all
emp$emp.all <-  NULL
#Get Establishments calculated
est$est.target <- est$est.5182 + est$est.5112 +
est$est.5179 + est$est.5415 + est$est.5417
est <- est[,c("fips", "est.all", "est.target")]
est[,3:ncol(est)] <- 100*est[,3:ncol(est)]/est$est.all
est[is.na(est)] <- 0
est <- est[est$est.all != 0,]
####################################################
#Chapter 10 k-means clustering example data set   ##
####################################################
#Set up
setwd("~/Documents/Github/textbook/chapter10/")
library(readxl)
#Read in files
#Emp
emp <- read.csv("data/cbp16co.txt", stringsAsFactors=FALSE)
#https://www.ers.usda.gov/data-products/county-level-data-sets/download-data/
ed <- read_excel("data/Education.xls", skip = 4)
#pov
pov <- read_excel("data/PovertyEstimates.xls", skip = 3)
colnames(pov) <- c("fips", "pct.pov", "median.inc")
#Keep ACS data 2012-2016
cty <- ed[, c(1,2,3,44,45,46,47)]
colnames(cty) <- c("fips", "state", "name", "pct.less.hs",
"pct.hs", "pct.some.ba", "pct.ba" )
cty[is.na(cty)] <- 0
cty[is.nan(cty)] <- 0
cty[is.infinite(cty)] <- 0
#Employ numbers from County Business Patterns
# 5112 Software publishers
# 5161 Internet publishing and broadcasting
# 5179 Other telecommunications
# 5181 Internet service providers and Web search portals
# 5182 Data processing, hosting, and related services
# 5415 Computer systems design and related services
# 5417 Scientific research-and-development services
# Create FIPS
emp$fips <- paste0(sprintf("%02d", emp$fipstate),
sprintf("%03d", emp$fipscty))
#Cut down to relevant industries
emp$naics <- gsub("[[:punct:]]", "",emp$naics)
digital_ind <- c("5112", "5161", "5179", "5181", "5182", "5415","5417","")
emp <- emp[emp$naics %in% digital_ind,]
emp$naics[emp$naics==""] <- "all"
#Create employment numbers by industry
est <- aggregate(cbind(est,emp) ~ naics + fips,
data = emp,
FUN = sum)
est <- reshape(est,
idvar = "fips",
timevar = "naics",
direction = "wide")
#Calculate the scores
est[is.na(est)] <- 0
est$emp.target <-  est$emp.5182 + est$emp.5112 +
est$emp.5179 + est$emp.5415 + est$emp.5417
#Get Employment Calculated
emp <- est[,c("fips",  "emp.all", "emp.target")]
emp[,3:ncol(emp)] <- 100*emp[,3:ncol(emp)]/emp$emp.all
emp <- emp[emp$emp.all!=0,]
emp$emp.all <-  NULL
#Get Establishments calculated
est$est.target <- est$est.5182 + est$est.5112 +
est$est.5179 + est$est.5415 + est$est.5417
est <- est[,c("fips", "est.all", "est.target")]
est[,3:ncol(est)] <- 100*est[,3:ncol(est)]/est$est.all
est[is.na(est)] <- 0
est <- est[est$est.all != 0,]
est$est.all <-  NULL
#Join together
cty <- merge(cty, emp, by = "fips")
cty <- merge(cty, est, by = "fips")
cty <- merge(cty, pov, by = "fips")
cty <- cty[!is.nan(cty$emp.target), ]
cty <- cty[!is.nan(cty$est.target), ]
#drop
cty$pct.less.hs <- cty$pct.hs <- cty$pct.some.ba <- NULL
#County save
save(cty, file = "county_compare.Rda")
??PAM
#And breaks the country into one small partition and one large partition
cl <- kmeans(inputs[,4:ncol(inputs)], centers = 2)
#Compare
cty1 <- cbind(clusters = cl$cluster, cty)
View(cty)
View(cty1)
table(cty1$clusters)
#And breaks the country into one small partition and one large partition
cl <- kmeans(inputs[,4:ncol(inputs)], centers = 5)
#Compare
cty1 <- cbind(clusters = cl$cluster, cty)
table(cty1$clusters)
inputs$est.target <- NULL
load("data/county_compare.Rda")
#Scale input variables
inputs <- cty
load("data/city_compare.Rda")
#Scale input variables
inputs <- cty
inputs[,4:ncol(inputs)] <- scale(inputs[,4:ncol(inputs)])
inputs$est.target <- NULL
#Dry run
set.seed(999)
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = 5)
#Examine silhouette
d <- daisy(inputs[,4:ncol(inputs)])
opt <- data.frame()
for(i in 2:40){
print(i)
cl <- kmeans(inputs[,4:ncol(inputs)],
centers = i)
sil <- silhouette(cl$cluster, d)
opt <- rbind(opt, data.frame(k = i, sil = mean(sil[,3])))
}
#Plotted suggest that 2 clusters gives the best result
plot(opt)
plot(cty$est.target, cty$emp.target)
plot(cty$est.target, cty$emp.target, pch = 16, col = rgb(0,0,1,0.2))
plot(cty$est.target, cty$emp.target, pch = 16, col = rgb(0,0,1,0.1))
cor(cty$est.target, cty$emp.target)
